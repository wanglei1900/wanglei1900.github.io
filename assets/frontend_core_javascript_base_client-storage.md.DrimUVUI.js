import{_ as i,c as a,o as n,a7 as e}from"./chunks/framework.Dtft01Yp.js";const o=JSON.parse('{"title":"1 cookie","description":"","frontmatter":{},"headers":[],"relativePath":"frontend/core/javascript/base/client-storage.md","filePath":"frontend/core/javascript/base/client-storage.md","lastUpdated":1751966758000}'),l={name:"frontend/core/javascript/base/client-storage.md"};function p(t,s,h,k,r,E){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="_1-cookie" tabindex="-1">1 cookie <a class="header-anchor" href="#_1-cookie" aria-label="Permalink to &quot;1 cookie&quot;">â€‹</a></h1><p><a href="https://www.cnblogs.com/wanglei1900/p/16251817.html" target="_blank" rel="noreferrer">ğŸš€ ç«™å†…è·³è½¬ï¼ŒWebStorage æœ¬åœ°å­˜å‚¨ä¹‹é—´çš„åŒºåˆ«åŠä½¿ç”¨</a></p><p>cookie ç”¨äºå®¢æˆ·ç«¯å­˜å‚¨ä¼šè¯ä¿¡æ¯ã€‚</p><p>è§„èŒƒè¦æ±‚æœåŠ¡å™¨åœ¨å“åº” HTTP è¯·æ±‚æ—¶ï¼Œé€šè¿‡ <code>Set-Cookie</code> HTTP å¤´éƒ¨åŒ…å«ä¼šè¯ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯ HTTP çš„å“åº”å¤´éƒ¨ç¤ºä¾‹ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTP/1.1 200 OK</span></span>
<span class="line"><span>Content-type: text/html</span></span>
<span class="line"><span>Set-Cookie: name=value</span></span>
<span class="line"><span>other-header: other-header-value</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿™ä¸ª HTTP ä¼šå“åº”ä¸€ä¸ªåä¸º nameï¼Œå€¼ä¸º value çš„ cookieã€‚å®¢æˆ·ç«¯ä¼šå­˜å‚¨è¿™äº›ä¼šè¯ä¿¡æ¯ï¼Œå¹¶åœ¨ä¹‹åæ¯ä¸ªè¯·æ±‚ä¸­éƒ½ä¼šé€šè¿‡ HTTP å¤´éƒ¨ cookie å°†å®ƒä»¬å‘å›æœåŠ¡å™¨</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>GET /index.jsl</span></span>
<span class="line"><span>HTTP/1.1</span></span>
<span class="line"><span>Cookie: name=value</span></span>
<span class="line"><span>Other-header: other-header-value</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>cookie</strong> æ˜¯ä¸ç‰¹å®šåŸŸç»‘å®šçš„ã€‚è®¾ç½® <strong>cookie</strong> åï¼Œå®ƒä¼šä¸è¯·æ±‚ä¸€èµ·å‘é€åˆ°åˆ›å»ºå®ƒçš„åŸŸã€‚è¿™ä¸ªé™åˆ¶èƒ½ä¿è¯ cookie ä¸­å­˜å‚¨çš„ä¿¡æ¯åªå¯¹è¢«è®¤å¯çš„æ¥æ”¶è€…å¼€æ”¾,ä¸è¢«å…¶ä»–åŸŸè®¿é—®ã€‚</p><p>å› ä¸º <strong>cookie</strong> å­˜å‚¨åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Š,æ‰€ä»¥ä¸ºä¿è¯å®ƒä¸ä¼šè¢«æ¶æ„åˆ©ç”¨,æµè§ˆå™¨ä¼šæ–½åŠ é™åˆ¶ã€‚åŒæ—¶,<strong>cookie</strong> ä¹Ÿä¸ä¼šå ç”¨å¤ªå¤šç£ç›˜ç©ºé—´ã€‚</p><h2 id="_1-1-cookie-çš„é™åˆ¶" tabindex="-1">1.1 cookie çš„é™åˆ¶ <a class="header-anchor" href="#_1-1-cookie-çš„é™åˆ¶" aria-label="Permalink to &quot;1.1 cookie çš„é™åˆ¶&quot;">â€‹</a></h2><p>cookie éœ€éµå®ˆä»¥ä¸‹é™åˆ¶</p><ul><li>ä¸è¶…è¿‡ 300 ä¸ª cookie;</li><li>æ¯ä¸ª cookie ä¸è¶…è¿‡ <strong>4096</strong> å­—èŠ‚;</li><li>æ¯ä¸ªåŸŸä¸è¶…è¿‡ 20 ä¸ª cookie;</li><li>æ¯ä¸ªåŸŸä¸è¶…è¿‡ 81920 å­—èŠ‚ã€‚</li><li>æ¯ä¸ªåŸŸèƒ½è®¾ç½®çš„ cookie æ€»æ•°ä¹Ÿæ˜¯å—é™çš„,ä½†ä¸åŒæµè§ˆå™¨çš„é™åˆ¶ä¸åŒã€‚ä¾‹å¦‚: <ul><li>æœ€æ–°ç‰ˆ IE å’Œ Edge é™åˆ¶æ¯ä¸ªåŸŸä¸è¶…è¿‡ 50 ä¸ª cookie;</li><li>æœ€æ–°ç‰ˆ Firefox é™åˆ¶æ¯ä¸ªåŸŸä¸è¶…è¿‡ 150 ä¸ª cookie;</li><li>æœ€æ–°ç‰ˆ Opera é™åˆ¶æ¯ä¸ªåŸŸä¸è¶…è¿‡ 180 ä¸ª cookie;</li><li>Safari å’Œ Chrome å¯¹æ¯ä¸ªåŸŸçš„ cookie æ•°æ²¡æœ‰ç¡¬æ€§é™åˆ¶ã€‚</li></ul></li></ul><p>è¿˜æœ‰å…¶ä»–éœ€è¦æ³¨æ„çš„ç‚¹</p><ol><li>å¦‚æœ cookie æ€»æ•°è¶…è¿‡ä¸Šé™è¶…è¿‡å•ä¸ªåŸŸçš„ä¸Šé™ï¼Œæµè§ˆå™¨ä¼šåˆ é™¤ä¹‹å‰è®¾ç½®çš„çš„ cookieã€‚IE å’Œ Opera ä¼šæŒ‰ç…§æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„åŸåˆ™åˆ é™¤ï¼Œfirefox éšæœºåˆ é™¤ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦è¶…å‡ºé™åˆ¶ã€‚</li><li>ä¸ºäº†ä¿è¯ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§ï¼Œç•™æœ‰ä¸€ä¸ªå­—èŠ‚çš„è¯¯å·®ï¼Œé¡¾æ¯ä¸ª cookie ä¸èƒ½è¶…è¿‡ 4095 å­—èŠ‚</li><li>å¦‚æœåˆ›å»ºçš„ cookie è¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œåˆ™è¯¥ cookie ä¼šè¢«é™é»˜åˆ é™¤ã€‚å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¼šå ä¸€ä¸ªå­—èŠ‚ã€‚å¦‚æœä½¿ç”¨å¤šå­—èŠ‚å­—ç¬¦ï¼ˆå¦‚ UTF-8 Unicode å­—ç¬¦ï¼‰ï¼Œåˆ™æ¯ä¸ªå­—ç¬¦æœ€å¤šå¯èƒ½å  4 ä¸ªå­—èŠ‚ã€‚</li></ol><br><h2 id="_1-2-cookie-çš„æ„æˆ" tabindex="-1">1.2 cookie çš„æ„æˆ <a class="header-anchor" href="#_1-2-cookie-çš„æ„æˆ" aria-label="Permalink to &quot;1.2 cookie çš„æ„æˆ&quot;">â€‹</a></h2><p>cookie åœ¨æµè§ˆå™¨ä¸­æ˜¯ç”±ä»¥ä¸‹å‚æ•°æ„æˆçš„ã€‚</p><ul><li><strong>åç§°:</strong> å”¯ä¸€æ ‡è¯† cookie çš„åç§°ã€‚cOOkie åä¸åŒºåˆ†å¤§å°å†™ï¼Œå› æ­¤ mycookie å’Œ Mycookie æ˜¯åŒä¸ªåç§°ã€‚ä¸è¿‡,å®è·µä¸­æœ€å¥½å°† cookie åå½“æˆåŒºåˆ†å¤§å°å†™æ¥å¯¹å¾…,å› ä¸ºä¸€äº›æœåŠ¡å™¨è½¯ä»¶å¯èƒ½è¿™å¯¹å¾…å®ƒä»¬ã€‚cookie åå¿…é¡»ç»è¿‡ URL ç¼–ç ã€‚</li><li><strong>å€¼:</strong> å­˜å‚¨åœ¨ cookie é‡Œçš„å­—ç¬¦ä¸²å€¼ã€‚è¿™ä¸ªå€¼å¿…é¡»ç»è¿‡ URL ç¼–ç ã€‚</li><li><strong>åŸŸ:</strong> cookie æœ‰æ•ˆçš„åŸŸã€‚å‘é€åˆ°è¿™ä¸ªåŸŸçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šåŒ…å«å¯¹åº”çš„ cookieã€‚è¿™ä¸ªå€¼å¯èƒ½åŒ…å«å­åŸŸ(å¦‚www.baidu.com )ã€ä¹Ÿå¯ä»¥ä¸åŒ…å«(å¦‚,baidu.com è¡¨ç¤ºå¯¹ baidu.com çš„æ‰€æœ‰å­åŸŸéƒ½æœ‰æ•ˆ )ã€‚å¦‚æœä¸æ˜ç¡®è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºè®¾ç½® cookie çš„åŸŸã€‚</li><li><strong>è·¯å¾„:</strong> è¯·æ±‚ URL ä¸­åŒ…å«è¿™ä¸ªè·¯å¾„æ‰ä¼šæŠŠ cookie å‘é€åˆ°æœåŠ¡å™¨ã€‚ä¾‹å¦‚,å¯ä»¥æŒ‡å®š cookie åªèƒ½ç”±<a href="http://www.baidu.com/books/%E8%AE%BF%E9%97%AE,%E5%9B%A0%E6%AD%A4%E8%AE%BF%E9%97%AE" target="_blank" rel="noreferrer">http://www.baidu.com/books/è®¿é—®,å› æ­¤è®¿é—®</a> <a href="http://www.baidu.com/%E4%B8%8B%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B0%B1%E4%B8%8D%E4%BC%9A%E5%8F%91%E9%80%81" target="_blank" rel="noreferrer">http://www.baidu.com/ä¸‹çš„é¡µé¢å°±ä¸ä¼šå‘é€</a> cookie,å³ä½¿è¯·æ±‚çš„æ˜¯åŒä¸€ä¸ªåŸŸã€‚</li><li><strong>è¿‡æœŸæ—¶é—´:</strong> è¡¨ç¤ºä½•æ—¶åˆ é™¤ cookie çš„æ—¶é—´æˆ³(å³ä»€ä¹ˆæ—¶é—´ä¹‹åå°±ä¸å‘é€åˆ°æœåŠ¡å™¨äº†)ã€‚é»˜è®¤æƒ…å†µä¸‹æµè§ˆå™¨ä¼šè¯ç»“æŸåä¼šåˆ é™¤æ‰€æœ‰ cookieã€‚ä¸è¿‡,ä¹Ÿå¯ä»¥è®¾ç½®åˆ é™¤ cookie çš„æ—¶é—´ã€‚è¿™ä¸ªå€¼æ˜¯ GMT æ ¼å¼(Wdy, DD-Mon-YYYY HH:MM:SS GMT),ç”¨äºæŒ‡å®šåˆ é™¤ cookie çš„å…·ä½“æ—¶é—´ã€‚è¿™æ ·å³ä½¿å…³é—­æµè§ˆå™¨ cookie ä¹Ÿä¼šä¿ç•™åœ¨ç”¨æˆ·æœºå™¨ä¸Šã€‚æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºè¿‡å»çš„æ—¶é—´ä¼šç«‹å³åˆ é™¤ cookieã€‚</li><li><strong>å®‰å…¨æ ‡å¿—:</strong> è®¾ç½®ä¹‹å,åªåœ¨ä½¿ç”¨ SSL å®‰å…¨è¿æ¥çš„æƒ…å†µä¸‹æ‰ä¼šæŠŠ cookie å‘é€åˆ°æœåŠ¡å™¨ã€‚ä¾‹å¦‚,è¯·æ±‚ <a href="https://www.baidu.com" target="_blank" rel="noreferrer">https://www.baidu.com</a> ä¼šå‘é€ cookie,è€Œè¯·æ±‚ <a href="http://www.baidu.com" target="_blank" rel="noreferrer">http://www.baidu.com</a> åˆ™ä¸ä¼šã€‚</li></ul><p>è¿™äº›å‚æ•°åœ¨ <code>Set-cookie</code> å¤´éƒ¨ä½¿ç”¨åˆ†å·åŠ ç©ºæ ¼éš”å¼€ï¼Œæ¯”å¦‚</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTP/1.1 200 OK</span></span>
<span class="line"><span>Content-type: text/htm1</span></span>
<span class="line"><span>Set-Cookie: namesvalue! expires=mon, 22-Jan-07 07:10:24 GMT; domain=.baidu.com</span></span>
<span class="line"><span>Other-header: other-header-value</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿™ä¸ªå¤´éƒ¨è®¾ç½®ä¸€ä¸ªåä¸º&quot;name&quot;çš„ cookie,è¿™ä¸ª <strong>cookie</strong> åœ¨ 2007 å¹´ 1 æœˆ 22 æ—¥ 7:10:24 è¿‡æœŸ,å¯¹ www.baidu.com åŠå…¶ä»– baidu.com çš„å­åŸŸ (å¦‚ p2p.baidu.com) æœ‰æ•ˆã€‚å®‰å…¨æ ‡å¿— <strong>secure</strong> æ˜¯ <strong>cookie</strong> ä¸­å”¯ä¸€çš„éå/å€¼å¯¹,åªéœ€ä¸€ä¸ª <strong>secure</strong> å°±å¯ä»¥äº†ã€‚æ¯”å¦‚:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTP/1.1 200 OK</span></span>
<span class="line"><span>Content-type: text/html</span></span>
<span class="line"><span>Set-Cookie: name=value; domain=.baidu.com; path=/;secure</span></span>
<span class="line"><span>Other-header: other-header-value</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿™é‡Œåˆ›å»ºçš„ <strong>cookie</strong> å¯¹æ‰€æœ‰ baidu.com çš„å­åŸŸåŠè¯¥åŸŸä¸­çš„æ‰€æœ‰é¡µé¢æœ‰æ•ˆ(é€šè¿‡ path=/æŒ‡å®š )ã€‚ä¸è¿‡è¿™ä¸ª <strong>cookie</strong> åªèƒ½åœ¨ SSL è¿æ¥ä¸Šå‘é€,å› ä¸ºè®¾ç½®äº† <strong>secure</strong> æ ‡å¿—ã€‚</p><p>è¦çŸ¥é“,<strong>åŸŸã€è·¯å¾„ã€è¿‡æœŸæ—¶é—´å’Œ secure</strong> æ ‡å¿—ç”¨äºå‘Šè¯‰æµè§ˆå™¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥åœ¨è¯·æ±‚ä¸­åŒ…å« <strong>cookie</strong>.è¿™äº›å‚æ•°å¹¶ä¸ä¼šéšè¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œå®é™…å‘é€çš„åªæœ‰ <strong>cookie</strong> çš„å/æ¤å¯¹ã€‚</p><br><h2 id="_1-3-javascript-ä¸­çš„-cookie" tabindex="-1">1.3 JavaScript ä¸­çš„ cookie <a class="header-anchor" href="#_1-3-javascript-ä¸­çš„-cookie" aria-label="Permalink to &quot;1.3 JavaScript ä¸­çš„ cookie&quot;">â€‹</a></h2><p>è¦ä½¿ç”¨è¯¥å±æ€§è·å–å€¼æ—¶, <code>document.cookie</code> è¿”å›åŒ…å«é¡µé¢ä¸­æ‰€æœ‰ <strong>cookie</strong> çš„å­—ç¬¦ä¸²(æ ¹æ®åŸŸã€è·¯å¾„ã€è¿‡æœŸæ—¶é—´å’Œå®‰å…¨è®¾ç½®),ä»¥åˆ†å·åˆ†éš”,å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><p><code>name1 = value1;name2=value2;name3=value3;</code></p><p>æ‰€æœ‰åå’Œå€¼éƒ½æ˜¯ URL ç¼–ç çš„,å› æ­¤å¿…é¡»ä½¿ç”¨ <code>decodeURIcomponent()</code> è§£ç ã€‚</p><p>åœ¨è®¾ç½®å€¼æ—¶,å¯ä»¥é€šè¿‡ <code>document.cookie</code> å±æ€§è®¾ç½®æ–°çš„ <strong>cookie</strong> å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦ä¸²åœ¨è¢«è§£æåä¼šæ·»åŠ åˆ°åŸæœ‰ <strong>cookie</strong> ä¸­ã€‚è®¾ç½® <code>document.cookie</code> ä¸ä¼šè¦†ç›–ä¹‹å‰å­˜åœ¨çš„ä»»ä½• <strong>cookie</strong>,é™¤éè®¾ç½®äº†å·²æœ‰çš„ <strong>cookie</strong>ã€‚è®¾ç½® <strong>cookie</strong> çš„æ ¼å¼å¦‚ä¸‹,ä¸ <code>Set-cookie</code> å¤´éƒ¨çš„æ ¼å¼ä¸€æ ·:</p><p><code>name=value; expires=expiration_time; path=domain_path; domain=domain_name; secure</code></p><p>åœ¨æ‰€æœ‰è¿™äº›å‚æ•°ä¸­,åªæœ‰ <strong>cookie</strong> çš„åç§°å’Œå€¼æ˜¯å¿…éœ€çš„ã€‚ä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­: <code>document.cookie = &quot;name=Nicholas&quot;;</code> è¿™è¡Œä»£ç ä¼šåˆ›å»ºä¸€ä¸ªåä¸º&quot;name&quot;çš„ä¼šè¯ <strong>cookie</strong>,å…¶å€¼ä¸º&quot;Nicholas&quot;ã€‚è¿™ä¸ª <strong>cookie</strong> åœ¨æ¯æ¬¡å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶éƒ½ä¼šè¢«å¸¦ä¸Š,åœ¨æµè§ˆå™¨å…³é—­æ—¶å°±ä¼šè¢«åˆ é™¤ã€‚è™½ç„¶è¿™æ ·ç›´æ¥è®¾ç½®ä¹Ÿå¯ä»¥,å› ä¸ºä¸éœ€è¦åœ¨åç§°æˆ–å€¼ä¸­ç¼–ç ä»»ä½•å­—ç¬¦,ä½†æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ <code>encodeURIComponent()</code> å¯¹åç§°å’Œå€¼è¿›è¡Œç¼–ç ,æ¯”å¦‚:</p><p><code>document.cookie = encodeURIComponent(&quot;name&quot;) + &quot;=&quot; +encodeURIComponent(&quot;Nicholas&quot;);</code></p><p>è¦ä¸ºåˆ›å»ºçš„ <strong>cookie</strong> æŒ‡å®šé¢å¤–çš„ä¿¡æ¯,åªè¦åƒ <code>Set-cookie</code> å¤´éƒ¨ä¸€æ ·ç›´æ¥åœ¨åé¢è¿½åŠ ç›¸åŒæ ¼å¼çš„å­—ç¬¦ä¸²å³å¯:</p><p><code>document.cookie = encodeURIComponent (&quot;name&quot;) + &quot;=&quot;encodeURIComponent (&quot;Nicholas&quot;) + &quot;; domain=.wrox.com; path=/&quot;;</code></p><p>å› ä¸ºåœ¨ JavaScript ä¸­è¯»å†™ <strong>cookie</strong> ä¸æ˜¯å¾ˆç›´è§‚,æ‰€ä»¥å¯ä»¥é€šè¿‡è¾…åŠ©å‡½æ•°æ¥ç®€åŒ–ç›¸åº”çš„æ“ä½œã€‚ä¸ <strong>cookie</strong> ç›¸å…³çš„åŸºæœ¬æ“ä½œæœ‰è¯»ã€å†™å’Œåˆ é™¤ã€‚è¿™äº›åœ¨ <strong>Cookieutil</strong> å¯¹è±¡ä¸­è¡¨ç¤ºå¦‚ä¸‹:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // getæ–¹æ³•ç”¨äºå–å¾—ç»™å®šåç§°çš„cookieå€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieStart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cookieName),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nell;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cookieStart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cookieStart);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cookieEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cookieEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> decodeURIComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document.cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cookieStart, cookieName.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cookieEnd));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieValue;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç”¨äºè®¾ç½®é¡µé¢ä¸Šçš„cookieï¼Œæ¥å—å¤šä¸ªå‚æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	æ¥æ”¶å¤šä¸ªå‚æ•°:cookie åç§°ã€cookie å€¼ã€å¯é€‰çš„ Date å¯¹è±¡(è¡¨ç¤ºä½•æ—¶åˆ é™¤ cookie )ã€å¯é€‰çš„ URL è·¯å¾„ã€å¯é€‰çš„åŸŸä»¥åŠå¯é€‰çš„å¸ƒå°”å€¼(è¡¨ç¤ºæ˜¯å¦åŠ secureæ ‡å¿—)ã€‚è¿™äº›å‚æ•°ä»¥å®ƒä»¬çš„ä½¿ç”¨é¢‘ç‡ä¸ºåº,åªæœ‰å‰ä¸¤ä¸ªæ˜¯å¿…éœ€çš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (expires </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; expires=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expires</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toGMTString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (path) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; path=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (domain) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; domain=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (secure) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; secure\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    document.cookie </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieText;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ é™¤cookieï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®ä¸º 1970 å¹´1æœˆ1æ—¥(ä»¥Oæ¯«ç§’åˆå§‹åŒ–çš„ Date å¯¹è±¡çš„å€¼ )ã€‚è¿™æ ·å¯ä»¥ä¿è¯åˆ é™¤ cookie</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), path, domain, secure);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>è¿™äº›æ–¹æ³•é€šè¿‡å¤„ç†è§£æå’Œ <strong>cookie</strong> å­—ç¬¦ä¸²æ„å»º,ç®€åŒ–äº†ä½¿ç”¨ <strong>cookie</strong> å­˜å‚¨æ•°æ®çš„æ“ä½œã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½®cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;book&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;professional Javascript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯»å– cookie</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;Nicholas&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;book&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;professional JavaScript&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ é™¤ cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;book&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½®æœ‰è·¯å¾„ã€åŸŸå’Œè¿‡æœŸæ—¶é—´çš„cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/books/projs/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;www.wrox.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;January 1,2010&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ é™¤åˆšåˆšè®¾ç½®çš„ cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/books/projs/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;www.wrox.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½®å®‰å…¨ cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div> <br><h2 id="_1-4-å­-cookie" tabindex="-1">1.4 å­ cookie <a class="header-anchor" href="#_1-4-å­-cookie" aria-label="Permalink to &quot;1.4 å­ cookie&quot;">â€‹</a></h2><p>ä¸ºç»•è¿‡æµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸ <strong>cookie</strong> æ•°çš„é™åˆ¶,æœ‰äº›å¼€å‘è€…æå‡ºäº†<strong>å­ cookie</strong>çš„æ¦‚å¿µã€‚<strong>å­ cookie</strong>æ˜¯åœ¨å•ä¸ª <strong>cookie</strong> å­˜å‚¨çš„å°å—æ•°æ®,æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ <strong>cookie</strong> çš„å€¼åœ¨å•ä¸ª <strong>cookie</strong> ä¸­å­˜å‚¨å¤šä¸ªå/å€¼å¯¹ã€‚æœ€å¸¸ç”¨çš„<strong>å­ cookie</strong>æ¨¡å¼å¦‚ä¸‹:</p><p><code>name=name1=valuel&amp;name2=value2&amp;name3=value3&amp;name4=value4&amp;name5=value5</code></p><p><strong>å­ cookie</strong> çš„æ ¼å¼ç±»ä¼¼äºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚è¿™äº›å€¼å¯ä»¥å­˜å‚¨ä¸ºå•ä¸ª <strong>cookie</strong>,è€Œä¸ç”¨å•ç‹¬å­˜å‚¨ä¸ºè‡ªå·±çš„å/å€¼å¯¹ã€‚ç»“æœå°±æ˜¯ç½‘ç«™æˆ– Web åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨å•åŸŸ <strong>cookie</strong> æ•°é™åˆ¶ä¸‹å­˜å‚¨æ›´å¤šçš„ç»“æ„åŒ–æ•°æ®ã€‚è¦æ“ä½œ<strong>å­ cookie</strong>,å°±éœ€è¦å†æ·»åŠ ä¸€äº›è¾…åŠ©æ–¹æ³•ã€‚è§£æå’Œåºåˆ—åŒ–<strong>å­ cookie</strong>çš„æ–¹å¼ä¸-æ ·,ä¸”å› ä¸ºå¯¹<strong>å­ cookie</strong>çš„ä½¿ç”¨è€Œå˜å¾—æ›´å¤æ‚ã€‚æ¯”å¦‚,è¦å–å¾—æŸä¸ª<strong>å­ cookie</strong>,å°±éœ€è¦å…ˆå–å¾—<strong>cookie</strong>,ç„¶ååœ¨è§£ç å€¼ä¹‹å‰éœ€è¦å…ˆåƒä¸‹é¢è¿™æ ·æ‰¾åˆ°<strong>å­ cookie</strong>:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SubCookieUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // getæ–¹æ³•ç”¨äºå–å¾—ä¸€ä¸ªå­cookieçš„å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subCookies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subCookies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subCookies[subName] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // getAllæ–¹æ³•ç”¨äºå–å¾—æ‰€æœ‰å­cookie</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieStart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cookieName),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieEbd,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      subCookies,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      parts,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cookieStart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cookieStart);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cookieEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cookieEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cookieStart, cookieName.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cookieEnd);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cookieValue.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subCookies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieValue.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&amp;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookies.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          parts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subCookies[i].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;=&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          result[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decodeURIComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parts[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> decodeURIComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parts[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç”¨äºè®¾ç½®é¡µé¢ä¸Šçš„å­cookieï¼Œæ¥å—å¤šä¸ªå‚æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	æ¥æ”¶å¤šä¸ªå‚æ•°:cookie åç§°ã€å­cookieçš„åç§°cookie å€¼ã€å¯é€‰çš„ Date å¯¹è±¡ç”¨äºè®¾ç½®cookieçš„è¿‡æœŸæ—¶é—´ã€å¯é€‰çš„cookieè·¯å¾„ã€å¯é€‰çš„cookieåŸŸå’Œå¯é€‰çš„å¸ƒå°”å€¼secureæ ‡å¿—ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	æ‰€æœ‰å¯é€‰å‚æ•°éƒ½ä½œç”¨äºcookieæœ¬èº«è€Œä¸æ˜¯å­cookieã€‚ä¸ºäº†åœ¨åŒä¸€ä¸ª cookie ä¸­å­˜å‚¨å¤šä¸ªå­ cookie,è·¯å¾„ã€å’Œ secure æ ‡å¿—ä¹Ÿå¿…é¡»ç›¸åŒã€‚è¿‡æœŸæ—¶é—´ä½œç”¨äºæ•´ä¸ª cookie,å¯ä»¥åœ¨å†™å…¥ä¸ªåˆ«å­ cookie æ—¶å¦è¡Œè®¾ç½®ã€‚åœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨,ç¬¬ä¸€æ­¥æ˜¯å–å¾—ç»™å®š cookie åç§°ä¸‹åŒ…å«çš„æ‰€æœ‰å­ cookieã€‚é€»è¾‘æˆ–æ“ä½œç¬¦(1)åœ¨è¿™é‡Œç”¨äºåœ¨ geta11 ()è¿”å› null çš„æƒ…å†µä¸‹å°† subcookies è®¾ç½®ä¸ºæ–°å¯¹è±¡ã€‚ç„¶å,åœ¨ subcookies ä¸Šè®¾cookie çš„å€¼ï¼Œå†å°†å‚æ•°ä¼ ç»™ setA11 ()ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subcookies[subName] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name, subcookies, expire, path, domain, secure);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	setal1()æ–¹æ³•æ¥æ”¶6ä¸ªå‚æ•°:cookie çš„åç§°ã€åŒ…å«æ‰€æœ‰å­ cookie çš„å¯¹è±¡,ç„¶åæ˜¯ set()æ–¹æ³•ä¸­ç”¨çš„4ä¸ªå¯é€‰å‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ for-in å¾ªç¯ä¸­è¿­ä»£ç¬¬äºŒä¸ªå‚æ•°çš„å±æ€§ã€‚ä¸ºä¿è¯åªå­˜å‚¨åˆé€‚çš„æ•°æ®è¿™é‡Œä½¿ç”¨äº† hasownProperty()æ–¹æ³•ç¡®ä¿åªæœ‰å®ä¾‹å±æ€§æ‰ä¼šåºåˆ—åŒ–ä¸ºå­ cookieã€‚å› ä¸ºå­˜åœ¨å±æ€§åç­‰ç©ºå­—ç¬¦ä¸²çš„å¯èƒ½,æ‰€ä»¥åœ¨æ·»åŠ åˆ° subcookieParts æ•°ç»„ä¹‹å‰ä¹Ÿè¦æ£€æŸ¥å±æ€§åçš„é•¿åº¦ã€‚subcookiepartæ•°ç»„åŒ…å«äº†å­ cookie çš„å/å€¼å¯¹,è¿™æ ·æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ join()æ–¹æ³•ç”¨å’Œå·å°†å®ƒä»¬æ‹¼æ¥æˆå­—ç¬¦ä¸²,ä¸‹çš„é€»è¾‘ä¸ cookieUtil.set()ä¸€æ ·</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subcookies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      subcookieParts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookies) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (subName.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasOwnProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subName)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subcookieParts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subcookies</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      subcookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subcookies</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&amp;\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (subcookieText.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookieParts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&amp;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (expires </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; expires=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expires</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toGMTString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (path) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; path=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (domain) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; domain=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (secure) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; secure\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`; expires=\${</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toGMTString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    document.cookie </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookieText;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä»cookieä¸­åˆ é™¤ä¸€ä¸ªå­cookie</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (subcookies) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subcookies[subName]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name, subcookies, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, path, domain, secure);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ é™¤æ•´ä¸ªcookie</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unsetAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">domain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), path, domain, secure);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>è¿™äº›æ–¹æ³•é€šè¿‡å¤„ç†è§£æå’Œ <strong>å­ cookie</strong> å­—ç¬¦ä¸²æ„å»º,ç®€åŒ–äº†ä½¿ç”¨ <strong>å­ cookie</strong> å­˜å‚¨æ•°æ®çš„æ“ä½œã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‡è®¾ document.cookie=data=name=Nicholas&amp;book=Professional20JavaScript</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//è®¾ç½®ä¸¤ä¸ªå­ cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;book&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Professional JavaScript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//è®¾ç½®æ‰€æœ‰å­ cookie å¹¶ä¼ å…¥è¿‡æœŸæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, book: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Professional JavaScript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;January 1,2010&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//ä¿®æ”¹&quot;name&quot;çš„å€¼å¹¶ä¿®æ”¹æ•´ä¸ªcookie çš„è¿‡æœŸæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Michael&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;February 1,2010&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åªåˆ é™¤&quot;name&quot;å­cookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubCookieUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ é™¤æ•´ä¸ªcookie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubCookieUti1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsetA11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div> <br><h2 id="_1-5-ä½¿ç”¨-cookie-çš„æ³¨æ„äº‹é¡¹" tabindex="-1">1.5 ä½¿ç”¨ cookie çš„æ³¨æ„äº‹é¡¹ <a class="header-anchor" href="#_1-5-ä½¿ç”¨-cookie-çš„æ³¨æ„äº‹é¡¹" aria-label="Permalink to &quot;1.5 ä½¿ç”¨ cookie çš„æ³¨æ„äº‹é¡¹&quot;">â€‹</a></h2><ol><li><strong>HTTP-only</strong> çš„ <strong>cookie</strong>ã€‚<strong>HTTP-only</strong> å¯ä»¥åœ¨æµè§ˆå™¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨è®¾ç½®ï¼Œä½†æ˜¯åªèƒ½åœ¨æœåŠ¡å™¨ä¸Šè¯»å–ï¼Œè¿™æ˜¯å› ä¸º JavaScript æ— æ³•å–å¾—è¿™ç§ <strong>cookie</strong> çš„å€¼</li><li>ä¸ºæ‰€æœ‰ <strong>cookie</strong> éƒ½ä¼šä½œä¸ºè¯·æ±‚å¤´éƒ¨ç”±æµè§ˆå™¨å‘é€ç»™æœåŠ¡å™¨,æ‰€ä»¥åœ¨ <strong>cookie</strong> ä¸­ä¿å­˜å¤§é‡ä¿¡æ¯å¯èƒ½ä¼šå½±å“ç‰¹å®šåŸŸæµè§ˆå™¨è¯·æ±‚çš„æ€§èƒ½ã€‚ä¿å­˜çš„ <strong>cookie</strong> è¶Šå¤§,è¯·æ±‚å®Œæˆçš„æ—¶é—´å°±è¶Šé•¿ã€‚å³ä½¿æµè§ˆå™¨å¯¹ <strong>cookie</strong> å¤§å°æœ‰é™åˆ¶,æœ€å¥½è¿˜æ˜¯å°½å¯èƒ½åªé€šè¿‡ <strong>cookie</strong> ä¿å­˜å¿…è¦ä¿¡æ¯,ä»¥é¿å…æ€§èƒ½é—®é¢˜ã€‚å¯¹ <strong>cookie</strong> çš„é™åˆ¶åŠå…¶ç‰¹æ€§å†³å®šäº† <strong>cookie</strong> å¹¶ä¸æ˜¯å­˜å‚¨å¤§é‡æ•°æ®çš„ç†æƒ³æ–¹å¼ã€‚å› æ­¤,å…¶ä»–å®¢æˆ·ç«¯å­˜å‚¨æŠ€æœ¯å‡ºç°äº†ã€‚</li><li>æ³¨æ„ ä¸è¦åœ¨ <strong>cookie</strong> ä¸­å­˜å‚¨é‡è¦æˆ–æ•æ„Ÿçš„ä¿¡æ¯ã€‚<strong>cookie</strong> æ•°æ®ä¸æ˜¯ä¿å­˜åœ¨å®‰å…¨çš„ç¯å¢ƒä¸­,å› æ­¤ä»»ä½•äººéƒ½å¯èƒ½è·å¾—ã€‚åº”è¯¥é¿å…æŠŠä¿¡ç”¨å¡å·æˆ–ä¸ªäººåœ°å€ç­‰ä¿¡æ¯ä¿å­˜åœ¨ <strong>cookie</strong> ä¸­ã€‚</li></ol><br><br><h1 id="_2-web-storage" tabindex="-1">2 Web Storage <a class="header-anchor" href="#_2-web-storage" aria-label="Permalink to &quot;2 Web Storage&quot;">â€‹</a></h1><p><strong>Web storage</strong> çš„ç›®çš„è§£å†³å®¢æˆ·æ®µå­˜å‚¨ä¸éœ€è¦é¢‘ç¹å‘é€å›æœåŠ¡å™¨çš„æ•°æ®æ—¶ä½¿ç”¨ cookie çš„é—®é¢˜ã€‚</p><p><strong>Web storage</strong> çš„ç›®çš„</p><ul><li>æä¾› cookie ä¹‹å¤–çš„å­˜å‚¨ä¼šè¯æ•°æ®çš„é€”å¾„ã€‚</li><li>æä¾›è·¨ä¼šè¯æŒä¹…åŒ–å­˜å‚¨å¤§é‡æ•°æ®çš„æœºå™¨ã€‚</li></ul><p><strong>Web storage</strong> åŒ…å«ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸¤ä¸ªå¯¹è±¡å‡ä¸å—é¡µé¢åˆ·æ–°è€Œå½±å“ã€‚</p><ul><li>localStorage æ°¸ä¹…å­˜å‚¨æœºåˆ¶</li><li>sessionStorage è·¨ä¼šè¯å­˜å‚¨æœºåˆ¶</li></ul><h2 id="_2-1-storage-çš„ç±»å‹" tabindex="-1">2.1 storage çš„ç±»å‹ <a class="header-anchor" href="#_2-1-storage-çš„ç±»å‹" aria-label="Permalink to &quot;2.1 storage çš„ç±»å‹&quot;">â€‹</a></h2><p><strong>storage</strong> ç±»å‹ç”¨äºä¿å­˜å/å€¼å¯¹æ•°æ®ï¼Œç›´è‡³å­˜å‚¨ç©ºé—´ä¸Šé™ï¼ˆç”±æµè§ˆå™¨å†³å®šï¼‰ã€‚<strong>storage</strong> å®ä¾‹ä¸å…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œä½†å¢åŠ äº†ä»¥ä¸‹æ–¹æ³•</p><ul><li><code>clear()</code> æ¸…é™¤æ‰€æœ‰å€¼ã€‚ä¸åœ¨ Firefox ä¸­å®ç°</li><li><code>getItem(name)</code> å–å¾—ç»™å®š name çš„å€¼</li><li><code>key(index)</code> å–å¾—ç»™å®šæ•°å€¼ä½ç½®çš„åç§°</li><li><code>removeItem(name)</code> åˆ é™¤ç»™å®š name çš„å/å€¼å¯¹</li><li><code>setItem(name,value)</code> è®¾å®šç»™å®š name çš„å€¼</li></ul><p>æ³¨æ„ï¼šé€šè¿‡ <strong>length</strong> å±æ€§å¯ä»¥ç¡®å®š <strong>Storage</strong> å¯¹è±¡ä¸­ä¿å­˜äº†å¤šå°‘å/å€¼å¯¹ã€‚ä½†æˆ‘ä»¬æ— æ³•ç¡®å®šå¯¹è±¡ä¸­æ‰€æœ‰æ•°æ®å ç”¨å¯¹ç©ºé—´å¤§å°ã€‚<strong>storage</strong> ç±»å‹åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œéå­—ç¬¦ä¸²åœ¨å­˜å‚¨ä¹‹å‰ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p><br><h2 id="_2-2-sessionstorage-å¯¹è±¡" tabindex="-1">2.2 sessionStorage å¯¹è±¡ <a class="header-anchor" href="#_2-2-sessionstorage-å¯¹è±¡" aria-label="Permalink to &quot;2.2 sessionStorage å¯¹è±¡&quot;">â€‹</a></h2><p><strong>sessionStorage</strong> å¯¹è±¡åªå­˜å‚¨ä¼šè¯æ•°æ®ï¼Œè¿™æ„å‘³ç€æ•°æ®åªä¼šå­˜å‚¨åˆ°æµè§ˆå™¨å…³é—­ã€‚è¿™è·Ÿæµè§ˆå™¨å…³é—­æ—¶ä¼šæ¶ˆå¤±çš„ä¼šè¯ <strong>cookie</strong> ç±»ä¼¼ã€‚</p><p>æ‰€æœ‰ç°ä»£æµè§ˆå™¨åœ¨å®ç°å­˜å‚¨å†™å…¥æ—¶éƒ½ä½¿ç”¨äº†åŒæ­¥é˜»å¡æ–¹å¼,å› æ­¤æ•°æ®ä¼šè¢«ç«‹å³æäº¤åˆ°å­˜å‚¨ã€‚å…·ä½“ API çš„å®ç°å¯èƒ½ä¸ä¼šç«‹å³æŠŠæ•°æ®å†™å…¥ç£ç›˜(è€Œæ˜¯ä½¿ç”¨æŸç§ä¸åŒçš„ç‰©ç†å­˜å‚¨ ),ä½†è¿™ä¸ªåŒºåˆ«åœ¨ JavaScript å±‚é¢æ˜¯ä¸å¯è§çš„ã€‚é€šè¿‡ Web Storage å†™å…¥çš„ä»»ä½•æ•°æ®éƒ½å¯ä»¥ç«‹å³è¢«è¯»å–ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ–¹æ³•å­˜å‚¨æ•°æ®ï¼Œä¸æ¨èé€šè¿‡å¯¹è±¡ç›´æ¥æ“ä½œsessionStorage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ–¹æ³•è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ–¹æ³•åˆ é™¤æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¯ä»¥ç»“åˆ <strong>sessionStorage</strong> çš„ length å±æ€§å’Œ <code>key()</code> æ–¹æ³•éå†æ‰€æœ‰çš„å€¼:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionstorage.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¿™é‡Œé€šè¿‡ <code>key()</code> å…ˆå–å¾—ç»™å®šä½ç½®ä¸­çš„æ•°æ®åç§°,ç„¶åä½¿ç”¨è¯¥åç§°é€šè¿‡ <code>getItem()</code> å–å¾—å€¼,å¯ä»¥ä¾æ¬¡è®¿é—® <strong>sessionStorage</strong> ä¸­çš„å/å€¼å¯¹ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionstorage) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div> <br><h2 id="_2-3-localstorage-å¯¹è±¡" tabindex="-1">2.3 localStorage å¯¹è±¡ <a class="header-anchor" href="#_2-3-localstorage-å¯¹è±¡" aria-label="Permalink to &quot;2.3 localStorage å¯¹è±¡&quot;">â€‹</a></h2><p><strong>localStorage</strong> å¯¹è±¡åœ¨å®¢æˆ·ç«¯æŒä¹…å­˜å‚¨æ•°æ®ã€‚è¦è®¿é—®åŒä¸€ä¸ª <strong>localStorage</strong> å¯¹è±¡ï¼Œé¡µé¢å¿…é¡»æ¥è‡ªåŒä¸€ä¸ªåŸŸï¼ˆå­åŸŸä¸å¯ä»¥ï¼‰ã€åœ¨ç›¸åŒçš„ç«¯å£ä¸Šä½¿ç”¨ç›¸åŒçš„åè®®ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ–¹æ³•å­˜å‚¨æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nicholas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ–¹æ³•è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ–¹æ³•åˆ é™¤æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div> <br><h2 id="_2-4-å­˜å‚¨äº‹ä»¶" tabindex="-1">2.4 å­˜å‚¨äº‹ä»¶ <a class="header-anchor" href="#_2-4-å­˜å‚¨äº‹ä»¶" aria-label="Permalink to &quot;2.4 å­˜å‚¨äº‹ä»¶&quot;">â€‹</a></h2><p>æ¯å½“ <strong>storage</strong> å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶,éƒ½ä¼šåœ¨æ–‡æ¡£ä¸Šè§¦å‘ <strong>storage</strong> äº‹ä»¶ã€‚ä½¿ç”¨å±æ€§æˆ– <code>setItem()</code> è®¾ç½®å€¼ã€ä½¿ç”¨ <code>removeItem()</code> åˆ é™¤å€¼,ä»¥åŠæ¯æ¬¡è°ƒç”¨ <code>clear()</code> æ—¶éƒ½ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚è¿™ä¸ªäº‹äº†äº‹ä»¶å¯¹è±¡æœ‰å¦‚ä¸‹ 4 ä¸ªå±æ€§ã€‚</p><ul><li><strong>domain:</strong> å­˜å‚¨å˜åŒ–å¯¹åº”çš„åŸŸã€‚</li><li><strong>key:</strong> è¢«è®¾ç½®æˆ–åˆ é™¤çš„é”®ã€‚</li><li><strong>newvalue:</strong> é”®è¢«è®¾ç½®çš„æ–°å€¼,è‹¥é”®è¢«åˆ é™¤åˆ™ä¸º nullã€‚</li><li><strong>olaValue:</strong> é”®å˜åŒ–ä¹‹å‰çš„å€¼ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ç›‘å¬ storage äº‹ä»¶ï¼Œ<a href="https://www.cnblogs.com/wanglei1900/p/17861751.html" target="_blank" rel="noreferrer">ğŸš€ ç«™å†…è·³è½¬ï¼Œå‰ç«¯å®ç°è·¨æ ‡ç­¾é¡µé€šä¿¡</a>:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯¹äºsessionstorageå’Œ localstorage ä¸Šçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šè§¦å‘storage äº‹ä»¶,ä½†storageäº‹ä»¶ä¸ä¼šåŒºåˆ†è¿™ä¸¤è€…ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;storage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;storage changed for $(event.domain) &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><br><h2 id="_2-5-é™åˆ¶" tabindex="-1">2.5 é™åˆ¶ <a class="header-anchor" href="#_2-5-é™åˆ¶" aria-label="Permalink to &quot;2.5 é™åˆ¶&quot;">â€‹</a></h2><p>ä¸å…¶ä»–å®¢æˆ·ç«¯æ•°æ®å­˜å‚¨æ–¹æ¡ˆä¸€æ ·,<strong>Web Storage</strong> ä¹Ÿæœ‰é™åˆ¶ã€‚å…·ä½“çš„é™åˆ¶å–å†³äºç‰¹å®šçš„æµè§ˆå™¨ã€‚-èˆ¬æ¥è¯´,å®¢æˆ·ç«¯æ•°æ®çš„å¤§å°é™åˆ¶æ˜¯æŒ‰ç…§æ¯ä¸ªæº(åè®®ã€åŸŸå’Œç«¯å£)æ¥è®¾ç½®çš„,å› æ­¤æ¯ä¸ªæºæœ‰å›ºå®šå¤§å°çš„æ•°æ®å­˜å‚¨ç©ºé—´ã€‚åˆ†æå­˜å‚¨æ•°æ®çš„é¡µé¢çš„æºå¯ä»¥åŠ å¼ºè¿™ä¸€é™åˆ¶ã€‚ä¸åŒæµè§ˆå™¨ç»™ <strong>localstorage</strong> å’Œ <strong>sessionStorage</strong> è®¾ç½®äº†ä¸åŒçš„ç©ºé—´é™åˆ¶,ä½†å¤§å¤šæ•°ä¼šé™åˆ¶ä¸ºæ¯ä¸ªæº 5MBã€‚</p><br><br><h1 id="_3-indexeddb" tabindex="-1">3 IndexedDB <a class="header-anchor" href="#_3-indexeddb" aria-label="Permalink to &quot;3 IndexedDB&quot;">â€‹</a></h1><p>Indexed Database API ç®€ç§° <strong>IndexedDB</strong>,<strong>æ˜¯æµè§ˆå™¨ä¸­å­˜å‚¨ç»“æ„åŒ–æ•°æ®çš„ä¸€ä¸ªæ–¹æ¡ˆã€‚IndexedDB</strong> ç”¨äºæ›¿ç›®å‰å·²åºŸå¼ƒçš„ Web SQLDatabase APIã€‚<strong>IndexedDB</strong> èƒŒåçš„æ€æƒ³æ˜¯åˆ›é€ ä¸€å¥— API,æ–¹ä¾¿ JavaScript å¯¹è±¡çš„å­˜å‚¨å’Œè·å–,åŒæ—¶ä¹Ÿæ”¯æŒæŸ¥è¯¢å’Œæœç´¢ã€‚ <strong>IndexedDB</strong> çš„è®¾è®¡å‡ ä¹å®Œå…¨æ˜¯å¼‚æ­¥çš„ã€‚ä¸ºæ­¤,å¤§å¤šæ•°æ“ä½œä»¥è¯·æ±‚çš„å½¢å¼æ‰§è¡Œ,è¿™äº›è¯·æ±‚ä¼šå¼‚æ­¥æ‰§è¡Œäº§ç”ŸæˆåŠŸçš„ç»“æœæˆ–é”™è¯¯ã€‚ç»å¤§å¤šæ•° <strong>IndexedDB</strong> æ“ä½œè¦æ±‚æ·»åŠ  <code>onerror</code> å’Œ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºæ¥å®šè¾“å‡ºã€‚ 2017 å¹´,æ–°å‘å¸ƒçš„ä¸»æµæµè§ˆå™¨(Chromeã€Firefoxã€Operaã€Safari)å®Œå…¨æ”¯æŒ IndexedDB,IEI0! å’Œ Edge æµè§ˆå™¨éƒ¨åˆ†æ”¯æŒ <strong>IndexedDB</strong>ã€‚</p><h2 id="_3-1-æ•°æ®åº“" tabindex="-1">3.1 æ•°æ®åº“ <a class="header-anchor" href="#_3-1-æ•°æ®åº“" aria-label="Permalink to &quot;3.1 æ•°æ®åº“&quot;">â€‹</a></h2><p><strong>IndexedDB</strong> æ˜¯ç±»ä¼¼äº MySQL æˆ– Web SQL Database çš„æ•°æ®åº“ã€‚ä¸ä¼ ç»Ÿæ•°æ®åº“æœ€å¤§çš„åŒºåˆ«åœ¨äº indexedDB ä½¿ç”¨å¯¹è±¡å­˜å‚¨è€Œä¸æ˜¯è¡¨æ ¼ä¿å­˜æ•°æ®ã€‚<strong>IndexedDB</strong> æ•°æ®åº“å°±æ˜¯åœ¨ä¸€ä¸ªå…¬å…±å‘½åç©ºé—´ä¸‹çš„ä¸€ç»„å¯¹è±¡å­˜å‚¨,ç±»ä¼¼äº NoSQL é£æ ¼çš„å®ç°ã€‚ä½¿ç”¨ <strong>IndexedDB</strong> æ•°æ®åº“çš„ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨ <code>indexedD.open()</code> æ–¹æ³•,å¹¶ç»™å®ƒä¼ äººä¸€ä¸ªè¦æ‰“å¼€çš„æ•°æ®åº“åç§°ã€‚å¦‚æœç»™å®šåç§°çš„æ•°æ®åº“å·²å­˜åœ¨,åˆ™ä¼šå‘é€ä¸€ä¸ªæ‰“å¼€å®ƒçš„è¯·æ±‚;å¦‚æœä¸å­˜åœ¨,åˆ™ä¼šå‘é€åˆ›å»ºå¹¶æ‰“å¼€è¿™ä¸ªæ•°æ®åº“çš„è¯·æ±‚ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¿”å› <strong>IDBRequest</strong> çš„å®ä¾‹,å¯ä»¥åœ¨è¿™ä¸ªå®ä¾‹ä¸Šæ·»åŠ  <code>onerror</code> å’Œ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä¸¾ä¾‹å¦‚ä¸‹:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  request,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexedDB.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, version);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Failed to open: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">errorCode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ä»¥å‰ï¼Œ<strong>IndexedDB</strong> ä½¿ç”¨ <code>setVersion()</code> æ–¹æ³•æŒ‡å®šç‰ˆæœ¬å·ã€‚è¿™ä¸ªæ–¹æ³•ç›®å‰å·²åºŸå¼ƒã€‚å¦‚å‰é¢ä»£ç æ‰€ç¤º,è¦åœ¨æ‰“å¼€æ•°æ®åº“çš„æ—¶å€™æŒ‡å®šç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬å·ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª unsigned long long æ•°å€¼,å› æ­¤ä¸è¦ä½¿ç”¨å°æ•°ï¼Œè€Œè¦ä½¿ç”¨æ•´æ•°ã€‚åœ¨ä¸¤ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºä¸­,<code>event.target</code> éƒ½æŒ‡å‘ <strong>request</strong>,å› æ­¤ä½¿ç”¨å“ªä¸ªéƒ½å¯ä»¥ã€‚å¦‚æœ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºè¢«è°ƒç”¨,è¯´æ˜å¯ä»¥é€šè¿‡ <code>event.target.result</code> è®¿é—®æ•°æ®åº“(<strong>IDBDatabase</strong>)å®ä¾‹äº†,è¿™ä¸ªå®ä¾‹ä¼šä¿å­˜åˆ° db å˜é‡ä¸­ã€‚ä¹‹å,æ‰€æœ‰ä¸æ•°æ®åº“ç›¸å…³çš„æ“ä½œéƒ½è¦é€šè¿‡ db å¯¹è±¡æœ¬èº«æ¥è¿›è¡Œã€‚å¦‚æœæ‰“å¼€æ•°æ®åº“æœŸé—´å‘ç”Ÿé”™è¯¯, <code>event.target.errorcode</code> ä¸­å°±ä¼šå­˜å‚¨è¡¨ç¤ºé—®é¢˜çš„é”™è¯¯ç ã€‚</p><br><h2 id="_3-2-å¯¹è±¡å­˜å‚¨" tabindex="-1">3.2 å¯¹è±¡å­˜å‚¨ <a class="header-anchor" href="#_3-2-å¯¹è±¡å­˜å‚¨" aria-label="Permalink to &quot;3.2 å¯¹è±¡å­˜å‚¨&quot;">â€‹</a></h2><p>å»ºç«‹äº†æ•°æ®åº“è¿æ¥ä¹‹å,ä¸‹ä¸€æ­¥å°±æ˜¯ä½¿ç”¨å¯¹è±¡å­˜å‚¨ã€‚å¦‚æœæ•°æ®åº“ç‰ˆæœ¬ä¸æœŸå¾…çš„ä¸ä¸€è‡´,é‚£å¯èƒ½éœ€è¦åˆ›å»ºå¯¹è±¡å­˜å‚¨ã€‚ä¸è¿‡ï¼Œåœ¨åˆ›å»ºå¯¹è±¡å­˜å‚¨å‰,æœ‰å¿…è¦æƒ³ä¸€æƒ³è¦å­˜å‚¨ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚</p><p>å‡è®¾è¦å­˜å‚¨åŒ…å«ç”¨æˆ·åã€å¯†ç ç­‰å†…å®¹çš„ç”¨æˆ·è®°å½•ã€‚å¯ä»¥ç”¨å¦‚ä¸‹å¯¹è±¡æ¥è¡¨ç¤ºä¸€æ¡è®°å½•:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { username: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, firstName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;James&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lastName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Bond&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, password: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>è§‚å¯Ÿè¿™ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºæœ€é€‚åˆä½œä¸ºå¯¹è±¡å­˜å‚¨é”®çš„ username å±æ€§ã€‚ç”¨æˆ·åå¿…é¡»å…¨å±€å”¯ä¸€å®ƒä¹Ÿæ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹è®¿é—®æ•°æ®çš„å‡­æ®ã€‚<strong>è¿™ä¸ªé”®å¾ˆé‡è¦,å› ä¸ºåˆ›å»ºå¯¹è±¡å­˜å‚¨æ—¶å¿…é¡»æŒ‡å®šä¸€ä¸ªé”®ã€‚</strong></p><p>æ•°æ®åº“çš„ç‰ˆæœ¬å†³å®šäº†æ•°æ®åº“æ¨¡å¼,åŒ…æ‹¬æ•°æ®åº“ä¸­çš„å¯¹è±¡å­˜å‚¨å’Œè¿™äº›å¯¹è±¡å­˜å‚¨çš„ç»“æ„ã€‚å¦‚æœæ•°æ®åº“è¿˜ä¸å­˜åœ¨, <code>open()</code> æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°æ®åº“,ç„¶åè§¦å‘ <code>upgradeneeded</code> äº‹ä»¶ã€‚å¯ä»¥ä¸ºè¿™ä¸ªäº‹ä»¶è®¾ç½®å¤„ç†ç¨‹åºã€å¹¶åœ¨å¤„ç†ç¨‹åºä¸­åˆ›å»ºæ•°æ®åº“æ¨¡å¼ã€‚å¦‚æœæ•°æ®åº“å­˜åœ¨,è€Œä½ æŒ‡å®šäº†ä¸€ä¸ªå‡çº§ç‰ˆçš„ç‰ˆæœ¬å·,åˆ™ä¼šå³è§¦å‘ <code>upgradeneeded</code> äº‹ä»¶,å› è€Œå¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ›´æ–°æ•°æ®åº“æ¨¡å¼ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†ä¸ºå­˜å‚¨ä¸Šè¿°ç”¨æˆ·ä¿¡æ¯å¦‚ä½•åˆ›å»ºå¯¹è±¡å­˜å‚¨:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onupgradeneeded</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¦‚æœå­˜åœ¨åˆ™åˆ é™¤å½“å‰ objectStoreã€‚æµ‹è¯•çš„æ—¶å€™å¯ä»¥è¿™æ ·åš</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½†è¿™æ ·ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œäº‹ä»¶å¤„ç†ç¨‹åºæ—¶åˆ é™¤å·²æœ‰æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (db.objectStoreNames.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°çš„ keyPath å±æ€§è¡¨ç¤ºåº”è¯¥ç”¨ä½œé”®çš„å­˜å‚¨å¯¹è±¡çš„å±æ€§åã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { keyPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><br><h2 id="_3-3-äº‹åŠ¡" tabindex="-1">3.3 äº‹åŠ¡ <a class="header-anchor" href="#_3-3-äº‹åŠ¡" aria-label="Permalink to &quot;3.3 äº‹åŠ¡&quot;">â€‹</a></h2><p>åˆ›å»ºäº†å¯¹è±¡å­˜å‚¨ä¹‹å,å‰©ä¸‹çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡äº‹åŠ¡å®Œæˆçš„ã€‚äº‹åŠ¡è¦é€šè¿‡è°ƒç”¨æ•°æ®åº“å¯¹è±¡çš„ <code>transaction()</code> æ–¹æ³•åˆ›å»ºã€‚ä»»ä½•æ—¶å€™,åªè¦æƒ³è¦è¯»å–æˆ–ä¿®æ”¹æ•°æ®,éƒ½è¦é€šè¿‡äº‹åŠ¡æŠŠæ‰€æœ‰ä¿®æ”¹æ“ä½œç»„ç»‡èµ·æ¥ã€‚æœ€ç®€å•çš„æƒ…å†µä¸‹,å¯ä»¥åƒä¸‹é¢è¿™æ ·åˆ›å»ºäº‹åŠ¡: <code>let transaction = db.transaction()</code> å¦‚æœä¸æŒ‡å®šå‚æ•°,åˆ™å¯¹æ•°æ®åº“ä¸­æ‰€æœ‰çš„å¯¹è±¡å­˜å‚¨æœ‰åªè¯»æƒé™ã€‚æ›´å…·ä½“çš„æ–¹å¼æ˜¯æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªè¦è®¿é—®çš„å¯¹è±¡å­˜å‚¨çš„åç§°: <code>let transaction = db.transaction(&quot;users&quot;)</code> è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨äº‹åŠ¡æœŸé—´åªåŠ è½½ users å¯¹è±¡å­˜å‚¨çš„ä¿¡æ¯ã€‚å¦‚æœæƒ³è¦è®¿é—®å¤šä¸ªå¯¹è±¡å­˜å‚¨,å¯ä»¥ç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¼ äººä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„: <code>let transaction = db.transaction([&quot;users&quot;,&quot;anotherStore&quot;])</code> å¦‚å‰æ‰€è¿°,æ¯ä¸ªäº‹åŠ¡éƒ½ä»¥åªè¯»æ–¹å¼è®¿é—®æ•°æ®ã€‚è¦ä¿®æ”¹è®¿é—®æ¨¡å¼,å¯ä»¥ä¼ äººç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°åº”è¯¥æ˜¯ä¸‹åˆ—ä¸‰ä¸ªå­—ç¬¦ä¸²ä¹‹ä¸€:&quot;readonly&quot;ã€&quot;readwrite&quot;æˆ–&quot;versionchange&quot;ã€‚æ¯”å¦‚: <code>let transaction = db.transaction([&quot;users&quot;], &quot;readwrite&quot;)</code> è¿™æ ·äº‹åŠ¡å°±å¯ä»¥å¯¹ users å¯¹è±¡å­˜å‚¨è¯»å†™äº†ã€‚æœ‰äº†äº‹åŠ¡çš„å¼•ç”¨,å°±å¯ä»¥ä½¿ç”¨ <code>objectStore()</code>æ–¹æ³•å¹¶ä¼ äººå¯¹è±¡å­˜å‚¨çš„åç§°ä»¥è®¿é—®ç‰¹å®šçš„å¯¹è±¡å­˜å‚¨ç„¶å,å¯ä»¥ä½¿ç”¨ <code>add()</code> å’Œ <code>put()</code> æ–¹æ³•æ·»åŠ å’Œæ›´æ–°å¯¹è±¡,ä½¿ç”¨ <code>get()</code>å–å¾—å¯¹è±¡,ä½¿ç”¨ <code>delete()</code> åˆ é™¤å¯¹è±¡ä½¿ç”¨ <code>clear()</code> åˆ é™¤æ‰€æœ‰å¯¹è±¡ã€‚å…¶ä¸­, <code>get()</code> å’Œ <code>delete()</code> æ–¹æ³•éƒ½æ¥æ”¶å¯¹è±¡é”®ä½œä¸ºå‚æ•°,è¿™ 5 ä¸ªæ–¹æ³•éƒ½åˆ›å»ºæ–°çš„è¯·æ±‚å¯¹è±¡ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Did not get the object!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event, target, result.firstName);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å› ä¸ºä¸€ä¸ªäº‹åŠ¡å¯ä»¥å®Œæˆä»»æ„å¤šä¸ªè¯·æ±‚,æ‰€ä»¥äº‹åŠ¡å¯¹è±¡æœ¬èº«ä¹Ÿæœ‰äº‹ä»¶å¤„ç†ç¨‹åº:<code>onerror</code> å’Œ <code>oncomplete</code> ã€‚è¿™ä¸¤ä¸ªäº‹ä»¶å¯ä»¥ç”¨æ¥è·å–äº‹åŠ¡çº§çš„çŠ¶æ€ä¿¡æ¯:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //æ•´ä¸ªäº‹åŠ¡è¢«å–æ¶ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oncomplete</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //æ•´ä¸ªäº‹åŠ¡æˆåŠŸå®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ³¨æ„,ä¸èƒ½é€šè¿‡ <code>oncomplete</code> äº‹ä»¶å¤„ç†ç¨‹åºçš„ event å¯¹è±¡è®¿é—® <code>get()</code> è¯·æ±‚è¿”å›çš„ä»»ä½•æ•°æ®ã€‚å› æ­¤ä»ç„¶éœ€è¦é€šè¿‡è¿™äº›è¯·æ±‚çš„ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºæ¥è·å–æ•°æ®ã€‚</p><br><h2 id="_3-4-æ’å…¥å¯¹è±¡" tabindex="-1">3.4 æ’å…¥å¯¹è±¡ <a class="header-anchor" href="#_3-4-æ’å…¥å¯¹è±¡" aria-label="Permalink to &quot;3.4 æ’å…¥å¯¹è±¡&quot;">â€‹</a></h2><p>æ‹¿åˆ°äº†å¯¹è±¡å­˜å‚¨çš„å¼•ç”¨å,å°±å¯ä»¥ä½¿ç”¨ <code>add()</code> æˆ– <code>put()</code> å†™äººæ•°æ®äº†ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°,å³è¦å­˜å‚¨çš„å¯¹è±¡,å¹¶æŠŠå¯¹è±¡ä¿å­˜åˆ°å¯¹è±¡å­˜å‚¨ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•åªåœ¨å¯¹è±¡å­˜å‚¨ä¸­å·²å­˜åœ¨åŒåçš„é”®æ—¶æœ‰åŒºåˆ«ã€‚è¿™ç§æƒ…å†µä¸‹, <code>add()</code> ä¼šå¯¼è‡´é”™è¯¯,è€Œ <code>put()</code> ä¼šç®€å•åœ°é‡å†™è¯¥å¯¹è±¡ã€‚æ›´ç®€å•åœ°è¯´,å¯ä»¥æŠŠ <code>add()</code> æƒ³è±¡æˆæ’å…¥æ–°å€¼,è€ŒæŠŠ <code>put()</code> æƒ³è±¡ä¸ºæ›´æ–°å€¼ã€‚å› æ­¤ç¬¬ä¸€æ¬¡åˆå§‹åŒ–å¯¹è±¡å­˜å‚¨æ—¶,å¯ä»¥è¿™æ ·åš:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// users æ˜¯ä¸€ä¸ªç”¨æˆ·æ•°æ®çš„æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ¯æ¬¡ç”¨ <code>add()</code> æˆ– <code>put()</code> éƒ½ä¼šåˆ›å»ºå¯¹è±¡å­˜å‚¨çš„æ–°æ›´æ–°è¯·æ±‚ã€‚å¦‚æœæƒ³éªŒè¯è¯·æ±‚æˆåŠŸä¸å¦,å¯ä»¥æŠŠè¯·æ±‚å¯¹è±¡ä¿å­˜åˆ°ä¸€ä¸ªå˜é‡,ç„¶åä¸ºå®ƒæ·»åŠ  <code>onerror</code> å’Œ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åº:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// users æ˜¯ä¸€ä¸ªç”¨æˆ·æ•°æ®çš„æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ›å»ºå¹¶å¡«å……äº†æ•°æ®åï¼Œå°±å¯ä»¥æŸ¥è¯¢å¯¹è±¡å­˜å‚¨äº†,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  requests </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  requests.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><br><h2 id="_3-5-é€šè¿‡æ¸¸æ ‡æŸ¥è¯¢" tabindex="-1">3.5 é€šè¿‡æ¸¸æ ‡æŸ¥è¯¢ <a class="header-anchor" href="#_3-5-é€šè¿‡æ¸¸æ ‡æŸ¥è¯¢" aria-label="Permalink to &quot;3.5 é€šè¿‡æ¸¸æ ‡æŸ¥è¯¢&quot;">â€‹</a></h2><p>ä½¿ç”¨äº‹åŠ¡å¯ä»¥é€šè¿‡ä¸€ä¸ªå·²çŸ¥é”®å–å¾—ä¸€æ¡è®°å½•ã€‚å¦‚æœæƒ³å–å¾—å¤šæ¡æ•°æ®,åˆ™éœ€è¦åœ¨äº‹åŠ¡ä¸­åˆ›å»ºä¸€ä¸ªæ¸¸æ ‡ã€‚æ¸¸æ ‡æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æœé›†çš„æŒ‡é’ˆã€‚ä¸ä¼ ç»Ÿæ•°æ®åº“æŸ¥è¯¢ä¸åŒ,æ¸¸æ ‡ä¸ä¼šäº‹å…ˆæ”¶é›†æ‰€æœ‰ç»“æœã€‚ç›¸å,æ¸¸æ ‡æŒ‡å‘ç¬¬ä¸€ä¸ªç»“æœï¼Œå¹¶åœ¨æ¥åˆ°æŒ‡ä»¤å‰ä¸ä¼šä¸»åŠ¨æŸ¥æ‰¾ä¸‹ä¸€æ¡æ•°æ®ã€‚éœ€è¦åœ¨å¯¹è±¡å­˜å‚¨ä¸Šè°ƒç”¨ <code>openCursor()</code> æ–¹æ³•åˆ›å»ºæ¸¸æ ‡ã€‚ä¸å…¶ä»– <strong>IndexedDB</strong> æ“ä½œ-æ ·, <code>opencursor()</code> æ–¹æ³•ä¹Ÿè¿”å›ä¸€ä¸ªè¯·æ±‚ï¼Œå› æ­¤å¿…é¡»ä¸ºå®ƒæ·»åŠ  <code>onsuccess</code> å’Œ <code>onerror</code> äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä¾‹å¦‚:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //å¤„ç†é”™è¯¯:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åœ¨è°ƒç”¨ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºæ—¶,å¯ä»¥é€šè¿‡ <code>event.target.result</code> è®¿é—®å¯¹è±¡å­˜å‚¨ä¸­çš„ä¸‹-æ¡è®°å½•,è¿™ä¸ªå±æ€§ä¸­ä¿å­˜ç€ <strong>IDBCursor</strong> çš„å®ä¾‹( æœ‰ä¸‹ä¸€æ¡è®°å½•æ—¶ )æˆ– nul1( æ²¡æœ‰è®°å½•æ—¶ )ã€‚è¿™ä¸ª <strong>IDEcurso</strong> å®ä¾‹æœ‰å‡ ä¸ªå±æ€§ã€‚</p><ul><li><strong>airection:</strong> å­—ç¬¦ä¸²å¸¸é‡,è¡¨ç¤ºæ¸¸æ ‡çš„å‰è¿›æ–¹å‘ä»¥åŠæ˜¯å¦åº”è¯¥éå†æ‰€æœ‰é‡å¤çš„å€¼ã€‚å¯èƒ½çš„å€¼åŒ…æ‹¬ NEX(&quot;next&quot;)ã€NEXTUNIQUE(&quot;nextunique&quot; )ã€PREV(&quot;prev&quot; )ã€PREVUNIQUE(&quot;prevunique&quot;)</li><li><strong>key:</strong> å¯¹è±¡çš„é”®ã€‚</li><li><strong>value:</strong> å®é™…çš„å¯¹è±¡ã€‚</li><li><strong>primaryKey:</strong> æ¸¸æ ‡ä½¿ç”¨çš„é”®ã€‚å¯èƒ½æ˜¯å¯¹è±¡é”®æˆ–ç´¢å¼•é”®(ç¨åè®¨è®º )ã€‚å¯ä»¥åƒä¸‹é¢è¿™æ ·å–å¾—ä¸€ä¸ªç»“æœ:</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cursor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //æ°¸è¿œè¦æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Key: $(cursor,key), Value: $(JSON,stringify(cursor.value)}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ³¨æ„,è¿™ä¸ªä¾‹å­ä¸­çš„ <code>cursor.value</code> ä¿å­˜ç€å®é™…çš„å¯¹è±¡ã€‚æ­£å› ä¸ºå¦‚æ­¤, JSON æ¥ç¼–ç ã€‚åœ¨æ˜¾ç¤ºå®ƒä¹‹å‰æ‰éœ€è¦ä½“æ¸¸æ ‡å¯ç”¨äºæ›´æ–°ä¸ªåˆ«è®°å½•ã€‚<code>update()</code>æ–¹æ³•ä½¿ç”¨æŒ‡å®šçš„å¯¹è±¡æ›´æ–°å½“å‰æ¸¸æ ‡å¯¹åº”çš„å€¼ã€‚ä¸å…¶ä»–ç±»ä¼¼-æ ·,ç”¨ <code>update()</code> ä¼šåˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚,å› æ­¤å¦‚æœæƒ³çŸ¥é“ç»“æœ,éœ€è¦ä¸º <code>onsuccess</code> å’Œ <code>onerror</code></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cursor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value, updateRequest;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //æ°¸è¿œè¦æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cursor.value; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å–å¾—å½“å‰å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      value.password </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;magic!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      updateRequest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cursor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯·æ±‚ä¿å­˜æ›´æ–°åçš„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      updateRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      updateRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ä¹Ÿå¯ä»¥è°ƒç”¨ <code>delelte()</code> æ¥åˆ é™¤æ¸¸æ ‡ä½ç½®çš„è®°å½•,ä¸ <code>update()</code> ä¸€æ ·,è¿™ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªè¯·æ±‚:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cursor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value, deleteRequest;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //æ°¸è¿œè¦æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      deleteRequest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cursor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯·æ±‚åˆ é™¤å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      deleteRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      deleteRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>å¦‚æœäº‹åŠ¡æ²¡æœ‰ä¿®æ”¹å¯¹è±¡å­˜å‚¨çš„æƒé™,<code>update()</code>å’Œ <code>delete()</code>éƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ¸¸æ ‡åªä¼šåˆ›å»ºä¸€ä¸ªè¯·æ±‚ã€‚è¦åˆ›å»ºå¦ä¸€ä¸ªè¯·æ±‚,å¿…é¡»è°ƒç”¨ä¸‹åˆ—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><ul><li><strong>continue(key):</strong> ç§»åŠ¨åˆ°ç»“æœé›†ä¸­çš„ä¸‹ä¸€æ¡è®°å½•ã€‚å‚æ•° key æ˜¯å¯é€‰çš„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š key,æ¸¸æ ‡å°±ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡è®°å½•;å¦‚æœæŒ‡å®šäº†,åˆ™æ¸¸æ ‡ç§»åŠ¨åˆ°æŒ‡å®šçš„é”®ã€‚</li><li><strong>advance(count):</strong> æ¸¸æ ‡å‘å‰ç§»åŠ¨æŒ‡å®šçš„ count æ¡è®°å½•ã€‚</li></ul><p>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè®©æ¸¸æ ‡é‡ç”¨ç›¸åŒçš„è¯·æ±‚,å› æ­¤ä¹Ÿä¼šé‡ç”¨ <code>onsuccess</code> å’Œ <code>onerror</code> å¤„ç†ç¨‹åº,ç›´è‡³ä¸å†éœ€è¦ã€‚ä¾‹å¦‚,ä¸‹é¢çš„ä»£ç è¿­ä»£äº†ä¸€ä¸ªå¯¹è±¡å­˜å‚¨ä¸­çš„æ‰€æœ‰è®°å½•:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cursor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //æ°¸è¿œè¦æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Key: $(cursor,key), Value: $(JSON,stringify(cursor.value)}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cursor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Done&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è°ƒç”¨ <code>cursor.continue()</code> ä¼šè§¦å‘å¦ä¸€ä¸ªè¯·æ±‚å¹¶å†æ¬¡è°ƒç”¨ <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºã€‚åœ¨æ²¡æœ‰æ›´å¤šè®°å½•æ—¶,<code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºæœ€åä¸€æ¬¡è¢«è°ƒç”¨,æ­¤æ—¶ <code>event.target.result</code> ç­‰äº nullã€‚</p><br><h2 id="_3-6-é”®èŒƒå›´" tabindex="-1">3.6 é”®èŒƒå›´ <a class="header-anchor" href="#_3-6-é”®èŒƒå›´" aria-label="Permalink to &quot;3.6 é”®èŒƒå›´&quot;">â€‹</a></h2><p>ä½¿ç”¨æ¸¸æ ‡ä¼šç»™äººä¸€ç§ä¸å¤ªç†æƒ³çš„æ„Ÿè§‰,å› ä¸ºè·å–æ•°æ®çš„æ–¹å¼å—åˆ°äº†é™åˆ¶ã€‚ä½¿ç”¨é”®èŒƒå›´(key range)å¯ä»¥è®©æ¸¸æ ‡æ›´å®¹æ˜“ç®¡ç†ã€‚é”®èŒƒå›´å¯¹åº” IDBeyRange çš„å®ä¾‹ã€‚æœ‰å››ç§æ–¹å¼æŒ‡å®šé”®èŒƒå›´,ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ <code>only() </code>æ–¹æ³•å¹¶ä¼ äººæƒ³è¦è·å–çš„é”®: <code>const onlyRange = IDBKeyRange.only(&quot;007&quot;);</code> è¿™ä¸ªèŒƒå›´ä¿è¯åªè·å–é”®ä¸º&quot;007&quot;çš„å€¼ã€‚ä½¿ç”¨è¿™ä¸ªèŒƒå›´åˆ›å»ºçš„æ¸¸æ ‡ç±»ä¼¼äºç›´æ¥è®¿é—®å¯¹è±¡å­˜å‚¨å¹¶è°ƒç”¨ get(&quot;007&quot;)ã€‚</p><p>ç¬¬äºŒç§é”®èŒƒå›´å¯ä»¥å®šä¹‰ç»“æœé›†çš„ä¸‹é™ã€‚ä¸‹é™è¡¨ç¤ºæ¸¸æ ‡å¼€å§‹çš„ä½ç½®ã€‚ä¾‹å¦‚,ä¸‹é¢çš„é”®èŒƒå›´ä¿è¯æ¸¸æ ‡ä»&quot;007&quot;è¿™ä¸ªé”®å¼€å§‹,ç›´åˆ°æœ€å: // ä»&quot;007&quot;è®°å½•å¼€å§‹ï¼Œç›´åˆ°æœ€å <code>const lowerRange = IDBKeyRange.lowerBound(&quot;007&quot;);</code></p><p>å¦‚æœæƒ³ä»&quot;007&quot;åé¢çš„è®°å½•å¼€å§‹,å¯ä»¥å†ä¼ äººç¬¬äºŒä¸ªå‚æ•° true: // ä»&quot;007&quot;åé¢çš„è®°å½•å¼€å§‹ï¼Œç›´åˆ°æœ€å <code>const lowerRange = IDBKeyRange.lowerBound(&quot;007&quot;, true);</code></p><p>ç¬¬ä¸‰ç§é”®èŒƒå›´å¯ä»¥å®šä¹‰ç»“æœé›†çš„ä¸Šé™,é€šè¿‡è°ƒç”¨ upperBound()æ–¹æ³•å¯ä»¥æŒ‡å®šæ¸¸æ ‡ä¸ä¼šè¶Šè¿‡çš„è®°å½•ã€‚ä¸‹é¢çš„é”®èŒƒå›´ä¿è¯æ¸¸æ ‡ä»å¤´å¼€å§‹å¹¶åœ¨åˆ°è¾¾é”®ä¸º&quot;ace&quot;çš„è®°å½•åœæ­¢: // ä»å¤´å¼€å§‹,åˆ°&quot;ace&quot;è®°å½•ä¸ºæ­¢ <code>const upperRange = IDBKeyRange.upperBound(&quot;ace&quot;)</code></p><p>å¦‚æœä¸æƒ³åŒ…å«æŒ‡å®šçš„é”®,å¯ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¼ äºº true: // ä»å¤´å¼€å§‹,åˆ°&quot;ace&quot;çš„å‰ä¸€æ¡è®°å½•ä¸ºæ­¢ <code>const upperRange = IDBKeyRange.upperBound(&quot;ace&quot;, true)</code></p><p>è¦åŒæ—¶æŒ‡å®šä¸‹é™å’Œä¸Šé™,å¯ä»¥ä½¿ç”¨ bouna()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶å››ä¸ªå‚æ•°:ä¸‹é™çš„é”®ã€ä¸Šé™çš„é”®ã€å¯é€‰çš„å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦è·³è¿‡ä¸‹é™å’Œå¯é€‰çš„å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦è·³è¿‡ä¸Šé™ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¾‹å­:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//ä»â€œ007&quot;è®°å½•å¼€å§‹,åˆ°â€˜aceâ€™è®°å½•åœæ­¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boundRange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDBKeyRange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//ä»â€œ007â€çš„ä¸‹ä¸€æ¡è®°å½•å¼€å§‹,åˆ°â€˜aceâ€™è®°å½•åœæ­¢,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boundRange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDBKeyRange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä»â€œ007â€çš„ä¸‹ä¸€æ¡è®°å½•å¼€å§‹,åˆ°â€˜aceâ€™çš„å‰ä¸€æ¡è®°å½•åœæ­¢,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boundRange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDBKeyRange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä»â€œ007â€è®°å½•å¼€å§‹,åˆ°â€˜aceâ€™çš„å‰ä¸€æ¡è®°å½•åœæ­¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boundRange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDBKeyRange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å®šä¹‰äº†èŒƒå›´ä¹‹å,æŠŠå®ƒä¼ ç»™ <code>opencursor()</code> æ–¹æ³•,å°±å¯ä»¥å¾—åˆ°ä½äºè¯¥èŒƒå›´å†…çš„æ¸¸æ ‡:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDBKeyRange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(range);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cursor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cursor) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //æ°¸è¿œè¦æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Key: $(cursor,key), Value: $(JSON,stringify(cursor.value)}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cursor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Done&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>è¿™ä¸ªä¾‹å­åªä¼šè¾“å‡ºä»é”®ä¸º&quot;007&quot;çš„è®°å½•å¼€å§‹åˆ°é”®ä¸º&quot;ace&quot;çš„è®°å½•ç»“æŸçš„å¯¹è±¡,æ¯”ä¸Šä¸€èŠ‚çš„ä¾‹å­è¦å°‘ã€‚</p><br><h2 id="_3-7-è®¾ç½®æ¸¸æ ‡æ–¹å‘" tabindex="-1">3.7 è®¾ç½®æ¸¸æ ‡æ–¹å‘ <a class="header-anchor" href="#_3-7-è®¾ç½®æ¸¸æ ‡æ–¹å‘" aria-label="Permalink to &quot;3.7 è®¾ç½®æ¸¸æ ‡æ–¹å‘&quot;">â€‹</a></h2><p><code>openCursor()</code> æ–¹æ³•å®é™…ä¸Šå¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°,ç¬¬ä¸€ä¸ªæ˜¯ IDBKeyRange çš„å®ä¾‹,ç¬¬äºŒä¸ªæ˜¯è¡¨ç¤ºæ–¹å‘çš„å­—ç¬¦ä¸²ã€‚é€šå¸¸,æ¸¸æ ‡éƒ½æ˜¯ä»å¯¹è±¡å­˜å‚¨çš„ç¬¬ä¸€æ¡è®°å½•å¼€å§‹,æ¯æ¬¡è°ƒç”¨ <code>continue()</code> æˆ– <code>advance()</code> éƒ½ä¼šå‘æœ€åä¸€æ¡è®°å½•å‰è¿›ã€‚è¿™æ ·çš„æ¸¸æ ‡å…¶é»˜è®¤æ–¹å‘ä¸º&quot;next&quot;ã€‚å¦‚æœå¯¹è±¡å­˜å‚¨ä¸­æœ‰é‡å¤çš„è®°å½•,å¯èƒ½éœ€è¦æ¸¸æ ‡è·³è¿‡é‚£äº›é‡å¤çš„é¡¹ã€‚ä¸ºæ­¤,å¯ä»¥ç»™ <code>opencursor()</code> çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ äºº&quot;nextunique&quot;:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nextunique&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æ³¨æ„,<code>opencursor()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ null,è¡¨ç¤ºé»˜è®¤çš„é”®èŒƒå›´æ˜¯æ‰€æœ‰å€¼ã€‚æ­¤æ¸¸æ ‡ä¼šéå†å¯¹è±¡å­˜å‚¨ä¸­çš„è®°å½•,ä»ç¬¬ä¸€æ¡è®°å½•å¼€å§‹è¿­ä»£,åˆ°æœ€åä¸€æ¡è®°å½•,ä½†ä¼šè·³è¿‡é‡å¤çš„è®°å½•ã€‚</p><p>å¦å¤–,ä¹Ÿå¯ä»¥åˆ›å»ºåœ¨å¯¹è±¡å­˜å‚¨ä¸­åå‘ç§»åŠ¨çš„æ¸¸æ ‡,ä»æœ€åä¸€é¡¹å¼€å§‹å‘ç¬¬ä¸€é¡¹ç§»åŠ¨ã€‚æ­¤æ—¶éœ€è¦ç»™ <code>opencursor()</code> ä¼ äºº&quot;prev&quot;æˆ–&quot;prevunique&quot;ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°(åè€…çš„æ„æ€å½“ç„¶æ˜¯é¿å…é‡å¤)ã€‚ä¾‹å¦‚:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prevunique&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨ä½¿ç”¨&quot;prev&quot;æˆ–&quot;prevunique&quot;æ‰“å¼€æ¸¸æ ‡æ—¶,æ¯æ¬¡è°ƒç”¨ <code>continue()</code> æˆ– <code>advance()</code> éƒ½ä¼šåœ¨å¯¹è±¡å­˜å‚¨ä¸­åå‘ç§»åŠ¨æ¸¸æ ‡ã€‚</p><br><h2 id="_3-8-ç´¢å¼•" tabindex="-1">3.8 ç´¢å¼• <a class="header-anchor" href="#_3-8-ç´¢å¼•" aria-label="Permalink to &quot;3.8 ç´¢å¼•&quot;">â€‹</a></h2><p>å¯¹æŸäº›æ•°æ®é›†,å¯èƒ½éœ€è¦ä¸ºå¯¹è±¡å­˜å‚¨æŒ‡å®šå¤šä¸ªé”®ã€‚ä¾‹å¦‚,å¦‚æœåŒæ—¶è®°å½•äº†ç”¨æˆ· ID å’Œç”¨æˆ·å,é‚£å¯èƒ½éœ€è¦é€šè¿‡ä»»ä½•ä¸€ç§æ–¹å¼æ¥è·å–ç”¨æˆ·æ•°æ®ã€‚ä¸ºæ­¤,å¯ä»¥è€ƒè™‘å°†ç”¨æˆ· ID ä½œä¸ºä¸»é”®,ç„¶ååœ¨ç”¨æˆ·åä¸Šåˆ›å»ºç´¢å¼•ã€‚</p><p>è¦åˆ›å»ºæ–°ç´¢å¼•ï¼Œé¦–å…ˆè¦å–å¾—å¯¹è±¡å­˜å‚¨çš„å¼•ç”¨,ç„¶ååƒä¸‹é¢çš„ä¾‹å­-æ ·è°ƒç”¨ <code>createIndex()</code>:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { unique: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>createIndex()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç´¢å¼•çš„åç§°,ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç´¢å¼•å±æ€§çš„åç§°,ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åŒ…å«é”® <strong>unique</strong> çš„ <strong>options å¯¹è±¡</strong>ã€‚è¿™ä¸ªé€‰é¡¹ä¸­çš„ <strong>unique</strong> åº”è¯¥å¿…é¡»æŒ‡å®š,è¡¨ç¤ºè¿™ä¸ªé”®æ˜¯å¦åœ¨æ‰€æœ‰è®°å½•ä¸­å”¯ä¸€ã€‚å› ä¸º username å¯èƒ½ä¸ä¼šé‡å¤,æ‰€ä»¥è¿™ä¸ªé”®æ˜¯å”¯ä¸€çš„ã€‚</p><p><code>createIndex()</code> è¿”å›çš„æ˜¯ <strong>IDBIndex</strong> å®ä¾‹ã€‚åœ¨å¯¹è±¡å­˜å‚¨ä¸Šè°ƒç”¨ <code>index()</code> æ–¹æ³•ä¹Ÿå¯ä»¥å¾—åˆ°åŒä¸€ä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„åä¸º&quot;username&quot;çš„ç´¢å¼•,å¯ä»¥åƒä¸‹é¢è¿™æ ·:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç´¢å¼•éå¸¸åƒå¯¹è±¡å­˜å‚¨ã€‚å¯ä»¥åœ¨ç´¢å¼•ä¸Šä½¿ç”¨ <code>openCursor()</code> æ–¹æ³•åˆ›å»ºæ–°æ¸¸æ ‡,è¿™ä¸ªæ¸¸æ ‡ä¸åœ¨å¯¹è±¡å­˜å‚¨ä¸Šè°ƒç”¨ <code>openCursor()</code> åˆ›å»ºçš„æ¸¸æ ‡å®Œå…¨ä¸€æ ·ã€‚åªæ˜¯å…¶ <code>result.key</code> å±æ€§ä¸­ä¿å­˜çš„æ˜¯ç´¢å¼•é”®,è€Œä¸æ˜¯ä¸»é”®ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä½¿ç”¨ <code>openKeyCursor()</code> æ–¹æ³•ä¹Ÿå¯ä»¥åœ¨ç´¢å¼•ä¸Šåˆ›å»ºç‰¹æ®Šæ¸¸æ ‡,åªè¿”å›æ¯æ¡è®°å½•çš„ä¸»é”®ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶çš„å‚æ•°ä¸ <code>openCursor()</code> ä¸€æ ·ã€‚æœ€å¤§çš„ä¸åŒåœ¨äº,<code>event.result.key</code> æ˜¯ç´¢å¼•é”®,ä¸” <code>event.result.value</code> æ˜¯ä¸»é”®è€Œä¸æ˜¯æ•´ä¸ªè®°å½•ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openKeyCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // event.result.key æ˜¯ç´¢å¼•é”®, event.result.value æ˜¯ä¸»é”®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å¯ä»¥ä½¿ç”¨ <code>get()</code> æ–¹æ³•å¹¶ä¼ äººç´¢å¼•é”®é€šè¿‡ç´¢å¼•å–å¾—å•æ¡è®°å½•,è¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç†å¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¦‚æœæƒ³åªå–å¾—ç»™å®šç´¢å¼•é”®çš„ä¸»é”®,å¯ä»¥ä½¿ç”¨ <code>getKey()</code> æ–¹æ³•ã€‚è¿™æ ·ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚,ä½† <code>result.value</code> ç­‰äºä¸»é”®è€Œä¸æ˜¯æ•´ä¸ªè®°å½•:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;007&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç†æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // event.target.result.key æ˜¯ç´¢å¼•é”®, event.target.result.value æ˜¯ä¸»é”®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>åœ¨è¿™ä¸ª <code>onsuccess</code> äº‹ä»¶å¤„ç†ç¨‹åºä¸­,<code>event.target.result.value</code> ä¸­åº”è¯¥æ˜¯ç”¨æˆ· ID ä»»ä½•æ—¶å€™,éƒ½å¯ä»¥ä½¿ç”¨ <strong>IDBIndex</strong> å¯¹è±¡çš„ä¸‹åˆ—å±æ€§å–å¾—ç´¢å¼•çš„ç›¸å…³ä¿¡æ¯ã€‚</p><ul><li><strong>name:</strong> ç´¢å¼•çš„åç§°ã€‚</li><li><strong>keyPath:</strong> è°ƒç”¨ createIndex()æ—¶ä¼ äººçš„å±æ€§è·¯å¾„</li><li><strong>objectStore:</strong> ç´¢å¼•å¯¹åº”çš„å¯¹è±¡å­˜å‚¨ã€‚</li><li><strong>unique:</strong> è¡¨ç¤ºç´¢å¼•é”®æ˜¯å¦å”¯ä¸€çš„å¸ƒå°”å€¼ã€‚</li></ul><p>å¯¹è±¡å­˜å‚¨è‡ªèº«ä¹Ÿæœ‰ä¸€ä¸ª <strong>indexNames</strong> å±æ€§,ä¿å­˜ç€ä¸ä¹‹ç›¸å…³ç´¢å¼•çš„åç§°ã€‚ä½¿ç”¨å¦‚ä¸‹ä»£ç å¯ä»¥æ–¹ä¾¿åœ°äº†è§£å¯¹è±¡å­˜å‚¨ä¸Šå·²å­˜åœ¨å“ªäº›ç´¢å¼•:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  indexNames</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.indexNames;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexNames) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(indexName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`Index name: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">indexName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">		KeyPath: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">keyPath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">		ObjectStore: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">objectStore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">		Unique: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">unique</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä»¥ä¸Šä»£ç è¿­ä»£äº†æ¯ä¸ªç´¢å¼•å¹¶åœ¨æ§åˆ¶å°ä¸­è¾“å‡ºäº†å®ƒä»¬çš„ä¿¡æ¯ã€‚åœ¨å¯¹è±¡å­˜å‚¨ä¸Šè°ƒç”¨ <code>deleteIndex()</code> æ–¹æ³•å¹¶ä¼ äººç´¢å¼•çš„åç§°å¯ä»¥åˆ é™¤ç´¢å¼•:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">objectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	store</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.deleteIndex(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å› ä¸ºåˆ é™¤ç´¢å¼•ä¸ä¼šå½±å“å¯¹è±¡å­˜å‚¨ä¸­çš„æ•°æ®,æ‰€ä»¥è¿™ä¸ªæ“ä½œæ²¡æœ‰å›è°ƒ</p><br><h2 id="_3-9-å¹¶å‘é—®é¢˜" tabindex="-1">3.9 å¹¶å‘é—®é¢˜ <a class="header-anchor" href="#_3-9-å¹¶å‘é—®é¢˜" aria-label="Permalink to &quot;3.9 å¹¶å‘é—®é¢˜&quot;">â€‹</a></h2><p><strong>IndexedDB</strong> è™½ç„¶æ˜¯ç½‘é¡µä¸­çš„å¼‚æ­¥ API,ä½†ä»å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚å¦‚æœä¸¤ä¸ªä¸åŒçš„æµè§ˆå™¨æ ‡ç­¾é¡µåŒæ—¶æ‰“å¼€äº†åŒä¸€ä¸ªç½‘é¡µ,åˆ™æœ‰å¯èƒ½å‡ºç°ä¸€ä¸ªç½‘é¡µå°è¯•å‡çº§æ•°æ®åº“è€Œå¦ä¸€ä¸ªå°šæœªå°±ç»ªçš„æƒ…å½¢ã€‚æœ‰é—®é¢˜çš„æ“ä½œæ˜¯è®¾ç½®æ•°æ®åº“ä¸ºæ–°ç‰ˆæœ¬ï¼Œè€Œç‰ˆæœ¬å˜åŒ–åªèƒ½åœ¨æµè§ˆå™¨åªæœ‰ä¸€ä¸ªæ ‡ç­¾é¡µä½¿ç”¨æ•°æ®åº“æ—¶æ‰èƒ½å®Œæˆã€‚ç¬¬ä¸€æ¬¡æ‰“å¼€æ•°æ®åº“æ—¶,æ·»åŠ  <code>onversionchange</code> äº‹ä»¶å¤„ç†ç¨‹åºéå¸¸é‡è¦ã€‚å¦ä¸€ä¸ªåŒæºæ ‡ç­¾é¡µå°†æ•°æ®åº“æ‰“å¼€åˆ°æ–°ç‰ˆæœ¬æ—¶,å°†æ‰§è¡Œæ­¤å›è°ƒã€‚å¯¹è¿™ä¸ªäº‹ä»¶æœ€å¥½çš„å›åº”æ˜¯ç«‹å³å…³é—­æ•°æ®åº“,ä»¥ä¾¿å®Œæˆç‰ˆæœ¬å‡çº§ã€‚ä¾‹å¦‚:</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request, database;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexedDB.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onsuccess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  database </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  database.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onversionchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> database.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åº”è¯¥åœ¨æ¯æ¬¡æˆåŠŸæ‰“å¼€æ•°æ®åº“åéƒ½æŒ‡å®š <code>onversionchange</code> äº‹ä»¶å¤„ç†ç¨‹åºã€‚è®°ä½,<code>onversionchange</code> æœ‰å¯èƒ½ä¼šè¢«å…¶ä»–æ ‡ç­¾é¡µè§¦å‘ã€‚é€šè¿‡å§‹ç»ˆéƒ½æŒ‡å®šè¿™äº›äº‹ä»¶å¤„ç†ç¨‹åº,å¯ä»¥ä¿è¯ Web åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†ä¸ IndexedDB ç›¸å…³çš„å¹¶å‘é—®é¢˜ã€‚</p><br><h2 id="_3-10-é™åˆ¶" tabindex="-1">3.10 é™åˆ¶ <a class="header-anchor" href="#_3-10-é™åˆ¶" aria-label="Permalink to &quot;3.10 é™åˆ¶&quot;">â€‹</a></h2><p><strong>IndexedDB</strong> çš„å¾ˆå¤šé™åˆ¶å®é™…ä¸Šä¸ <strong>Web Storage</strong> ä¸€æ ·ã€‚é¦–å…ˆ,<strong>IndexedDB</strong> æ•°æ®åº“æ˜¯ä¸é¡µé¢æº(åè®®ã€åŸŸå’Œç«¯å£)ç»‘å®šçš„,å› æ­¤ä¿¡æ¯ä¸èƒ½è·¨åŸŸå…±äº«ã€‚è¿™æ„å‘³ç€ www.wrox.com å’Œ p2p.wrox.com ä¼šå¯¹åº”ä¸åŒçš„æ•°æ®å­˜å‚¨ã€‚</p><p>å…¶æ¬¡ï¼Œæ¯ä¸ªæºéƒ½æœ‰å¯ä»¥å­˜å‚¨çš„ç©ºé—´é™åˆ¶ã€‚å½“å‰ Firefox çš„é™åˆ¶æ˜¯æ¯ä¸ªæº 50MB,è€Œ Chrome æ˜¯ 5MBã€‚ç§»åŠ¨ç‰ˆ Firefox æœ‰ 5MB é™åˆ¶,å¦‚æœç”¨åº¦è¶…å‡ºé…é¢åˆ™ä¼šè¯·æ±‚ç”¨æˆ·è®¸å¯ã€‚</p><p>Firefox è¿˜æœ‰ä¸€ä¸ªé™åˆ¶---æœ¬åœ°æ–‡æœ¬ä¸èƒ½è®¿é—® <strong>IndexedDB</strong> æ•°æ®åº“ã€‚åœ°è¿è¡Œæœ¬ä¹¦ç¤ºä¾‹æ—¶ï¼Œè¦ä½¿ç”¨ Chromeã€‚</p><h1 id="_4-å°ç»“" tabindex="-1">4 å°ç»“ <a class="header-anchor" href="#_4-å°ç»“" aria-label="Permalink to &quot;4 å°ç»“&quot;">â€‹</a></h1><p><strong>WebStorage</strong> å®šä¹‰äº†ä¸¤ä¸ªå¯¹è±¡ç”¨äºå­˜å‚¨æ•°æ®:<strong>sessionstorage</strong> å’Œ <strong>localstorage</strong>ã€‚å‰è€…ç”¨äºä¸¥æ ¼ä¿å­˜æµè§ˆå™¨ä¸€æ¬¡ä¼šè¯æœŸé—´çš„æ•°æ®,å› ä¸ºæ•°æ®ä¼šåœ¨æµè§ˆå™¨å…³é—­æ—¶è¢«åˆ é™¤ã€‚åè€…ç”¨äºä¼šè¯ä¹‹å¤–æŒä¹…ä¿å­˜æ•°æ®ã€‚</p><p><strong>IndexedDB</strong> æ˜¯ç±»ä¼¼äº SOL æ•°æ®åº“çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æœºåˆ¶ã€‚ä¸åŒçš„æ˜¯,<strong>IndexedDB</strong> å­˜å‚¨çš„æ˜¯å¯¹è±¡,è€Œä¸æ˜¯æ•°æ®è¡¨ã€‚å¯¹è±¡å­˜å‚¨æ˜¯é€šè¿‡å®šä¹‰é”®ç„¶åæ·»åŠ æ•°æ®æ¥åˆ›å»ºçš„ã€‚æ¸¸æ ‡ç”¨äºæŸ¥è¯¢å¯¹è±¡å­˜å‚¨ä¸­çš„ç‰¹å®šæ•°æ®,è€Œç´¢å¼•å¯ä»¥é’ˆå¯¹ç‰¹å®šå±æ€§å®ç°æ›´å¿«çš„æŸ¥è¯¢ã€‚</p><p>æœ‰äº†è¿™äº›å­˜å‚¨æ‰‹æ®µ,å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯é€šè¿‡ä½¿ç”¨ JavaScript å­˜å‚¨å¯è§‚çš„æ•°æ®ã€‚å› ä¸ºè¿™äº›æ•°æ®æ²¡æœ‰åŠ å¯†æ‰€ä»¥è¦æ³¨æ„ä¸èƒ½ä½¿ç”¨å®ƒä»¬å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚</p>`,190)]))}const g=i(l,[["render",p]]);export{o as __pageData,g as default};
