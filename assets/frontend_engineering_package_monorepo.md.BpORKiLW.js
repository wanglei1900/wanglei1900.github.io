import{_ as r,C as d,c as k,o as i,a7 as n,b as l,w as a,a as t,G as p,a8 as h}from"./chunks/framework.Dtft01Yp.js";const y=JSON.parse('{"title":"🌌 Monorepo 实践完整指南","description":"","frontmatter":{},"headers":[],"relativePath":"frontend/engineering/package/monorepo.md","filePath":"frontend/engineering/package/monorepo.md","lastUpdated":1752051878000}'),o={name:"frontend/engineering/package/monorepo.md"};function c(b,s,u,E,g,F){const e=d("Mermaid");return i(),k("div",null,[s[4]||(s[4]=n(`<h1 id="🌌-monorepo-实践完整指南" tabindex="-1">🌌 Monorepo 实践完整指南 <a class="header-anchor" href="#🌌-monorepo-实践完整指南" aria-label="Permalink to &quot;🌌 Monorepo 实践完整指南&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#💡-一、monorepo-核心概念">💡 一、Monorepo 核心概念</a></li><li><a href="#⛓️-二、工具链对比与选型">⛓️ 二、工具链对比与选型</a></li><li><a href="#📑-三、项目结构与工作流设计">📑 三、项目结构与工作流设计</a></li><li><a href="#📋-四、权限管理与协作规范">📋 四、权限管理与协作规范</a></li><li><a href="#🤖-五、ci-cd-与自动化">🤖 五、CI/CD 与自动化</a></li><li><a href="#🧲-六、迁移策略与最佳实践">🧲 六、迁移策略与最佳实践</a></li><li><a href="#💰-七、收益与挑战分析">💰 七、收益与挑战分析</a></li><li><a href="#🔗-八、参考资料">🔗 八、参考资料</a></li></ul></nav><h2 id="💡-一、monorepo-核心概念" tabindex="-1">💡 一、Monorepo 核心概念 <a class="header-anchor" href="#💡-一、monorepo-核心概念" aria-label="Permalink to &quot;💡 一、Monorepo 核心概念&quot;">​</a></h2><h4 id="_1-什么是-monorepo" tabindex="-1">1. 什么是 Monorepo？ <a class="header-anchor" href="#_1-什么是-monorepo" aria-label="Permalink to &quot;1. 什么是 Monorepo？&quot;">​</a></h4><ul><li>定义：将多个相关项目/模块整合到单一代码仓库中的工程策略</li><li>核心特征： <ul><li>统一版本控制与依赖管理</li><li>共享代码和工具链</li><li>原子提交（跨项目变更单次提交）</li></ul></li><li>典型结构：</li></ul><div class="language-md vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">monorepo/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├── apps/          # 业务应用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├── packages/      # 共享库（组件/工具）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├── scripts/       # 全局脚本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">└── pnpm-workspace.yaml # 工作区定义</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-适用场景分析" tabindex="-1">2. 适用场景分析 <a class="header-anchor" href="#_2-适用场景分析" aria-label="Permalink to &quot;2. 适用场景分析&quot;">​</a></h4>`,7)),(i(),l(h,null,{default:a(()=>[p(e,{id:"mermaid-50",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%E9%AB%98%E5%8D%8F%E4%BD%9C%E9%9C%80%E6%B1%82%5D%20--%3E%20Monorepo%0A%20%20%20%20B%5B%E6%A8%A1%E5%9D%97%E5%BC%BA%E8%80%A6%E5%90%88%5D%20--%3E%20Monorepo%0A%20%20%20%20C%5B%E9%A2%91%E7%B9%81%E8%B7%A8%E9%A1%B9%E7%9B%AE%E5%8F%98%E6%9B%B4%5D%20--%3E%20Monorepo%0A%20%20%20%20D%5B%E4%BD%8E%E8%80%A6%E5%90%88%E7%8B%AC%E7%AB%8B%E9%A1%B9%E7%9B%AE%5D%20--%3E%20MultiRepo%0A"})]),fallback:a(()=>s[0]||(s[0]=[t(" Loading... ")])),_:1})),s[5]||(s[5]=n(`<ul><li>推荐使用场景： <ul><li>中后台系统集合（如电商平台+商家后台）</li><li>跨端应用（Web/iOS/Android共享核心逻辑）</li><li>开源项目生态（如Babel、Vue全家桶</li></ul></li><li>避免使用场景： <ul><li>独立微服务架构</li><li>安全隔离要求高的项目</li><li>超大规模代码库（&gt;500万行）</li></ul></li></ul><h4 id="_2-核心优势与挑战" tabindex="-1">2. 核心优势与挑战 <a class="header-anchor" href="#_2-核心优势与挑战" aria-label="Permalink to &quot;2. 核心优势与挑战&quot;">​</a></h4><table tabindex="0"><thead><tr><th><strong>优势</strong></th><th><strong>挑战</strong></th></tr></thead><tbody><tr><td>✅ 代码复用率提升40%（减少重复开发）</td><td>❌ 仓库体积膨胀（Git操作延迟）</td></tr><tr><td>✅ 依赖安装速度提升70%（依赖提升至根目录）</td><td>❌ 幽灵依赖问题（未声明却可访问的依赖）</td></tr><tr><td>✅ 新项目接入成本降低60%（标准化基建）</td><td>❌ 权限管理复杂度高</td></tr><tr><td>✅ 跨模块变更联动测试（降低线上故障35%）1</td><td>❌ 构建系统定制成本高</td></tr></tbody></table><br><h2 id="⛓️-二、工具链对比与选型" tabindex="-1">⛓️ 二、工具链对比与选型 <a class="header-anchor" href="#⛓️-二、工具链对比与选型" aria-label="Permalink to &quot;⛓️ 二、工具链对比与选型&quot;">​</a></h2><h4 id="_1-主流工具横向对比" tabindex="-1">1. 主流工具横向对比 <a class="header-anchor" href="#_1-主流工具横向对比" aria-label="Permalink to &quot;1. 主流工具横向对比&quot;">​</a></h4><table tabindex="0"><thead><tr><th><strong>工具</strong></th><th><strong>核心优势</strong></th><th><strong>适用场景</strong></th><th><strong>性能特点</strong></th></tr></thead><tbody><tr><td><strong>PNPM Workspace</strong></td><td>严格依赖隔离，解决“幽灵依赖”</td><td>中小型项目，依赖管理优先</td><td>磁盘空间节省30%+</td></tr><tr><td><strong>Turborepo</strong></td><td>增量构建+远程缓存</td><td>大型项目，构建速度敏感场景</td><td>分布式缓存，构建提速5x</td></tr><tr><td><strong>Nx</strong></td><td>可视化依赖图，全流程工具链</td><td>企业级复杂工程</td><td>智能任务调度</td></tr><tr><td><strong>Lerna</strong></td><td>语义化版本发布，多包管理</td><td>开源库发布场景</td><td>需配合其他工具优化构建</td></tr></tbody></table><h4 id="_2-推荐技术栈组合" tabindex="-1">2. 推荐技术栈组合 <a class="header-anchor" href="#_2-推荐技术栈组合" aria-label="Permalink to &quot;2. 推荐技术栈组合&quot;">​</a></h4><ol><li>基础方案：PNPM + Turborepo</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dw</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置 turbo.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;pipeline&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;build&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      &quot;outputs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      &quot;dependsOn&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="2"><li>高级方案：Nx Cloud + Lerna（百人以上团队） <ul><li>分布式任务执行</li><li>云缓存共享</li><li>变更影响分析3</li></ul></li></ol><br><h2 id="📑-三、项目结构与工作流设计" tabindex="-1">📑 三、项目结构与工作流设计 <a class="header-anchor" href="#📑-三、项目结构与工作流设计" aria-label="Permalink to &quot;📑 三、项目结构与工作流设计&quot;">​</a></h2><h4 id="_1-标准化目录结构" tabindex="-1">1. 标准化目录结构 <a class="header-anchor" href="#_1-标准化目录结构" aria-label="Permalink to &quot;1. 标准化目录结构&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">monorepo/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 后台应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 客户端应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> components</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 通用组件库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> utils</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 工具函数集</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hooks</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 自定义Hooks</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> business</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # 业务域模块</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> payment</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 支付域共享代码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> infra</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ci</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # CI脚本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 容器配置</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_2-依赖管理实践" tabindex="-1">2. 依赖管理实践 <a class="header-anchor" href="#_2-依赖管理实践" aria-label="Permalink to &quot;2. 依赖管理实践&quot;">​</a></h4><ul><li>提升公共依赖（根目录package.json）：</li></ul><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;react&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^18.2.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;typescript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;~5.0.4&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>模块间引用（使用workspace协议）：</li></ul><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/admin/package.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@acme/components&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-脚本编排策略" tabindex="-1">3. 脚本编排策略 <a class="header-anchor" href="#_3-脚本编排策略" aria-label="Permalink to &quot;3. 脚本编排策略&quot;">​</a></h4>`,21)),(i(),l(h,null,{default:a(()=>[p(e,{id:"mermaid-294",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20A%5B%E4%BB%A3%E7%A0%81%E5%8F%98%E6%9B%B4%5D%20--%3E%20B%7BTurborepo%20%E5%88%86%E6%9E%90%7D%0A%20%20%20%20B%20--%3E%7C%E5%BD%B1%E5%93%8D%E7%BB%84%E4%BB%B6%E5%BA%93%7C%20C%5B%E6%9E%84%E5%BB%BA%20packages%2F*%5D%0A%20%20%20%20B%20--%3E%7C%E5%BD%B1%E5%93%8Dadmin%E5%BA%94%E7%94%A8%7C%20D%5B%E6%9E%84%E5%BB%BA%20apps%2Fadmin%5D%0A%20%20%20%20C%20--%3E%20E%5B%E8%A7%A6%E5%8F%91%E4%BE%9D%E8%B5%96%E9%87%8D%E7%BC%96%5D%0A%20%20%20%20D%20--%3E%20F%5B%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%5D%0A"})]),fallback:a(()=>s[1]||(s[1]=[t(" Loading... ")])),_:1})),s[6]||(s[6]=n(`<br><h2 id="📋-四、权限管理与协作规范" tabindex="-1">📋 四、权限管理与协作规范 <a class="header-anchor" href="#📋-四、权限管理与协作规范" aria-label="Permalink to &quot;📋 四、权限管理与协作规范&quot;">​</a></h2><h4 id="_1-精细化权限控制" tabindex="-1">1. 精细化权限控制 <a class="header-anchor" href="#_1-精细化权限控制" aria-label="Permalink to &quot;1. 精细化权限控制&quot;">​</a></h4><ul><li>GitLab Codeowners 配置示例：</li></ul><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># .gitlab/CODEOWNERS</span></span>
<span class="line"><span>/packages/components/  @frontend-owners</span></span>
<span class="line"><span>/apps/admin/           @admin-team</span></span>
<span class="line"><span>/.github/              @platform-architects</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>分支保护规则：</li></ul><table tabindex="0"><thead><tr><th>分支类型</th><th>推送权限</th><th>合并要求</th></tr></thead><tbody><tr><td>main</td><td>禁止直接推送</td><td>2人CodeReview + CI通过</td></tr><tr><td>release/*</td><td>TL及以上</td><td>回归测试报告</td></tr><tr><td>feature/*</td><td>开发者</td><td>ESLint/单测通过</td></tr></tbody></table><h4 id="_2-变更流程管控" tabindex="-1">2. 变更流程管控 <a class="header-anchor" href="#_2-变更流程管控" aria-label="Permalink to &quot;2. 变更流程管控&quot;">​</a></h4><ol><li>特性开发：git checkout -b feature/search-optim</li><li>提交前检查（Husky钩子）：</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .husky/pre-commit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lint-staged</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>MR流程： <ul><li>关联JIRA需求ID</li><li>指定CodeOwner评审</li><li>CI流水线验证</li></ul></li></ol><br><h2 id="🤖-五、ci-cd-与自动化" tabindex="-1">🤖 五、CI/CD 与自动化 <a class="header-anchor" href="#🤖-五、ci-cd-与自动化" aria-label="Permalink to &quot;🤖 五、CI/CD 与自动化&quot;">​</a></h2><h4 id="_1-智能构建优化" tabindex="-1">1. 智能构建优化 <a class="header-anchor" href="#_1-智能构建优化" aria-label="Permalink to &quot;1. 智能构建优化&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .gitlab-ci.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run build --filter=...[origin/main]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${CI_COMMIT_REF_SLUG}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.turbo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_2-增量测试策略" tabindex="-1">2. 增量测试策略 <a class="header-anchor" href="#_2-增量测试策略" aria-label="Permalink to &quot;2. 增量测试策略&quot;">​</a></h4><ul><li>Jest变更分析：</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 仅测试受影响模块</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=...[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HEAD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">^]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>覆盖率卡点：</li></ul><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CI配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Coverage Check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">coverage &lt; 80%</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">exit 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-发布自动化" tabindex="-1">3. 发布自动化 <a class="header-anchor" href="#_3-发布自动化" aria-label="Permalink to &quot;3. 发布自动化&quot;">​</a></h4>`,21)),(i(),l(h,null,{default:a(()=>[p(e,{id:"mermaid-437",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20Changesets-%3E%3E%2BCI%3A%20%E6%A3%80%E6%B5%8B%E7%89%88%E6%9C%AC%E5%8F%98%E6%9B%B4%0A%20%20%20%20CI-%3E%3E%2BNexus%3A%20%E5%8F%91%E5%B8%83%E6%B5%8B%E8%AF%95%E5%8C%85%0A%20%20%20%20Nexus--%3E%3E-Staging%3A%20%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%0A%20%20%20%20Staging--%3E%3E-QA%3A%20%E9%80%9A%E7%9F%A5%E9%AA%8C%E8%AF%81%0A%20%20%20%20QA-%3E%3E%2BProd%3A%20%E4%BA%BA%E5%B7%A5%E7%A1%AE%E8%AE%A4%E5%8F%91%E5%B8%83%0A"})]),fallback:a(()=>s[2]||(s[2]=[t(" Loading... ")])),_:1})),s[7]||(s[7]=n(`<br><h2 id="🧲-六、迁移策略与最佳实践" tabindex="-1">🧲 六、迁移策略与最佳实践 <a class="header-anchor" href="#🧲-六、迁移策略与最佳实践" aria-label="Permalink to &quot;🧲 六、迁移策略与最佳实践&quot;">​</a></h2><h4 id="_1-多仓库迁移流程" tabindex="-1">1. 多仓库迁移流程 <a class="header-anchor" href="#_1-多仓库迁移流程" aria-label="Permalink to &quot;1. 多仓库迁移流程&quot;">​</a></h4><ol><li>预处理各仓库：</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在每个仓库内创建子目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> legacy-project</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> legacy-project/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;refactor: prepare for monorepo migration&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>合并历史记录：</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在新Monorepo中操作</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remote</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git@project1-url.git</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fetch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tags</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> merge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project1/main</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --allow-unrelated-histories</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>路径修正：</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 移动文件到目标位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> legacy-project/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/project1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-组件共享模式" tabindex="-1">2. 组件共享模式 <a class="header-anchor" href="#_2-组件共享模式" aria-label="Permalink to &quot;2. 组件共享模式&quot;">​</a></h4><table tabindex="0"><thead><tr><th>模式</th><th>适用场景</th><th>实现方式</th></tr></thead><tbody><tr><td>源码引入</td><td>基础UI组件</td><td><code>import { Button } from &#39;@acme/ui&#39;</code></td></tr><tr><td>模块联邦</td><td>高频迭代业务组件</td><td>Webpack 5 Module Federation</td></tr><tr><td>NPM私有包</td><td>跨团队共享</td><td>私有Registry发布</td></tr></tbody></table><h4 id="_3-性能优化技巧" tabindex="-1">3. 性能优化技巧 <a class="header-anchor" href="#_3-性能优化技巧" aria-label="Permalink to &quot;3. 性能优化技巧&quot;">​</a></h4><ul><li>部分检出（巨型仓库）：</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=blob:none</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sparse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://monorepo.git</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sparse-checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cone</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sparse-checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/admin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>构建缓存复用：</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Turborepo 远程缓存</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --remote-only</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>依赖分析（避免重复打包）：</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dlx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> depcheck</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><br><h2 id="💰-七、收益与挑战分析" tabindex="-1">💰 七、收益与挑战分析 <a class="header-anchor" href="#💰-七、收益与挑战分析" aria-label="Permalink to &quot;💰 七、收益与挑战分析&quot;">​</a></h2><h4 id="_1-实施收益" tabindex="-1">1. 实施收益 <a class="header-anchor" href="#_1-实施收益" aria-label="Permalink to &quot;1. 实施收益&quot;">​</a></h4>`,21)),(i(),l(h,null,{default:a(()=>[p(e,{id:"mermaid-556",class:"mermaid",graph:"pie%0A%20%20%20%20title%20Monorepo%E6%A0%B8%E5%BF%83%E6%94%B6%E7%9B%8A%0A%20%20%20%20%22%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%94%A8%E7%8E%87%E6%8F%90%E5%8D%8740%25%22%20%3A%2040%0A%20%20%20%20%22%E6%9E%84%E5%BB%BA%E6%97%B6%E9%97%B4%E5%87%8F%E5%B0%9170%25%22%20%3A%2030%0A%20%20%20%20%22%E6%96%B0%E6%88%90%E5%91%98%E4%B8%8A%E6%89%8B%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%8760%25%22%20%3A%2020%0A%20%20%20%20%22%E7%BA%BF%E4%B8%8A%E6%95%85%E9%9A%9C%E7%8E%87%E4%B8%8B%E9%99%8D35%25%22%20%3A%2010%0A"})]),fallback:a(()=>s[3]||(s[3]=[t(" Loading... ")])),_:1})),s[8]||(s[8]=n('<h4 id="_2-持续挑战与解决方案" tabindex="-1">2. 持续挑战与解决方案 <a class="header-anchor" href="#_2-持续挑战与解决方案" aria-label="Permalink to &quot;2. 持续挑战与解决方案&quot;">​</a></h4><table tabindex="0"><thead><tr><th>挑战</th><th>解决方案</th><th>工具支持</th></tr></thead><tbody><tr><td>仓库体积膨胀</td><td>Git Sparse</td><td>Checkout Git 2.25+</td></tr><tr><td>幽灵依赖</td><td>PNPM严格模式</td><td>pnpm.strictPeerDependencies=true</td></tr><tr><td>权限管控复杂</td><td>Codeowners文件+分支保护</td><td>GitLab/GitHub原生支持</td></tr><tr><td>构建内存溢出</td><td>资源限制+增量构建</td><td>Turborepo + Nx Cloud</td></tr></tbody></table><blockquote><p>最佳实践总结：从得物150+应用实践看，成功Monorepo=权限控制×工程标准化×性能优化，三者缺一不可</p></blockquote><h2 id="🔗-八、参考资料" tabindex="-1">🔗 八、参考资料 <a class="header-anchor" href="#🔗-八、参考资料" aria-label="Permalink to &quot;🔗 八、参考资料&quot;">​</a></h2><p><a href="https://research.google/pubs/pub45424/" target="_blank" rel="noreferrer">📚 Google Monorepo 实践（超大规模仓库经验）</a></p><p><a href="https://nx.dev/core-features/caching" target="_blank" rel="noreferrer">📚 Nx 官方文档（高级缓存机制）</a></p><p><a href="https://turbo.build/repo/docs" target="_blank" rel="noreferrer">📚 Turborepo 性能优化（分布式构建实战）</a></p><blockquote><p>本指南基于得物、微信等企业实战经验整理，适用于50+应用规模的前端工程体系，实施前建议通过<code>dx audit</code>评估迁移成本。</p></blockquote>',8))])}const C=r(o,[["render",c]]);export{y as __pageData,C as default};
