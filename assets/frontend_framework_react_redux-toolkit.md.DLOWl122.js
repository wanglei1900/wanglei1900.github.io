import{_ as i,c as a,o as n,a7 as l}from"./chunks/framework.Dtft01Yp.js";const c=JSON.parse('{"title":"Redux Toolkitï¼ˆRTKï¼‰","description":"","frontmatter":{},"headers":[],"relativePath":"frontend/framework/react/redux-toolkit.md","filePath":"frontend/framework/react/redux-toolkit.md","lastUpdated":1751621137000}'),p={name:"frontend/framework/react/redux-toolkit.md"};function e(t,s,h,k,r,E){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="redux-toolkit-rtk" tabindex="-1">Redux Toolkitï¼ˆRTKï¼‰ <a class="header-anchor" href="#redux-toolkit-rtk" aria-label="Permalink to &quot;Redux Toolkitï¼ˆRTKï¼‰&quot;">â€‹</a></h1><h2 id="_1-å®‰è£…" tabindex="-1">1. å®‰è£… <a class="header-anchor" href="#_1-å®‰è£…" aria-label="Permalink to &quot;1. å®‰è£…&quot;">â€‹</a></h2><p>@reduxjs/toolkitä¾èµ–äºeact-reduxåº“ï¼Œreact-redux åŒ…ä¾èµ–äº@types/react-redux, å› æ­¤ç±»å‹å®šä¹‰å°†ä¸åº“ä¸€èµ·è‡ªåŠ¨å®‰è£…ã€‚</p><p><code>yarn add react-redux @reduxjs/toolkit</code><br><code>yarn add @types/react-redux -D</code></p><h2 id="_2-rtk-åŒ…å«äº†ä»€ä¹ˆ" tabindex="-1">2. rtk åŒ…å«äº†ä»€ä¹ˆ <a class="header-anchor" href="#_2-rtk-åŒ…å«äº†ä»€ä¹ˆ" aria-label="Permalink to &quot;2. rtk åŒ…å«äº†ä»€ä¹ˆ&quot;">â€‹</a></h2><ul><li>ğŸš©<strong>configureStore()</strong>ï¼šå°è£…äº†createStoreï¼Œç®€åŒ–é…ç½®é¡¹ï¼Œæä¾›ä¸€äº›ç°æˆçš„é»˜è®¤é…ç½®é¡¹ã€‚å®ƒå¯ä»¥è‡ªåŠ¨ç»„åˆ slice çš„ reducerï¼Œå¯ä»¥æ·»åŠ ä»»ä½• Redux ä¸­é—´ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹åŒ…å« redux-thunkï¼Œå¹¶å¼€å¯äº† Redux DevTools æ‰©å±•ã€‚</li><li><strong>createReducer()</strong>ï¼šå¸®ä½ å°† action type æ˜ å°„åˆ° reducer å‡½æ•°ï¼Œè€Œä¸æ˜¯ç¼–å†™ switch...case è¯­å¥ã€‚å¦å¤–ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨ immer åº“æ¥è®©ä½ ä½¿ç”¨æ™®é€šçš„ mutable ä»£ç ç¼–å†™æ›´ç®€å•çš„ immutable æ›´æ–°ï¼Œä¾‹å¦‚ state.todos[3].completed = trueã€‚</li><li><strong>createAction()</strong>ï¼šç”Ÿæˆç»™å®š action type å­—ç¬¦ä¸²çš„ action creator å‡½æ•°ã€‚è¯¥å‡½æ•°æœ¬èº«å·²å®šä¹‰äº† toString()ï¼Œå› æ­¤å¯ä»¥ä»£æ›¿å¸¸é‡ç±»å‹ä½¿ç”¨ã€‚</li><li>ğŸš©<strong>createSlice()</strong>ï¼šæ¥æ”¶ä¸€ç»„ reducer å‡½æ•°çš„å¯¹è±¡ï¼Œä¸€ä¸ª slice åˆ‡ç‰‡åå’Œåˆå§‹çŠ¶æ€ initial stateï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå…·æœ‰ç›¸åº” action creator å’Œ action type çš„ slice reducerã€‚</li><li>ğŸš©<strong>createAsyncThunk</strong>ï¼šæ¥æ”¶ä¸€ä¸ª action type å­—ç¬¦ä¸²å’Œä¸€ä¸ªè¿”å›å€¼ä¸º promise çš„å‡½æ•°, å¹¶ç”Ÿæˆä¸€ä¸ª thunk å‡½æ•°ï¼Œè¿™ä¸ª thunk å‡½æ•°å¯ä»¥åŸºäºä¹‹å‰é‚£ä¸ª promise ï¼Œdispatch ä¸€ç»„ type ä¸º pending/fulfilled/rejected çš„ actionã€‚</li><li>ğŸš©<strong>createEntityAdapter</strong>ï¼šç”Ÿæˆä¸€ç³»åˆ—å¯å¤ç”¨çš„ reducer å’Œ selectorï¼Œä»è€Œç®¡ç† store ä¸­çš„è§„èŒƒåŒ–æ•°æ®ã€‚</li><li>ğŸš©<strong>createSelector</strong> è®¡åˆ’åŒ–Selectorå®ç°ç¼“å­˜ï¼Œæ¥æºäº Reselect åº“ï¼Œé‡æ–° export å‡ºæ¥ä»¥æ–¹ä¾¿ä½¿ç”¨ã€‚</li></ul><h2 id="_3-configurestore" tabindex="-1">3. configureStore <a class="header-anchor" href="#_3-configurestore" aria-label="Permalink to &quot;3. configureStore&quot;">â€‹</a></h2><blockquote><p>configureStore æ˜¯ Redux Toolkit ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåˆ›å»º Redux storeã€‚</p><p>å®ƒæ˜¯redux çš„ä¸€ä¸ªé…ç½®å™¨ï¼Œç®€åŒ–é…ç½®storeçš„è¿‡ç¨‹ã€‚</p></blockquote><h3 id="_3-1-é…ç½®é¡¹" tabindex="-1">3.1 é…ç½®é¡¹ <a class="header-anchor" href="#_3-1-é…ç½®é¡¹" aria-label="Permalink to &quot;3.1 é…ç½®é¡¹&quot;">â€‹</a></h3><p><strong>å¸¸ç”¨é…ç½®é¡¹ï¼š</strong></p><ul><li>reducerï¼šRedux storeä½¿ç”¨çš„æ ¹reducerå‡½æ•°ã€‚</li><li>middlewareï¼šè¦åº”ç”¨äºRedux storeçš„ä¸­é—´ä»¶æ•°ç»„ã€‚</li><li>devToolsï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¯ç”¨Redux DevToolsæ‰©å±•ã€‚</li><li>preloadedStateï¼šRedux storeçš„åˆå§‹çŠ¶æ€ã€‚</li><li>enhancersï¼šè¦åº”ç”¨äºRedux storeçš„å¢å¼ºå™¨æ•°ç»„ã€‚</li></ul><p><strong>ä¸å¸¸ç”¨é…ç½®é¡¹ï¼š</strong></p><ul><li>reducerPathï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡ç¤ºRedux storeä¸­åŒ…å«çš„reducerçš„åç§°ã€‚</li><li>immutableCheckï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¯ç”¨Redux Toolkitçš„ä¸å¯å˜æ€§æ£€æŸ¥ã€‚</li><li>serializableCheckï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¯ç”¨Redux Toolkitçš„åºåˆ—åŒ–æ£€æŸ¥ã€‚</li></ul><h3 id="_3-2-ç¤ºä¾‹" tabindex="-1">3.2 ç¤ºä¾‹ <a class="header-anchor" href="#_3-2-ç¤ºä¾‹" aria-label="Permalink to &quot;3.2 ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç®€æ˜“ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { configureStore } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rootReducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./reducers&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è°ƒç”¨configureStoreé»˜è®¤ä½¿ç”¨äº†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. redux-thunkä¸­é—´ä»¶æ¥æ”¯æŒå¼‚æ­¥actionï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. redux-devtools-extensionæ¥æ”¯æŒReduxDevToolsæµè§ˆå™¨æ‰©å±•ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. redux-immutable-state-invariantæ¥æ£€æµ‹stateçš„ä¸å¯å˜æ€§ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> configureStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducer: rootReducer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®Œæ•´ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// store.tsæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ä»¥ä¸‹ä»£ç å®Œæˆäº†ä¸‹åˆ—åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  - slice reducersè¢«è‡ªåŠ¨ä¼ é€’ç»™äº†combineReducers()å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  - redux-thunkå’Œredux-loggerè¢«æ·»åŠ ä¸ºä¸­é—´ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  - Redux DevToolsæ‰©å±•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¢«ç¦ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  - ä¸­é—´ä»¶ã€æ‰¹é‡è®¢é˜…å’Œdevtoolså¢å¼ºå™¨è¢«ç»„åˆåœ¨ä¸€èµ·</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { configureStore, getDefaultMiddleware } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// redux-loggeråœ¨æ­¤ä»…ä½œä¸ºä¸€ä¸ªç¤ºä¾‹ä¸­é—´ä»¶æ¥æ¼”ç¤ºï¼ˆè®°å½•Redux storeä¸­çš„æ¯ä¸ªactionå’Œstateçš„å˜åŒ–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;redux-logger&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// redux-batched-subscribeåœ¨æ­¤ä»…ä½œä¸ºä¸€ä¸ªç¤ºä¾‹å¢å¼ºå™¨æ¥æ¼”ç¤ºï¼ˆæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { batchedSubscribe } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;redux-batched-subscribe&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¼•å…¥ä¸¤ä¸ªä¸Šé¢å†™å¥½çš„reducer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> todosReducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./todos/todosReducer&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> visibilityReducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./visibility/visibilityReducer&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å› ä¸ºä½¿ç”¨äº†rtkçš„configureStoreï¼Œæ‰€ä»¥ä¸éœ€è¦å¦å¤–åˆå¹¶combineReducersäº†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reducer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  todos: todosReducer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  visibility: visibilityReducer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// getDefaultMiddlewareå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«é»˜è®¤ä¸­é—´ä»¶åˆ—è¡¨çš„æ•°ç»„,å¯ä»¥ç”¨äºæ·»åŠ è‡ªå®šä¹‰middlewareï¼ŒåŒæ—¶ä»ç„¶ä¿ç•™é»˜è®¤middlewar</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®˜ç½‘ä¸æ¨èä½¿ç”¨æ•°ç»„å±•å¼€è¿ç®—ç¬¦const middleware = [...getDefaultMiddleware(), customMiddleware]ï¼Œè¯·ä½¿ç”¨concat</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ‰©å±•è¿ç®—ç¬¦å¯èƒ½éƒ½ä¼šå¯¼è‡´tsä¸¢å¤±ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> middleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getDefaultMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getDefaultMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(logger)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´åŠ çµæ´»çš„è‡ªå®šä¹‰é»˜è®¤ä¸­é—´ä»¶,äº†è§£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const middleware = (getDefaultMiddleware) =&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     getDefaultMiddleware({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//       thunk: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//         extraArgument: myCustomApiService,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // extraArgument å±æ€§æŒ‡å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ API æœåŠ¡ï¼Œå®ƒå°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ action creator</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//       },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//       serializableCheck: false,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // å…³é—­serializableCheckä¸­é—´ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     }),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®šä¹‰åˆå§‹çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> preloadedState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  todos: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Eat food&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, completed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Exercise&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, completed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  visibilityFilter: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SHOW_COMPLETED&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> debounceNotify</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debounce</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">notify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> notify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> configureStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducer,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// reduceræ˜¯å¿…éœ€çš„ï¼Œå®ƒæŒ‡å®šäº†åº”ç”¨ç¨‹åºçš„æ ¹reducer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  middleware,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸­é—´ä»¶ï¼Œç”¨äºå¤„ç†actionã€‚å¦‚æœå¤šä¸ªä¸­é—´ä»¶ä¹Ÿå¯ä»¥ç”¨æ•°ç»„è¡¨ç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  devTools: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;production&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ˜¯å¦å¯ç”¨Redux DevTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  preloadedState,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯¹è±¡ï¼Œå®ƒåŒ…å«åº”ç”¨ç¨‹åºçš„åˆå§‹çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  enhancers: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">batchedSubscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(debounceNotify)],        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åº”ç”¨ç¨‹åºçš„å¢å¼ºå™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="_4-createslice" tabindex="-1">4. createSlice <a class="header-anchor" href="#_4-createslice" aria-label="Permalink to &quot;4. createSlice&quot;">â€‹</a></h2><blockquote><p>åˆ›å»ºreducerçš„åˆ‡ç‰‡æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆaction creatorsã€‚ç®€åŒ– Redux reducer é€»è¾‘å’Œ actionsã€‚</p></blockquote><h3 id="_4-1-createsliceå‚æ•°" tabindex="-1">4.1 createSliceå‚æ•° <a class="header-anchor" href="#_4-1-createsliceå‚æ•°" aria-label="Permalink to &quot;4.1 createSliceå‚æ•°&quot;">â€‹</a></h3><p>createSlice æ¥æ”¶ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªä¸»è¦é€‰é¡¹å­—æ®µçš„å¯¹è±¡ï¼š</p><ul><li>nameï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†ç”¨ä½œç”Ÿæˆçš„ action types çš„å‰ç¼€</li><li>initialStateï¼šreducer çš„åˆå§‹ state</li><li>reducersï¼šä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­é”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼æ˜¯å¤„ç†ç‰¹å®š actions çš„ â€œcase reducerâ€ å‡½æ•°</li></ul><h3 id="_4-2-ç¤ºä¾‹" tabindex="-1">4.2 ç¤ºä¾‹ <a class="header-anchor" href="#_4-2-ç¤ºä¾‹" aria-label="Permalink to &quot;4.2 ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createSlice, PayloadAction } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { GlobalState } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/store/interface&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { RootState } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@/store&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®šä¹‰åˆå§‹åŒ–çš„state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> initialState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GlobalState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	token: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	userInfo: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	Redux è¦æ±‚æˆ‘ä»¬é€šè¿‡åˆ›å»ºæ•°æ®å‰¯æœ¬å’Œæ›´æ–°æ•°æ®å‰¯æœ¬ï¼Œæ¥å®ç°ä¸å¯å˜åœ°å†™å…¥æ‰€æœ‰çŠ¶æ€æ›´æ–°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	ä¸è¿‡ Redux Toolkit createSlice å’Œ createReducer </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	åœ¨å†…éƒ¨ä½¿ç”¨ Immer å…è®¸æˆ‘ä»¬ç¼–å†™â€œå¯å˜â€çš„æ›´æ–°é€»è¾‘ï¼Œå˜æˆæ­£ç¡®çš„ä¸å¯å˜æ›´æ–°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> globalSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSlice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;global&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	initialState,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		createSlice å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå®ƒä½¿ç”¨ createReducer æ¥ç”Ÿæˆ reducer å‡½æ•°ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		è¿™é‡Œç›´æ¥ä¼ å…¥reducerså¯¹è±¡ï¼Œå°±ç›¸å½“äºåœ¨åŒ…è£…å™¨é‡Œè°ƒç”¨äº†createReducer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	reducers: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		setToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">action</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PayloadAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GlobalState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]&gt;) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// Redux Toolkit å…è®¸æˆ‘ä»¬åœ¨ reducers å†™ &quot;å¯å˜&quot; é€»è¾‘ã€‚å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// å¹¶ä¸æ˜¯çœŸæ­£çš„æ”¹å˜çŠ¶æ€å€¼ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº† Immer åº“</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// å¯ä»¥æ£€æµ‹åˆ°â€œè‰ç¨¿çŠ¶æ€â€œ çš„å˜åŒ–å¹¶ä¸”åŸºäºè¿™äº›å˜åŒ–ç”Ÿäº§å…¨æ–°çš„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// ä¸å¯å˜çš„çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			state.token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action.payload;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹dispatch ä¼ æ¥çš„æ•°æ® è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å†™æ³•å¹¶ä¼ å…¥prepareå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// prepareå‡½æ•°é¦–å…ˆæ¥å—dispatch çš„è´Ÿè½½(payload)å¹¶å¤„ç†ï¼Œç„¶åæ‰ä¼šä¼ é€’ç»™reducerã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// prepareå‡½æ•°ä½œç”¨å¦‚å…¶åï¼Œæ˜¯ç­‰äºå¯¹è´Ÿè½½åšé¢„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		setUserInfo:{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			reducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  			state.userInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action.payload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// prepareå‡½æ•°ä¼šæ¥å—dispatch å‚æ•°ï¼Œå¹¶åœ¨å¤„ç†å®ŒåæŠŠè¿™ä¸ªè´Ÿè½½ä¼ é€’ç»™reducer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      prepare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          payload: { </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">						name:userInfo.name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">trim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">						address:userInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">						vip:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">					}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		setUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">action</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PayloadAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GlobalState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;userInfo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]&gt;) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			state.userInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action.payload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯¼å‡º slice ä¸­ç”Ÿæˆçš„ Redux action creators å’Œ reducer å‡½æ•°ï¼ˆè¢«Reduxä½¿ç”¨æ¥æ›´æ–°stateï¼‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¯ä¸ª case reducer å‡½æ•°ä¼šç”Ÿæˆå¯¹åº”çš„ Action creators,è¿™é‡Œå°±ä¸ç”¨å•ç‹¬å†™actionæ–‡ä»¶æ¥ç®¡ç†action</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> globalSlice.actions;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç±»æ¯”vuex getters,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { state.global.token }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> globalSlice.reducer;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨usedispatchè°ƒç”¨action,<code>setToken(&#39;66&#39;),// {type: &#39;global/setToken&#39;, payload: &#39;66&#39;}</code></p><p>é¦–å…ˆä¼šä½¿ç”¨reducers é‡Œçš„ prepareå‡½æ•°æ¥ä¿®æ”¹ä¼ å…¥çš„payloadè´Ÿè½½</p><p>ç„¶ååœ¨å°†ä¿®æ”¹å®Œåpayloadå‚æ•°ä¼ é€’ç»™reducer æ¥è¿›è¡Œstateçš„æ›´æ–°</p><h2 id="_5-createasyncthunk" tabindex="-1">5. createAsyncThunk <a class="header-anchor" href="#_5-createasyncthunk" aria-label="Permalink to &quot;5. createAsyncThunk&quot;">â€‹</a></h2><blockquote><p>ä¸ºå¼‚æ­¥è°ƒç”¨ç”Ÿæˆ thunkï¼ŒcreateAsyncThunk å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå¸¦æœ‰çŠ¶æ€æœºçš„ thunk actionã€‚</p><p>è¿”å›ä¸€ä¸ªPromiseï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆpending/fulfilled/rejected çš„action type</p></blockquote><h3 id="_5-1-createasyncthunkå‡½æ•°çš„å‚æ•°" tabindex="-1">5.1 createAsyncThunkå‡½æ•°çš„å‚æ•° <a class="header-anchor" href="#_5-1-createasyncthunkå‡½æ•°çš„å‚æ•°" aria-label="Permalink to &quot;5.1 createAsyncThunkå‡½æ•°çš„å‚æ•°&quot;">â€‹</a></h3><ol><li><p><strong>type</strong>ï¼šå®šä¹‰action typeï¼Œå­—ç¬¦ä¸²ã€‚å½“å®šä¹‰typeä¸º&#39;users/requestStatus&#39;ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹action typeï¼Œè¡¨ç¤ºå¼‚æ­¥è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</p><ul><li>pending:&#39;users/requestStatus/pending&#39;</li><li>fulfilled:&#39;users/requestStatus/fulfilled&#39;</li><li>rejected:&#39;users/requestStatus/rejected&#39;</li></ul></li><li><p><strong>payloadCreator</strong>ï¼šä¸€ä¸ª â€œpayload creatorâ€ å›è°ƒå‡½æ•°ï¼Œå®šä¹‰å¼‚æ­¥æ“ä½œçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•° payloadè´Ÿè½½ å’Œ thunkAPIå¯¹è±¡ã€‚</p><ul><li>payloadCreatorå›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œpayloadè´Ÿè½½ï¼Œdispatch æ—¶æ— è®ºä¼ å…¥ä»€ä¹ˆéƒ½å°†æˆä¸ºpayload creatorå›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªå€¼ï¼Œè¯·å°†å®ƒä»¬åŒ…è£¹åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­</li><li>payloadCreatorå›è°ƒçš„ç¬¬äºŒä¸ªå‚æ•°ï¼ŒthunkAPIå¯¹è±¡åŒ…å«ä»¥ä¸‹ <ul><li>dispatchï¼šRedux å­˜å‚¨dispatchæ–¹æ³•</li><li>getStateï¼šRedux å­˜å‚¨getStateæ–¹æ³•</li><li>extraï¼šåœ¨è®¾ç½®æ—¶ç»™ thunk ä¸­é—´ä»¶çš„â€œé¢å¤–å‚æ•°â€ã€‚è¿™ç§å¸¸ç”¨æ—¶æŸç§APIçš„å°è£…å™¨ï¼Œå¦‚æœä½ éœ€è¦åœ¨thunkä¸­ä½¿ç”¨APIè°ƒç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨APIå°è£…å™¨æ¥å°è£…æ‰€æœ‰çš„URLå’ŒæŸ¥è¯¢é€šè®¯ï¼Œå¹¶å°†è¿™ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™thunkã€‚</li><li>requestIdï¼šè¯¥thunkè°ƒç”¨çš„å”¯ä¸€éšæœºIDï¼Œç”¨äºè·Ÿè¸ªå•ä¸ªè¯·æ±‚çš„çŠ¶æ€ã€‚</li><li><code>rejectWithValue(value, [meta])</code>: rejectWithValue æ˜¯ä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œæ‚¨å¯ä»¥returnï¼ˆæˆ–throwï¼‰è‡ªå®šä¹‰rejectedçš„è¿”å›å€¼ï¼Œå¦‚æœæ²¡å®šä¹‰rejectWithValueåˆ™è¿”å›action.errorã€‚å¦‚æœæ‚¨è¿˜ä¼ å…¥ a metaï¼Œå®ƒå°†ä¸ç°æœ‰çš„ åˆå¹¶rejectedAction.metaã€‚</li><li>fulfillWithValue(value, meta): fulfillWithValue æ˜¯ä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œä½ å¯ä»¥returnåœ¨ä½ çš„ action creator ä¸­æ·»åŠ fulfillä¸€ä¸ªå€¼ï¼ŒåŒæ—¶å¯ä»¥æ·»åŠ åˆ°fulfilledAction.meta.</li></ul></li></ul></li><li><p><strong>option</strong>ï¼špayloadCreatorå›è°ƒçš„ç¬¬ä¸‰ä¸ªå‚æ•°optionçš„å¯¹è±¡</p><ul><li><code>condition(thunkaArg, { getState, extra } ): boolean | Promise&lt;boolean&gt;</code>ï¼šç”¨äºæ§åˆ¶å–æ¶ˆthunkçš„æ¡ä»¶ï¼Œreturnä¸€ä¸ªå¸ƒå°”å€¼æˆ–promiseä½œä¸ºæ¡ä»¶æ˜¯å¦éœ€è¦å–æ¶ˆã€‚</li><li><code>dispatchConditionRejection: boolean</code> ï¼šå¦‚æœcondition()è¿”å›falseï¼Œé»˜è®¤è¡Œä¸ºæ˜¯æ ¹æœ¬ä¸ä¼šè°ƒåº¦ä»»ä½•åŠ¨ä½œã€‚å¦‚æœæ‚¨ä»ç„¶å¸Œæœ›åœ¨å–æ¶ˆ thunk æ—¶dispatchâ€œrejectedâ€æ“ä½œï¼Œè¯·å°†æ­¤é…ç½®é¡¹è®¾ç½®ä¸ºtrue.</li><li><code>idGenerator(arg): stringrequestId</code>ï¼šç”Ÿæˆè¯·æ±‚åºåˆ—æ—¶ä½¿ç”¨çš„å‡½æ•°ã€‚é»˜è®¤ä½¿ç”¨nanoidï¼Œä½†æ‚¨å¯ä»¥å®ç°è‡ªå·±çš„ ID ç”Ÿæˆé€»è¾‘ã€‚</li><li><code>serializeError(error: unknown) =&gt; anyminiSerializeError</code> ç”¨æ‚¨è‡ªå·±çš„åºåˆ—åŒ–é€»è¾‘æ›¿æ¢å†…éƒ¨æ–¹æ³•ã€‚</li><li><code>getPendingMeta({ arg, requestId }, { getState, extra }): any</code>ï¼šåˆ›å»ºå°†åˆå¹¶åˆ°å­—æ®µä¸­çš„å¯¹è±¡çš„å‡½æ•°pendingAction.metaã€‚</li></ul></li></ol><h3 id="_5-2-å’Œcreateasyncthunkå‡½æ•°-ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">5.2 å’ŒcreateAsyncThunkå‡½æ•° ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#_5-2-å’Œcreateasyncthunkå‡½æ•°-ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;5.2 å’ŒcreateAsyncThunkå‡½æ•° ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h3><ol><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong></li></ol><p>è¿™ä¸ª thunk action ä¼š dispatch &quot;pending&quot;ã€&quot;fulfilled&quot; å’Œ &quot;rejected&quot; ä¸‰ç§ action ç±»å‹ï¼Œåˆ†åˆ«å¯¹åº”å¼‚æ­¥æ“ä½œçš„ä¸‰ç§çŠ¶æ€ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fetchTodos.pendingï¼štodos/fetchTodos/pending</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fetchTodos.fulfilledï¼štodos/fetchTodos/fulfilled</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fetchTodos.rejectedï¼štodos/fetchTodos/rejected</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchTodos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAsyncThunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;todos/fetchTodos&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,{</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ï¼Œ</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi/todos&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.todos</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li><strong>ç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„tsç±»å‹</strong></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¥å£ï¼Œç”¨äºæè¿°ä¸€ä¸ªåºåˆ—åŒ–çš„é”™è¯¯å¯¹è±¡ã€‚å®ƒåŒ…å«äº†é”™è¯¯çš„åç§°ã€æ¶ˆæ¯ã€ä»£ç å’Œå †æ ˆä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SerializedError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  stack</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¥å£ï¼Œç”¨äºæè¿°ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„â€œç­‰å¾…ä¸­â€çŠ¶æ€ã€‚å®ƒåŒ…å«äº†actionçš„typeã€payloadå’Œmeta(å…¶ä¸­åŒ…æ‹¬è¯·æ±‚IDå’Œæ“ä½œå‚æ•°ã€‚)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PendingAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¥å£ï¼Œç”¨äºæè¿°ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„â€œå·²å®Œæˆâ€çŠ¶æ€ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FulfilledAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PromiseResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PromiseResult</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¥å£ï¼Œç”¨äºæè¿°ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„â€œå·²æ‹’ç»â€çŠ¶æ€ã€‚å®ƒåŒ…å«äº†actionçš„typeã€payloadã€errorå¯¹è±¡å’Œmeta(å…¶ä¸­åŒ…æ‹¬è¯·æ±‚IDã€æ“ä½œå‚æ•°ã€æ˜¯å¦ä¸­æ­¢å’Œæ¡ä»¶ã€‚)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RejectedAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SerializedError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    aborted</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¥å£ï¼Œç”¨äºæè¿°ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„â€œå·²æ‹’ç»â€çŠ¶æ€ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªæ‹’ç»å€¼ã€‚å®ƒåŒ…å«äº†actionçš„typeã€payloadã€errorå¯¹è±¡å’Œmeta(å…¶ä¸­åŒ…æ‹¬è¯·æ±‚IDã€æ“ä½œå‚æ•°å’Œæ˜¯å¦ä¸­æ­¢ã€‚)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RejectedWithValueAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RejectedValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RejectedValue</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Rejected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    aborted</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç±»å‹åˆ«åï¼Œç”¨äºæè¿°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—è¯·æ±‚IDå’Œæ“ä½œå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªâ€œç­‰å¾…ä¸­â€çŠ¶æ€çš„æ“ä½œå¯¹è±¡ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pending</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PendingAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç±»å‹åˆ«åï¼Œç”¨äºæè¿°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—å¼‚æ­¥æ“ä½œçš„ç»“æœã€è¯·æ±‚IDå’Œæ“ä½œå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªâ€œå·²å®Œæˆâ€çŠ¶æ€çš„æ“ä½œå¯¹è±¡ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fulfilled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PromiseResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PromiseResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FulfilledAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PromiseResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç±»å‹åˆ«åï¼Œç”¨äºæè¿°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—è¯·æ±‚IDå’Œæ“ä½œå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªâ€œå·²æ‹’ç»â€çŠ¶æ€çš„æ“ä½œå¯¹è±¡ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rejected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RejectedAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç±»å‹åˆ«åï¼Œç”¨äºæè¿°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—è¯·æ±‚IDã€æ“ä½œå‚æ•°å’Œæ‹’ç»å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªâ€œå·²æ‹’ç»â€çŠ¶æ€çš„æ“ä½œå¯¹è±¡ã€‚ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RejectedWithValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RejectedValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  requestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThunkArg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RejectedWithValueAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ThunkArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RejectedValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><ol start="3"><li><strong>extraReducers ç›‘å¬ç”Ÿå‘½å‘¨æœŸ</strong></li></ol><blockquote><p>extraReducers ä¸€ä¸ªæ˜¯ç”¨é€”æ˜¯ç›‘å¬createAsyncThunkè¿”å›çš„çŠ¶æ€æœºã€‚</p><p>å¦ä¸€ä¸ªç”¨é€”æ˜¯ç”¨æ¥ä¹¦å†™å¤šä¸ªreduceré‡å¤éƒ¨åˆ†ï¼Œå°†ä»–ä»¬æ•´ç†å…±äº«åŒ–ï¼Œè§£å†³å†—ä½™é—®é¢˜ã€‚ç”šè‡³å¯ä»¥ä½¿ç”¨å…¶ä»–sliceä¸‹çš„actionã€‚</p></blockquote><ul><li>builder.addCase(actionCreator, reducer)ï¼šå®šä¹‰ä¸€ä¸ª case reducerï¼Œå®ƒå“åº” RTK action creator ç”Ÿæˆæˆ–è€…æ™®é€šå­—ç¬¦ä¸²å®šä¹‰çš„ actionã€‚</li><li>builder.addMatcher(matcher, reducer)ï¼šå®šä¹‰ä¸€ä¸ª case reducerï¼Œå®ƒå¯ä»¥å“åº”ä»»ä½• matcher å‡½æ•°è¿”å› true çš„ action.</li><li>builder.addDefaultCase(reducer)ï¼šå®šä¹‰ä¸€ä¸ª case reducerï¼Œå¦‚æœæ²¡æœ‰å…¶ä»– case reducer è¢«æ‰§è¡Œï¼Œè¿™ä¸ª action å°±ä¼šè¿è¡Œã€‚</li></ul><p>ä½ å¯ä»¥å°†è¿™äº›é“¾æ¥åœ¨ä¸€èµ·ï¼Œä¾‹å¦‚builder.addCase().addCase().addMatcher().addDefaultCase()ã€‚ å¦‚æœå¤šä¸ªåŒ¹é…å™¨åŒ¹é…æ“ä½œï¼Œå®ƒä»¬å°†æŒ‰ç…§å®šä¹‰çš„é¡ºåºè¿è¡Œã€‚</p><p>åœ¨ Redux Toolkit ä¸­ï¼ŒextraReducers çš„ addCase æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª action creatorï¼Œç”¨äºç›‘å¬ç›¸åº”çš„ action ç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† createAsyncThunk å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªåä¸º &quot;posts/fetchPosts&quot; çš„å¼‚æ­¥ thunk actionã€‚åœ¨ extraReducers ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬äº†è¿™ä¸ª thunk action dispatch çš„ &quot;pending&quot;ã€&quot;fulfilled&quot; å’Œ &quot;rejected&quot; ä¸‰ç§ action ç±»å‹ï¼Œå¹¶åœ¨ç›¸åº”çš„ reducer ä¸­æ›´æ–°äº† stateã€‚</p><p>åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† createAsyncThunk å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªåä¸º &quot;posts/fetchPosts&quot; çš„å¼‚æ­¥ thunk actionã€‚åœ¨ extraReducers ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬äº†è¿™ä¸ª thunk action dispatch çš„ &quot;pending&quot;ã€&quot;fulfilled&quot; å’Œ &quot;rejected&quot; ä¸‰ç§ action ç±»å‹ï¼Œå¹¶åœ¨ç›¸åº”çš„ reducer ä¸­æ›´æ–°äº† stateã€‚åœ¨ &quot;pending&quot; reducer ä¸­ï¼Œæˆ‘ä»¬å°† state.status è®¾ç½®ä¸º &#39;loading&#39;ï¼›åœ¨ &quot;fulfilled&quot; reducer ä¸­ï¼Œæˆ‘ä»¬å°† state.status è®¾ç½®ä¸º &#39;succeeded&#39;ï¼Œå¹¶å°† action.payload ä¸­çš„æ•°æ®æ·»åŠ åˆ° state.posts æ•°ç»„ä¸­ï¼›åœ¨ &quot;rejected&quot; reducer ä¸­ï¼Œæˆ‘ä»¬å°† state.status è®¾ç½®ä¸º &#39;failed&#39;ï¼Œå¹¶å°† action.error.message å­˜å‚¨åœ¨ state.error ä¸­ã€‚</p><p>ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createSlice, createAsyncThunk } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { client } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../../api/client&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAsyncThunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;posts/fetchPosts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> postsSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSlice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialState,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducers: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // omit existing reducers here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  extraReducers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    builder</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fetchPosts.pending, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;loading&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fetchPosts.fulfilled, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;succeeded&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state.posts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(action.payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fetchPosts.rejected, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;failed&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state.error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action.error.message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_5-3-å¤„ç†thunkçš„çš„ç»“æœ" tabindex="-1">5.3 å¤„ç†thunkçš„çš„ç»“æœ <a class="header-anchor" href="#_5-3-å¤„ç†thunkçš„çš„ç»“æœ" aria-label="Permalink to &quot;5.3 å¤„ç†thunkçš„çš„ç»“æœ&quot;">â€‹</a></h3><p>createAsyncThunk åœ¨å†…éƒ¨å¤„ç†äº†æ‰€æœ‰é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ—¥å¿—ä¸­çœ‹ä¸åˆ°ä»»ä½•å…³äºâ€œrejected Promisesâ€çš„æ¶ˆæ¯ã€‚ç„¶åå®ƒè¿”å›å®ƒ dispatch çš„æœ€ç»ˆ actionï¼šå¦‚æœæˆåŠŸåˆ™è¿”å›â€œå·²å®Œæˆâ€ actionï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›â€œæ‹’ç»â€ actionã€‚Redux Toolkit æœ‰ä¸€ä¸ªåä¸º unwrapResult çš„å·¥å…·å‡½æ•°ï¼Œå®ƒå°†è¿”å›æ¥è‡ª fulfilled action çš„ action.payload æ•°æ®ï¼Œæˆ–è€…å¦‚æœå®ƒæ˜¯ rejected action åˆ™æŠ›å‡ºé”™è¯¯ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£å¸¸çš„ try/catch é€»è¾‘å¤„ç†ç»„ä»¶ä¸­çš„æˆåŠŸå’Œå¤±è´¥ã€‚</p><p>ä½†æ˜¯ï¼Œæƒ³è¦ç¼–å†™æŸ¥çœ‹å®é™…è¯·æ±‚æˆåŠŸæˆ–å¤±è´¥çš„é€»è¾‘æ˜¯å¾ˆå¸¸è§çš„ã€‚ Redux Toolkit å‘è¿”å›çš„ Promise æ·»åŠ äº†ä¸€ä¸ª .unwrap() å‡½æ•°ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¿™ä¸ª Promise åœ¨ fulfilled çŠ¶æ€æ—¶è¿”å›å®é™…çš„ action.payload å€¼ï¼Œæˆ–è€…åœ¨ rejectedâ€çŠ¶æ€ä¸‹æŠ›å‡ºé”™è¯¯ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£å¸¸çš„â€œtry/catchâ€é€»è¾‘å¤„ç†ç»„ä»¶ä¸­çš„æˆåŠŸå’Œå¤±è´¥ã€‚ å› æ­¤ï¼Œå¦‚æœå¸–å­åˆ›å»ºæˆåŠŸï¼Œæˆ‘ä»¬å°†æ¸…é™¤è¾“å…¥å­—æ®µä»¥é‡ç½®è¡¨å•ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™å°†é”™è¯¯è®°å½•åˆ°æ§åˆ¶å°ã€‚</p><ol><li><strong>unwrap å¤„ç†ç»“æœä¸ºæ ‡å‡†çš„promiseé£æ ¼</strong></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç»„ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> originalPromiseResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchUserById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¤„ç†ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rejectedValueOrSerializedError) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li><strong>rejectWithValue è‡ªå®šä¹‰é”™è¯¯çš„è¿”å›</strong></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨rejectWithValue</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updateUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAsyncThunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;users/update&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rejectWithValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userData</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userAPI.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id, fields)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data.user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Use \`err.response.data\` as \`action.payload\` for a \`rejected\` action,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // by explicitly returning it using the \`rejectWithValue()\` utility</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rejectWithValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err.response.data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_5-4-å–æ¶ˆthunk" tabindex="-1">5.4 å–æ¶ˆthunk <a class="header-anchor" href="#_5-4-å–æ¶ˆthunk" aria-label="Permalink to &quot;5.4 å–æ¶ˆthunk&quot;">â€‹</a></h3><ol><li><strong>thunkæ‰§è¡Œå‰æ˜¯å¦å–æ¶ˆçš„åˆ¤æ–­</strong></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchUserById</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAsyncThunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;users/fetchByIdStatus&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">thunkAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userAPI.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// createAsyncThunkç¬¬ä¸‰ä¸ªå‚æ•°option</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// condition å›è°ƒç”¨äºåˆ¤æ–­æ‰§è¡Œå‰æ˜¯å¦éœ€è¦å–æ¶ˆ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - conditionå›è°ƒ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯thunkä¼ é€’çš„å‚æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   	// - conditionå›è°ƒ ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ˜¯ä¸ªå¯¹è±¡ï¼Œ{getState, extra}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    condition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">extra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchStatus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users.requests[userId]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (fetchStatus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fulfilled&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fetchStatus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;loading&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å·²ç»fetchè¿‡æˆ–è€…loadingä¸­ , ä¸éœ€è¦é‡æ–°fetch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// é…ç½®é¡¹dispatchConditionRejectionç”¨äºcondition()return falseçš„æ—¶å€™ä»ç„¶dispatch ä¸€ä¸ªrejectedçš„action</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		dispatchConditionRejection:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol start="2"><li><strong>æ‰§è¡Œthunkä¸­ç»ˆæ­¢</strong> createAsyncThunk è¿”å›çš„promiseæœ‰ä¸ªabort()æ–¹æ³•ï¼Œå¯ä»¥å–æ¶ˆã€‚</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">props</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dispatch</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useAppDispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  React.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Dispatching thunk è¿”å›ä¸€ä¸ªpromise</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchUserById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(props.userId))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // createAsyncThunk è¿”å›çš„promiseæœ‰ä¸ªabort()æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      promise.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [props.userId])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ä»¥ä¸Šé¢è¿™ç§æ–¹å¼å–æ¶ˆ thunk åï¼Œå®ƒå°†åˆ†æ´¾ï¼ˆå¹¶è¿”å›ï¼‰ä¸€ä¸ªâ€œthunkName/rejectedâ€æ“ä½œï¼Œé”™è¯¯å±æ€§ä¸Šå¸¦æœ‰ AbortErrorã€‚ thunk ä¸ä¼šå‘é€ä»»ä½•è¿›ä¸€æ­¥çš„æ“ä½œã€‚</p><p>å¦‚æœä½ ä½¿ç”¨fetchï¼Œå¯ä»¥é€šè¿‡ thunkAPI.signal ä¼ é€’çš„ AbortSignal æ¥å®é™…å–æ¶ˆå¼‚æ­¥æ“ä½œã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchUserById</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAsyncThunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;users/fetchById&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">thunkAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`https://reqres.in/api/users/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      signal: thunkAPI.signal,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li><strong>é€šè¿‡thunkapiçš„signal.abortedæ£€æŸ¥å–æ¶ˆçš„çŠ¶æ€</strong></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createAsyncThunk } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAsyncThunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;readStream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stream.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> done </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">done) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (signal.aborted) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;stop the work, this has been aborted!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> read</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read.value</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      done </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read.done</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="4"><li><strong>åˆ¤æ–­ä¸€ä¸ªrejectedçš„é”™è¯¯æ˜¯ç”±ç½‘ç»œé”™è¯¯è¿˜æ˜¯ä¸»åŠ¨å–æ¶ˆçš„</strong></li></ol><p>è¦è°ƒæŸ¥æœ‰å…³ thunk å–æ¶ˆçš„è¡Œä¸ºï¼Œæ‚¨å¯ä»¥æ£€æŸ¥å·²è°ƒåº¦æ“ä½œçš„å…ƒå¯¹è±¡çš„å„ç§å±æ€§ã€‚ å¦‚æœä¸€ä¸ª thunk è¢«å–æ¶ˆï¼Œpromise çš„ç»“æœå°†æ˜¯ä¸€ä¸ªè¢«æ‹’ç»çš„åŠ¨ä½œï¼ˆä¸ç®¡é‚£ä¸ªactionæ˜¯å¦çœŸçš„dispatchåˆ°storeï¼‰ã€‚</p><ul><li>meta.condition å°†ä¸ºçœŸï¼Œè¯´æ˜åœ¨æ‰§è¡Œå‰å–æ¶ˆã€‚</li><li>meta.aborted å°†ä¸ºçœŸï¼Œè¯´æ˜åœ¨è¿è¡Œæ—¶ç»ˆæ­¢ã€‚</li><li>å¦‚æœè¿™ä¸¤ä¸ªéƒ½ä¸ä¸ºçœŸï¼Œåˆ™ thunk ä¸ä¼šè¢«å–æ¶ˆï¼Œå®ƒåªæ˜¯è¢«æ‹’ç»ï¼Œæˆ–è€…è¢« Promise æ‹’ç»æˆ– rejectWithValue æ‹’ç»ã€‚</li><li>å¦‚æœ thunk æ²¡æœ‰è¢«æ‹’ç»ï¼Œåˆ™ meta.aborted å’Œ meta.condition éƒ½å°†æ˜¯æœªå®šä¹‰çš„ã€‚</li></ul><h2 id="_6-selectorã€useselector-å’Œ-createselector" tabindex="-1">6. selectorã€useSelector å’Œ createSelector <a class="header-anchor" href="#_6-selectorã€useselector-å’Œ-createselector" aria-label="Permalink to &quot;6. selectorã€useSelector å’Œ createSelector&quot;">â€‹</a></h2><h3 id="_6-1-selector-çº¯å‡½æ•°" tabindex="-1">6.1 selectorï¼ˆçº¯å‡½æ•°ï¼‰ <a class="header-anchor" href="#_6-1-selector-çº¯å‡½æ•°" aria-label="Permalink to &quot;6.1 selectorï¼ˆçº¯å‡½æ•°ï¼‰&quot;">â€‹</a></h3><blockquote><p>Selector æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç”¨æ¥ä» Redux store ä¸­è·å–æ•°æ®å¹¶è¿›è¡Œè½¬æ¢æˆ–è®¡ç®—ï¼Œè¿”å›è§†å›¾ç»„ä»¶éœ€è¦çš„æ•°æ®ï¼Œè¿™æœ‰åŠ©äºå‡å°‘è§†å›¾ç»„ä»¶ä¸­çš„é€»è¾‘ã€‚</p><p>Selector æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥æ”¶æ•°æ®ä½œä¸ºå‚æ•°å¹¶è¿”å›æ–°çš„æ•°æ®ç»“æœã€‚</p></blockquote><p>ç”±äºselector ä¸ä¾èµ–é¢å¤–çš„åº“ï¼Œåªæ˜¯ä¸ªçº¯å‡½æ•°,ä»¥ä¸‹å†™æ³•éƒ½æ˜¯å¯è¡Œçš„ã€‚å¦å¤–åˆ«å¿˜äº†åœ¨æ ¹ç»„ä»¶ä½¿ç”¨provider å®ç°å…¨ç»„ä»¶é€ä¼ ï¼Œä¿è¯èƒ½åœ¨æ‰€æœ‰ç»„ä»¶ä¸­è®¿é—® Store ä¸­çš„çŠ¶æ€å’Œ dispatch æ–¹æ³•ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç®­å¤´å‡½æ•°ï¼Œç›´æ¥æŸ¥æ‰¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectEntities</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.entities</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‡½æ•°å£°æ˜ï¼Œæ˜ å°„æ•°ç»„æ¥æ´¾ç”Ÿå€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectItemIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‡½æ•°å£°æ˜ï¼Œå°è£…æ·±åº¦æŸ¥æ‰¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectSomeSpecificField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.some.deeply.nested.field</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç®­å¤´å‡½æ•°ï¼Œä»æ•°ç»„ä¸­æ´¾ç”Ÿå€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectItemsWhoseNamesStartWith</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">namePrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(namePrefix))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Selector å‡½æ•°é€šå¸¸å®šä¹‰åœ¨ Redux åº”ç”¨ç¨‹åºçš„ä¸¤ä¸ªåœ°æ–¹ï¼š</p><ul><li>åœ¨ slice æ–‡ä»¶ä¸­ï¼Œä¸ reducer é€»è¾‘ä¸€èµ·</li><li>åœ¨ç»„ä»¶æ–‡ä»¶ä¸­ï¼Œåœ¨ç»„ä»¶å¤–éƒ¨ï¼Œæˆ–åœ¨ useSelector ä¸­ç›´æ¥å®šä¹‰</li></ul><h3 id="_6-2-useselector-hook-å‡½æ•°-ç”¨äºåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®ç°æ•°æ®è‡ªåŠ¨æ›´æ–°" tabindex="-1">6.2 useSelectorï¼ˆ hook å‡½æ•°ï¼Œç”¨äºåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®ç°æ•°æ®è‡ªåŠ¨æ›´æ–°ï¼‰ <a class="header-anchor" href="#_6-2-useselector-hook-å‡½æ•°-ç”¨äºåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®ç°æ•°æ®è‡ªåŠ¨æ›´æ–°" aria-label="Permalink to &quot;6.2 useSelectorï¼ˆ hook å‡½æ•°ï¼Œç”¨äºåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®ç°æ•°æ®è‡ªåŠ¨æ›´æ–°ï¼‰&quot;">â€‹</a></h3><blockquote><p>useSelector æ¥æ”¶ä¸€ä¸ª selector å‡½æ•°ã€‚selector å‡½æ•°æ¥æ”¶ Redux store çš„ state ä½œä¸ºå…¶å‚æ•°ï¼Œç„¶åä» state ä¸­å–å€¼å¹¶è¿”å›ã€‚</p></blockquote><p>æ ¹æ®Reduxå®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨useSelectoré’©å­æ—¶ï¼Œå¦‚æœselectorå‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°stateï¼Œåˆ™å¯ä»¥ç›´æ¥çœç•¥ä¼ å…¥å‚æ•°ï¼Œå› ä¸ºuseSelectorä¼šè‡ªåŠ¨å°†stateä½œä¸ºå‚æ•°ä¼ å…¥selectorå‡½æ•°ä¸­ã€‚è€Œå¦‚æœselectorå‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ä¼ å…¥æ‰€æœ‰å‚æ•°ã€‚</p><p>useSelectorçš„ä½œç”¨æ˜¯åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿ç”¨ Selectorï¼Œç”¨äºç›‘å¬ Redux Store ä¸­æ•°æ®çš„å˜åŒ–ï¼Œå½“ Store ä¸­å­˜å‚¨çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè‡ªåŠ¨é‡æ–°è°ƒç”¨ç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚</p><p>é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿä½¿ç”¨äº†===å…¨ç­‰ï¼Œæ•°æ®å¦‚æœæ²¡å˜ï¼Œåªæ˜¯å¼•ç”¨åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚ï¼ˆæ¯”å¦‚map()æˆ–filter()æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„çš„å¼•ç”¨ï¼‰</p><p><code>const result: any = useSelector(selector: Function, equalityFn?: Function)</code></p><p>useSelector()æ˜¯React Reduxä¸­çš„ä¸€ä¸ªhookï¼Œç”¨äºä»Redux storeä¸­é€‰å–stateå¹¶è®¢é˜…å…¶å˜åŒ–ã€‚ç¬¬ä¸€ä¸ªå‚æ•°selectoræ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºé€‰ä¸­éœ€è¦è®¢é˜…çš„stateã€‚ç¬¬äºŒä¸ªå‚æ•°equalityFnæ˜¯ä¸€ä¸ªå¯é€‰çš„å‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒå‰åä¸¤æ¬¡é€‰ä¸­çš„stateæ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœä¸ä¼ å…¥equalityFnï¼ŒuseSelector()ä¼šä½¿ç”¨===è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¼ å…¥äº†equalityFnï¼Œåˆ™ä¼šä½¿ç”¨è¯¥å‡½æ•°è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå‰åä¸¤æ¬¡é€‰ä¸­çš„stateç›¸ç­‰ï¼ŒuseSelector()å°†ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœä¸ä¼ å…¥equalityFnï¼ŒuseSelector()å°†ä¼šå¯¹é€‰ä¸­çš„æ•´ä¸ªstateè¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœä¼ å…¥äº†equalityFnï¼Œåˆ™ä¼šä½¿ç”¨è¯¥å‡½æ•°è¿›è¡Œæ¯”è¾ƒã€‚</p><h3 id="_6-3-createselector-å¸¦ç¼“å­˜çš„-selector-å‡½æ•°" tabindex="-1">6.3 createSelector ï¼ˆå¸¦ç¼“å­˜çš„ Selector å‡½æ•°ï¼‰ <a class="header-anchor" href="#_6-3-createselector-å¸¦ç¼“å­˜çš„-selector-å‡½æ•°" aria-label="Permalink to &quot;6.3 createSelector ï¼ˆå¸¦ç¼“å­˜çš„ Selector å‡½æ•°ï¼‰&quot;">â€‹</a></h3><p><code>const selectTodoIds = state =&gt; state.todos.map(todo =&gt; todo.id)</code></p><p>useSelector(selectTodoIds) å°†æ€»æ˜¯é€ æˆé‡æ¸²æŸ“ï¼Œå› ä¸ºè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°æ•°ç»„å¼•ç”¨ï¼ç»„ä»¶ä¸€å®šä¼šé‡æ–°æ¸²æŸ“ï¼Œé€ æˆæ€§èƒ½æµªè´¹ã€‚</p><ol><li><strong>createSelector æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</strong><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°input selectoræ˜¯ä¸€ä¸ªæ”¶é›†ä¾èµ–æ•°ç»„ï¼ˆä¸å†™æ•°ç»„ï¼Œå°±æŒ‰å•ç‹¬çš„å‚æ•°åˆ†åˆ«ä¼ å…¥ï¼‰ï¼ŒåŒ…å«äº†æ‰€æœ‰éœ€è¦ memoize ç¼“å­˜çš„ selectorã€‚å¦‚æœè¿™äº›selectorçš„è¾“å…¥å‚æ•°æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ä¸Šä¸€æ¬¡è®¡ç®—çš„ç»“æœï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„è®¡ç®—ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°output selectoræ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®¡ç®—æ–°çš„å€¼ã€‚è¿™ä¸ªå‡½æ•°çš„å…¥å‚åˆ†åˆ«æ˜¯input selectorä¸­selectorçš„è¾“å‡ºå€¼ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªè¾“å‡º===æ¯”è¾ƒåš ä¸åŒï¼Œå®ƒå°†é‡æ–°è¿è¡Œ output selector</li></ul></li></ol><p><strong>â€œinput selectorâ€é€šå¸¸åº”è¯¥åªæå–å’Œè¿”å›å€¼ï¼Œè€Œâ€œoutput selectorâ€åº”è¯¥å®Œæˆè½¬æ¢å·¥ä½œã€‚</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// memoizeç¼“å­˜å‡½æ•°å·¥ä½œåŸç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> memoize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">. </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args) ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache [key];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache [key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args) ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache[key];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="2"><li><strong>createSelector çš„å‡ ä¸ªæ³¨æ„ç‚¹</strong><ul><li>åªè®°å¿†æœ€è¿‘çš„ä¸€ç»„å‚æ•°ï¼Œé€šè¿‡ä¸Šé¢çš„ç¼“å­˜å‡½æ•°å·¥ä½œåŸç†åº”è¯¥å°±å¯ä»¥ç†è§£</li><li>æ‰€æœ‰â€œinput selectorâ€éƒ½åº”è¯¥æ¥æ”¶ç›¸åŒç±»å‹çš„å‚æ•°</li><li>createSelector å¯ä»¥åµŒå¥—ä½¿ç”¨</li><li>å¦‚æœéœ€è¦ç»™output selector ä¼ é€’é¢å¤–çš„å‚æ•°ï¼Œéœ€è¦é¢å¤–å®šä¹‰ä¸€ä¸ªinput selector ç›´æ¥è¿”å›è¿™ä¸ªå€¼</li><li>createSelector çš„é»˜è®¤ç¼“å­˜æ¯ä¸ª Selector çš„å”¯ä¸€å®ä¾‹ï¼Œä½¿ç”¨ä¸€ä¸ªselectorå·¥å‚å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨æ¯æ¬¡è°ƒç”¨æ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„selectorå®ä¾‹</li></ul></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¦‚æœéœ€è¦ç»™output selector ä¼ é€’é¢å¤–çš„å‚æ•°ï¼Œéœ€è¦é¢å¤–å®šä¹‰ä¸€ä¸ªinput selector ç›´æ¥è¿”å›è¿™ä¸ªå€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectItemsByCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é€šå¸¸çš„ç¬¬ä¸€ä¸ªè¾“å…¥ - ä» state ä¸­æå–å€¼</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.items,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è·å–ç¬¬äºŒä¸ªå‚æ•°ï¼Œ\`category\`ï¼Œå¹¶è½¬å‘åˆ° output selector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">category</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> category</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Output selector æ‹¿åˆ° (\`items, category)\` å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">category</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.category </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> category)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿™ä¸ªæ–°å‡½æ•°å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é€‰æ‹©å™¨å‡½æ•°ï¼Œè¿™äº›å‡½æ•°éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ“ä½œå®ƒä»¬è‡ªå·±çš„ items å’Œ category å‚æ•°ã€‚å› æ­¤ï¼Œè¿™ä¸ªå‡½æ•°ç¬¦åˆå·¥å‚å‡½æ•°çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´è½»æ¾åœ°åˆ›å»ºå’Œç®¡ç†å¯¹è±¡ã€‚ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> makeSelectItemsByCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectItemsByCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.items, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">category</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> category],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">category</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.category </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> category)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> selectItemsByCategory</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_6-4-å’Œselectorâ€‹ç›¸å…³çš„ä¸€äº›çŸ¥è¯†ç‚¹" tabindex="-1">6.4 å’ŒSelectorâ€‹ç›¸å…³çš„ä¸€äº›çŸ¥è¯†ç‚¹ <a class="header-anchor" href="#_6-4-å’Œselectorâ€‹ç›¸å…³çš„ä¸€äº›çŸ¥è¯†ç‚¹" aria-label="Permalink to &quot;6.4 å’ŒSelectorâ€‹ç›¸å…³çš„ä¸€äº›çŸ¥è¯†ç‚¹&quot;">â€‹</a></h3><ol><li><p><strong>è°ƒç”¨ Selectorä¼ é€’é¢å¤–çš„å‚æ•°</strong></p><p>ä½¿ç”¨useSelectorè°ƒç”¨Selectorå‡½æ•°æ—¶ï¼Œåªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œå³Reduxæ ¹stateã€‚å¦‚æœéœ€è¦ä¼ é€’å…¶ä»–å‚æ•°ï¼Œå¯ä»¥å°†ä¸€ä¸ªåŒ¿åSelectorå‡½æ•°ä¼ é€’ç»™useSelectorï¼Œç„¶ååœ¨è¯¥å‡½æ•°å†…éƒ¨è°ƒç”¨çœŸæ­£çš„Selectorå‡½æ•°å¹¶ä¼ é€’æ‰€éœ€çš„å‚æ•°ã€‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼ŒselectTodoByIdæ˜¯çœŸæ­£çš„Selectorå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å°†åŒ¿åSelectorå‡½æ•°ä¼ é€’ç»™useSelectoræ¥ä¼ é€’todoIdå‚æ•°ã€‚</p></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectTodoById } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./todosSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TodoListitem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">todoId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä»ä½œç”¨åŸŸä¸­æ•è· \`todoId\`ï¼Œè·å– \`state\` ä½œä¸ºå‚æ•°ï¼Œå¹¶è½¬å‘ä¸¤è€…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ°å®é™…çš„ Selector å‡½æ•°æ¥æå–ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> todo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectTodoById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state, todoId))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li><p><strong>åˆ›å»ºå”¯ä¸€çš„ Selector å®ä¾‹</strong></p><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œéœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­é‡ç”¨ Selector å‡½æ•°ã€‚å¦‚æœç»„ä»¶éƒ½å°†ä½¿ç”¨ä¸åŒçš„å‚æ•°è°ƒç”¨ Selector ï¼Œå®ƒå°†ç ´åè®°å¿† - Selector æ°¸è¿œä¸ä¼šè¿ç»­å¤šæ¬¡çœ‹åˆ°ç›¸åŒçš„å‚æ•°ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè¿”å›ç¼“å­˜å€¼ã€‚</p></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { makeSelectItemsByCategory } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./categoriesSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CategoryList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">category</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åœ¨æŒ‚è½½æ—¶ä¸ºæ¯ä¸ªç»„ä»¶å®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°çš„è®°å¿†åŒ– Selector</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectItemsByCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMemo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(makeSelectItemsByCategory, [])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> itemsByCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    selectItemsByCategory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state, category)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="3"><li><p><strong>æœ€å¥½å°†å¯é‡ç”¨çš„ Selector ä¸ç›¸åº”çš„ reducer ä¸€èµ·å®šä¹‰ï¼Œè€Œä¸æ˜¯å®šä¹‰åœ¨ç»„ä»¶é‡Œã€‚</strong></p></li><li><p><strong>é€‚åº¦ä½¿ç”¨ Selector å’Œ è®°å¿†åŒ–</strong></p><p>ä¸è¦ç»™æ¯ä¸ªå­—æ®µå®šä¹‰Selectorã€‚å§‹ç»ˆè¿”å›ä¸€è‡´çš„å¼•ç”¨å’Œæ´¾ç”Ÿæ•°æ®ï¼Œä½†æ˜¯è¿”å›ä¸€è‡´çš„ç»“æœ ä¸è¦ä½¿ç”¨è®°å¿†åŒ–ã€‚é‡åˆ°mapå’Œfilter æ¯æ¬¡è°ƒç”¨è¿”å›æ–°çš„å¼•ç”¨å¯ä»¥shyingè®°å¿†åŒ–ã€‚</p></li><li><p><strong>Redux ä¸­ selector ä¸­åˆ†ä¸º æ•´ä½“å¼ Selector å’Œ å±€éƒ¨å¼ Selector</strong></p><ul><li>â€œæ•´ä½“å¼â€ Selector è¿”å›çŠ¶æ€æ ‘ä¸­æŸä¸€éƒ¨åˆ†ï¼Œå…¥å‚é€šå¸¸åªæœ‰ä¸€ä¸ªï¼Œæ•´ä¸ªstateã€‚è¿”å›é€šå¸¸ä¸ä¼šå˜ï¼Œæ‰€ä»¥è¦ç”¨createSelectorä½œç¼“å­˜</li><li>â€œå±€éƒ¨å¼â€ Selector è·å–ç‰¹å®šåŒºåŸŸçš„çŠ¶æ€ï¼Œå…¥å‚é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œæ ¹æ®å‚æ•°è®¡ç®—è¿”å›ï¼Œä¸ä½œç¼“å­˜ã€‚</li></ul></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;æ•´ä½“å¼ Globalized&quot; - åªæ¥å—stateä½œä¸ºå‚æ•°ï¼Œä½œç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createSelector } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;reselect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectUsers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.users;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectActiveUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  selectUsers,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users.activeUser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;å±€éƒ¨å¼ Localized&quot; - æ¥å—å¤šä¸ªå‚æ•°ï¼Œé€šå¸¸ä¸åšç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectUsersByEmail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">userList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.users;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> email);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Redux Toolkit çš„ createEntityAdapter API å°±æ˜¯è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªä¾‹å­ã€‚å¦‚æœä½ è°ƒç”¨ todosAdapter.getSelectors()ï¼Œä¸å¸¦å‚æ•°ï¼Œå®ƒä¼šè¿”å›ä¸€ç»„â€œå±€éƒ¨å¼â€ Selector ï¼Œè¿™äº› Selector æ¥æ”¶ slice state ä½œä¸ºå®ƒä»¬çš„å‚æ•°ã€‚å¦‚æœä½ è°ƒç”¨ todosAdapter.getSelectors(state =&gt; state.todos)ï¼Œå®ƒä¼šè¿”å›ä¸€ç»„â€œå…¨çƒåŒ–â€ Selector ï¼Œè¿™äº› Selector æœŸæœ›ä»¥ Redux æ ¹ state ä½œä¸ºå‚æ•°æ¥è°ƒç”¨ã€‚</p><h2 id="_7-createentityadapter-ç®¡ç†çŠ¶æ€" tabindex="-1">7. createEntityAdapterï¼ˆç®¡ç†çŠ¶æ€ï¼‰ <a class="header-anchor" href="#_7-createentityadapter-ç®¡ç†çŠ¶æ€" aria-label="Permalink to &quot;7. createEntityAdapterï¼ˆç®¡ç†çŠ¶æ€ï¼‰&quot;">â€‹</a></h2><blockquote><p>å½“ä½¿ç”¨Reduxï¼ˆæˆ–å…¶å®ƒç±»ä¼¼çŠ¶æ€ç®¡ç†åº“ï¼‰ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€æ—¶ï¼Œå®ƒé€šå¸¸æ˜¯ç”±å¤šä¸ªå®ä½“ç»„æˆçš„ï¼Œä¾‹å¦‚ç”¨æˆ·ã€åšå®¢ã€æ³¨é‡Šç­‰ã€‚createEntityAdapterçš„ä½œç”¨å°±æ˜¯å¯¹è¿™äº›å®ä½“è¿›è¡Œç®¡ç†ã€‚</p><p>å®ƒæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ¥å£æ¥æ“ä½œå®ä½“çš„çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°é€‰æ‹©å’ŒæŸ¥è¯¢å®ä½“ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è¯¥APIï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ·»åŠ ã€æ›´æ–°å’Œåˆ é™¤å®ä½“ï¼Œå¹¶æ”¯æŒæŒ‰ç…§å¤šç§æ¡ä»¶æŸ¥è¯¢å®ä½“ <a href="https://cn.redux.js.org/tutorials/fundamentals/part-8-modern-redux#using-createentityadapter" target="_blank" rel="noreferrer">ä½¿ç”¨ createEntityAdapter éƒ¨åˆ† å‚è€ƒèµ„æ–™</a></p></blockquote><h3 id="_7-1-ç†è§£entity" tabindex="-1">7.1 ç†è§£Entity <a class="header-anchor" href="#_7-1-ç†è§£entity" aria-label="Permalink to &quot;7.1 ç†è§£Entity&quot;">â€‹</a></h3><p>createEntityAdapter æ˜¯ Redux Toolkit ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªç”¨äºç®¡ç†å®ä½“entity çš„é€‚é…å™¨ adapterã€‚è¿™ä¸ª adapter å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°åˆ›å»º reducer å’Œ selectorï¼Œä»è€Œç®€åŒ–äº† Redux çš„å¼€å‘æµç¨‹ã€‚</p><p>createEntityAdapter çš„åŸç†æ˜¯åŸºäºä¸€ä¸ªåä¸º createSlice çš„å‡½æ•°å®ç°çš„ã€‚å®ƒä¼šæ ¹æ®æˆ‘ä»¬æä¾›çš„å®ä½“ schemaï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€äº›å¸¸ç”¨çš„ reducer å’Œ selectorã€‚è¿™äº› reducer å’Œ selector å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°å¯¹å®ä½“è¿›è¡Œ CRUD æ“ä½œï¼Œä»è€Œç®€åŒ–äº†æˆ‘ä»¬çš„ä»£ç ã€‚</p><h3 id="_7-2-createentityadapter-ä½¿ç”¨" tabindex="-1">7.2 createEntityAdapter ä½¿ç”¨ <a class="header-anchor" href="#_7-2-createentityadapter-ä½¿ç”¨" aria-label="Permalink to &quot;7.2 createEntityAdapter ä½¿ç”¨&quot;">â€‹</a></h3><ol><li><p><strong>createEntityAdapter é¢„ç½®çš„å‡ ä¸ªreducerå‡½æ•°ã€‚</strong></p><ul><li>addOne / addManyï¼šå‘ state æ·»åŠ æ–° items</li><li>upsertOne / upsertManyï¼šæ·»åŠ æ–° items æˆ–æ›´æ–°ç°æœ‰ items</li><li>updateOne / updateManyï¼šé€šè¿‡æä¾›éƒ¨åˆ†å€¼æ›´æ–°ç°æœ‰ items</li><li>removeOne / removeManyï¼šæ ¹æ® ID åˆ é™¤ items</li><li>setAllï¼šæ›¿æ¢æ‰€æœ‰ç°æœ‰ items</li></ul></li><li><p><strong>åˆ›å»ºcreateEntityAdapteræ—¶ä¼ å…¥å¯¹è±¡ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¯¥å¯¹è±¡åº”è¯¥å…·æœ‰ä»¥ä¸‹å±æ€§ï¼šselectIdã€sortComparerå’Œnameã€‚è¿™äº›å±æ€§ç”¨äºæŒ‡å®šå¦‚ä½•é€‰æ‹©å’Œæ’åºå®ä½“çš„å”¯ä¸€æ ‡è¯†ç¬¦ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•æ’åºçš„ï¼Œä»¥åŠç”¨äºæ ‡è¯†å°†ç”¨äºç®¡ç†å®ä½“çŠ¶æ€çš„éƒ¨åˆ†ã€‚</strong></p><ul><li>selectIdï¼šç”¨äºä»å®ä½“å¯¹è±¡ä¸­æå–å”¯ä¸€æ ‡è¯†ç¬¦çš„å‡½æ•°ã€‚</li><li>sortComparerï¼šç”¨äºåœ¨æ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤å®ä½“æ—¶æ’åºå®ä½“åˆ—è¡¨çš„å‡½æ•°ã€‚</li><li>nameï¼šç”¨äºæ ‡è¯†å°†ç”¨äºç®¡ç†å®ä½“çŠ¶æ€çš„éƒ¨åˆ†çš„åç§°ã€‚</li></ul></li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨å…·æœ‰ä»¥ä¸‹ç”¨æˆ·å®ä½“ï¼š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user-123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Alice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  age</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ id å±æ€§æ¥æ ‡è¯†ç”¨æˆ·å¯¹è±¡ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°†ä»¥ä¸‹å‡½æ•°ç”¨äº selectIdï¼š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> usersAdapter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createEntityAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  selectId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.id,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦æŒ‰å¹´é¾„å¯¹ç”¨æˆ·è¿›è¡Œæ’åºï¼š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> usersAdapter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createEntityAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  selectId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.id,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sortComparer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.age,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦ç®¡ç†ç”¨æˆ·å®ä½“çš„çŠ¶æ€ï¼š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> usersAdapter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createEntityAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  selectId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.id,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sortComparer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.age,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="3"><li><strong>getInitialState</strong> ï¼šè¿”å›ä¸€ä¸ªç±»ä¼¼äº { ids: [], entities: {} } çš„å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ item çš„æ ‡å‡†åŒ– state ä»¥åŠåŒ…å«æ‰€æœ‰ item ID çš„æ•°ç»„ ï¼Œ</li><li><strong>getSelectors</strong>ï¼šç”Ÿæˆä¸€ç»„æ ‡å‡†çš„ selector å‡½æ•°</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ createEntityAdapterï¼š</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createSlice, createEntityAdapter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> todosAdapter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createEntityAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  selectId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">todo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> todo.id,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sortComparer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.priority </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.priority,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> todosSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSlice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;todos&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialState: todosAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInitialState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducers: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    todoAdded: todosAdapter.addOne,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    todoRemoved: todosAdapter.removeOne,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    todoUpdated: todosAdapter.updateOne,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    todosReceived: todosAdapter.setAll,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  selectAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">selectAllTodos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  selectById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">selectTodoById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  selectIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">selectTodoIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> todosAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSelectors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.todos)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">todoAdded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">todoRemoved</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">todoUpdated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">todosReceived</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> todosSlice.actions</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> todosSlice.reducer</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ createEntityAdapter åˆ›å»ºäº†ä¸€ä¸ªåä¸º todosAdapter çš„ adapterã€‚è¿™ä¸ª adapter æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šselectId å’Œ sortComparerã€‚å®ƒä¼šæ ¹æ®è¿™ä¸¤ä¸ªå‚æ•°è‡ªåŠ¨ç”Ÿæˆä¸€äº›å¸¸ç”¨çš„ reducer å’Œ selectorï¼Œä»è€Œç®€åŒ–äº†æˆ‘ä»¬çš„ä»£ç ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ createSlice åˆ›å»ºäº†ä¸€ä¸ªåä¸º todosSlice çš„ sliceã€‚è¿™ä¸ª slice æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šnameã€initialState å’Œ reducersã€‚å®ƒä¼šæ ¹æ®è¿™ä¸‰ä¸ªå‚æ•°åˆ›å»ºä¸€ä¸ª reducerï¼Œè¿™ä¸ª reducer åŒ…å«äº† todoAddedã€todoRemovedã€todoUpdated å’Œ todosReceived å››ä¸ª actionã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ todosAdapter.getSelectors åˆ›å»ºäº†ä¸‰ä¸ª selectorï¼šselectAllTodosã€selectTodoById å’Œ selectTodoIdsã€‚å®ƒä»¬å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°æŸ¥è¯¢ todosã€‚</p><h2 id="_8-rtk-query-æœ€æ–°çš„è§£å†³æ–¹æ¡ˆ-æ›¿æ¢-createasyncthunk-å’Œ-createslice" tabindex="-1">8. RTK Query(æœ€æ–°çš„è§£å†³æ–¹æ¡ˆ,æ›¿æ¢ createAsyncThunk å’Œ createSlice) <a class="header-anchor" href="#_8-rtk-query-æœ€æ–°çš„è§£å†³æ–¹æ¡ˆ-æ›¿æ¢-createasyncthunk-å’Œ-createslice" aria-label="Permalink to &quot;8. RTK Query(æœ€æ–°çš„è§£å†³æ–¹æ¡ˆ,æ›¿æ¢ createAsyncThunk å’Œ createSlice)&quot;">â€‹</a></h2><blockquote><ul><li>RTK Query æ˜¯ Redux Toolkit ä¸­åŒ…å«çš„æ•°æ®è·å–å’Œç¼“å­˜è§£å†³æ–¹æ¡ˆ <ul><li>RTK Query ä¸ºä½ æŠ½è±¡äº†ç®¡ç†ç¼“å­˜æœåŠ¡å™¨æ•°æ®çš„è¿‡ç¨‹ï¼Œæ— éœ€ç¼–å†™åŠ è½½çŠ¶æ€ã€å­˜å‚¨ç»“æœå’Œå‘å‡ºè¯·æ±‚çš„é€»è¾‘</li><li>RTK Query å»ºç«‹åœ¨ Redux ä¸­ä½¿ç”¨çš„ç›¸åŒæ¨¡å¼ä¹‹ä¸Šï¼Œä¾‹å¦‚å¼‚æ­¥ thunk</li></ul></li></ul></blockquote><p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨RTK Query?</strong></p><ol><li>æ ¹æ®ä¸åŒçš„åŠ è½½çŠ¶æ€æ˜¾ç¤ºä¸åŒUIç»„ä»¶</li><li>å‡å°‘å¯¹ç›¸åŒæ•°æ®é‡å¤å‘é€è¯·æ±‚</li><li>ä½¿ç”¨ä¹è§‚æ›´æ–°ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li><li>åœ¨ç”¨æˆ·ä¸UIäº¤äº’æ—¶ï¼Œç®¡ç†ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸ</li><li>è¿›ä¸€æ­¥ä¼˜åŒ–createAsyncThunk ä¸ createSliceç¹ççš„æ‰‹åŠ¨æ“ä½œ</li><li>æä¾›äº†è‡ªåŠ¨ç¼“å­˜ã€é‡è¯•ã€è½®è¯¢ç­‰åŠŸèƒ½ï¼Œå¤§å¤§ç®€åŒ–äº†åº”ç”¨ç¨‹åºä¸­å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ–¹å¼ã€‚</li></ol><p><a href="https://github.com/gdagundaridze/rtk-query-toptal-example" target="_blank" rel="noreferrer">RTKä¼˜ç§€å­¦ä¹ é¡¹ç›®</a><a href="https://github.com/reduxjs/redux-templates" target="_blank" rel="noreferrer">Redux å­¦ä¹ é¡¹ç›®</a><a href="https://juejin.cn/post/7132406643144261646" target="_blank" rel="noreferrer">redux å­¦ä¹ ç¬”è®°1</a><a href="https://juejin.cn/post/7144994578163040287" target="_blank" rel="noreferrer">redux å­¦ä¹ ç¬”è®°2</a><a href="https://www.xjx100.cn/news/26103.html" target="_blank" rel="noreferrer">RTK Query</a><a href="https://juejin.cn/post/7237856777588490297#heading-21" target="_blank" rel="noreferrer">ã€–Reduxã€—ã€ã€–ReduxToolkitã€—</a></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä»ç‰¹å®šäº React çš„å…¥å£ç‚¹å¯¼å…¥ RTK Query æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createApi, fetchBaseQuery } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit/query/react&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®šä¹‰æˆ‘ä»¬çš„å•ä¸ª API Slice å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç¼“å­˜å‡é€Ÿå™¨é¢„è®¡å°†æ·»åŠ åˆ° \`state.api\` ï¼ˆå·²ç»é»˜è®¤ - è¿™æ˜¯å¯é€‰çš„ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducerPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // baseUrl æ˜¯ API çš„èµ·å§‹ URLï¼Œè€Œ prepareHeaders å‡½æ•°åˆ™å¯ä»¥ç”¨æ¥è®¾ç½®ä»»æ„çš„ HTTP è¯·æ±‚å¤´éƒ¨ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseQuery: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchBaseQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prepareHeaders: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().auth.token;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> headers;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // â€œendpointsâ€ ä»£è¡¨å¯¹è¯¥æœåŠ¡å™¨çš„æ“ä½œå’Œè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // \`getPosts\` endpoint æ˜¯ä¸€ä¸ªè¿”å›æ•°æ®çš„ â€œQueryâ€ æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPosts: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // é€šè¿‡å®šä¹‰ä¸€ä¸ª query é€‰é¡¹æ¥æä¾› URL è·¯å¾„çš„å‰©ä½™éƒ¨åˆ†ã€‚è¯·æ±‚çš„ URL æ˜¯â€œ/fakeApi/postsâ€</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/posts&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	  getPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    addNewPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialPost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è¯·æ±‚ä½“å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: initialPost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿™é‡Œæˆ‘ä»¬çš„ query é€‰é¡¹è¿”å›ä¸€ä¸ªåŒ…å« {url, method, body} çš„å¯¹è±¡ã€‚ ç”±äºæˆ‘ä»¬ä½¿ç”¨ fetchBaseQuery æ¥å‘å‡ºè¯·æ±‚ï¼Œbody å­—æ®µå°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬è¿›è¡Œ JSON åºåˆ—åŒ–ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸º \`getPosts\` Query endpoint å¯¼å‡ºè‡ªåŠ¨ç”Ÿæˆçš„ hooks</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetPostsQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetPostQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useAddNewPostMutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="_8-1-createapi-ç®¡ç†ç½‘ç»œè¯·æ±‚" tabindex="-1">8.1 createApiï¼ˆç®¡ç†ç½‘ç»œè¯·æ±‚ï¼‰ <a class="header-anchor" href="#_8-1-createapi-ç®¡ç†ç½‘ç»œè¯·æ±‚" aria-label="Permalink to &quot;8.1 createApiï¼ˆç®¡ç†ç½‘ç»œè¯·æ±‚ï¼‰&quot;">â€‹</a></h3><blockquote><ul><li>RTK Query å¯¹æ¯ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨å•ä¸ª â€œAPI sliceâ€ï¼Œä½¿ç”¨ createApi å®šä¹‰ <ul><li>RTK Query æä¾›ä¸ UI æ— å…³å’Œç‰¹å®šäº React çš„ createApi ç‰ˆæœ¬</li><li>API slice ä¸ºä¸åŒçš„æœåŠ¡å™¨æ“ä½œå®šä¹‰äº†å¤šä¸ªâ€œè¯·æ±‚æ¥å£â€</li><li>å¦‚æœä½¿ç”¨ React é›†æˆï¼ŒAPI slice åŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆçš„ React hooks(è‡ªåŠ¨ç”Ÿæˆaction å’Œ reducer)</li></ul></li></ul></blockquote><ol><li><p><strong>createApiå‚æ•°</strong></p><ul><li>reducerPath: å¿…é€‰å‚æ•°ï¼Œå®ƒä¸ºç”Ÿæˆçš„ reducer å®šä¹‰äº†é¢„æœŸçš„é¡¶çº§çŠ¶æ€ slice å­—æ®µã€‚å¯ä»¥é€šè¿‡ reducerPath åœ¨ Redux store ä¸­æŸ¥æ‰¾å’Œè®¿é—®å¯¹åº”çš„ action å’Œ reducerã€‚ <ul><li>è¿™ä¸ªreducerPathç›¸å½“äºæˆ‘ä»¬ createSliceé…ç½®ä¸­çš„name</li><li>å¦‚æœä¸æä¾› reducerPath é€‰é¡¹ï¼Œåˆ™é»˜è®¤ä¸º &#39;api&#39;ï¼Œå› æ­¤ä½ çš„æ‰€æœ‰ RTKQ ç¼“å­˜æ•°æ®éƒ½å°†å­˜å‚¨åœ¨ state.api ä¸‹ã€‚</li></ul></li><li>baseQuery: å¿…é€‰å‚æ•°ï¼Œé€šè¿‡ä¼ å…¥fetchBaseQueryåŒ…è£…å‡½æ•°ï¼ŒæŒ‡å®šç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„å¤„ç†ã€‚ <ul><li>æˆ‘ä»¬å¯ä»¥åœ¨fetchBaseQueryå‡½æ•°ä¼ å…¥æ‰€æœ‰è¯·æ±‚çš„åŸºæœ¬ URLï¼Œä»¥åŠè¦†ç›–ä¿®æ”¹è¯·æ±‚æ ‡å¤´ç­‰è¡Œä¸ºï¼Œä¾‹å¦‚ baseUrl æˆ– headers ç­‰ã€‚</li></ul></li><li>endpoints: å¿…é€‰å‚æ•°ï¼Œå¯¹è¯¥æœåŠ¡å™¨çš„æ“ä½œå’Œè¯·æ±‚ã€‚ <ul><li>å›è°ƒå‡½æ•°æ¥å— builder å‚æ•°å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä½¿ç”¨ builder.query() å’Œ builder.mutation() åˆ›å»ºçš„è¯·æ±‚æ¥å£å®šä¹‰ã€‚</li><li>query: è¿”å›ç”¨äºç¼“å­˜çš„æ•°æ®ï¼›mutation: å‘æœåŠ¡å™¨å‘é€æ•°æ®æ›´æ–°ã€‚</li></ul></li><li>tagTypes: å¯é€‰å‚æ•°ï¼Œç”¨äºé…ç½® RTK å“åº”çŠ¶æ€å¤„ç†çš„ç±»å‹æ ‡ç­¾ã€‚</li></ul></li><li><p><strong>å¯¼å‡º API Slice å’Œ Hooks</strong></p></li></ol><p>RTK Query çš„ React é›†æˆä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬å®šä¹‰çš„ æ¯ä¸ª è¯·æ±‚æ¥å£ç”Ÿæˆ React hooksï¼ è¿™äº› hooks å°è£…äº†åœ¨ç»„ä»¶æŒ‚è½½æ—¶è§¦å‘è¯·æ±‚çš„è¿‡ç¨‹ï¼Œä»¥åŠåœ¨å¤„ç†è¯·æ±‚å’Œæ•°æ®å¯ç”¨æ—¶é‡æ–°æ¸²æŸ“ç»„ä»¶çš„è¿‡ç¨‹ã€‚ æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ª API slice æ–‡ä»¶ä¸­å¯¼å‡ºè¿™äº› hooksï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬çš„ React ç»„ä»¶ä¸­ä½¿ç”¨ã€‚</p><ul><li>useï¼Œä»»ä½• React hooks çš„æ­£å¸¸å‰ç¼€</li><li>è¯·æ±‚æ¥å£åç§°ï¼Œå¤§å†™</li><li>è¯·æ±‚æ¥å£çš„ç±»å‹ï¼ŒQuery æˆ– Mutation</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸º \`getUserInfo\` Query endpoint å’Œ &#39;postUserInfo&#39; Mutation endpoint å¯¼å‡ºè‡ªåŠ¨ç”Ÿæˆçš„ hooks</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‹¥è¯·æ±‚çš„æŸ¥è¯¢æ¥å£æ˜¯  getUserInfo,  åˆ™è‡ªåŠ¨ç”Ÿæˆçš„hookså‘½å \`useGetUserInfoQuery\`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‹¥è¯·æ±‚çš„æ˜¯æ›´æ–°æ¥å£æ˜¯ postUserInfoï¼Œåˆ™è‡ªåŠ¨ç”Ÿæˆhookså‘½å\`usePostUserInfoMutation\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetUserInfoQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">usePostUserInfoMutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li><strong>API Slice çš„ç¼“å­˜åŠŸèƒ½</strong></li></ol><p>ä¸ºäº†ä½¿ç”¨ API Slice çš„ç¼“å­˜åŠŸèƒ½ï¼Œéœ€è¦å°†å®ƒçš„ middleware æ·»åŠ åˆ° store çš„ middleware ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡ getDefaultMiddleware æ–¹æ³•æ¥è·å–é»˜è®¤çš„ middleware ç„¶åç”¨ concat è¿æ¥ API Slice çš„ middleware å®Œæˆï¼Œå³ getDefaultMiddleware().concat(apiSlice.middleware)ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> postsReducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../features/posts/postsSlice&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> usersReducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../features/users/usersSlice&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> notificationsReducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../features/notifications/notificationsSlice&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { apiSlice } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../features/api/apiSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> configureStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducer: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    posts: postsReducer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    users: usersReducer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    notifications: notificationsReducer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [apiSlice.reducerPath]: apiSlice.reducer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getDefaultMiddleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    getDefaultMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(apiSlice.middleware)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>RTK Query ä¸ºæ¯ä¸ªå”¯ä¸€çš„è¯·æ±‚æ¥å£ + å‚æ•°ç»„åˆåˆ›å»ºä¸€ä¸ª â€œcache keyâ€ï¼Œå¹¶åˆ†åˆ«å­˜å‚¨æ¯ä¸ª cache key çš„ç»“æœã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ª Query hooks ï¼Œä¼ é€’ä¸åŒçš„æŸ¥è¯¢å‚æ•°ï¼Œæ¯ä¸ªç»“æœå°†å•ç‹¬ç¼“å­˜åœ¨ Redux å­˜å‚¨ä¸­ã€‚</p><p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯æŸ¥è¯¢å‚æ•°å¿…é¡»æ˜¯ å•ä¸€ å€¼ï¼å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œåˆ™å¿…é¡»ä¼ é€’ä¸€ä¸ªåŒ…å«å¤šä¸ªå­—æ®µçš„å¯¹è±¡ï¼ˆä¸createAsyncThunkå®Œå…¨ç›¸åŒï¼‰ã€‚ RTK Query å°†å¯¹å­—æ®µè¿›è¡Œæµ…ç¨³å®šæ¯”è¾ƒï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªå‘ç”Ÿæ›´æ”¹ï¼Œåˆ™é‡æ–°è·å–æ•°æ®ã€‚</p><h3 id="_8-2-query-hooks" tabindex="-1">8.2 Query hooks <a class="header-anchor" href="#_8-2-query-hooks" aria-label="Permalink to &quot;8.2 Query hooks&quot;">â€‹</a></h3><blockquote><ul><li>æŸ¥è¯¢è¯·æ±‚æ¥å£å…è®¸ä»æœåŠ¡å™¨<strong>è·å–</strong>å’Œ<strong>ç¼“å­˜</strong>æ•°æ® <ul><li>Query Hooks è¿”å›ä¸€ä¸ª â€œdataâ€ å€¼ï¼Œä»¥åŠåŠ è½½çŠ¶æ€æ ‡å¿—</li><li>æŸ¥è¯¢å¯ä»¥æ‰‹åŠ¨é‡æ–°è·å–ï¼Œæˆ–è€…ä½¿ç”¨æ ‡ç­¾è‡ªåŠ¨é‡æ–°è·å–ç¼“å­˜å¤±æ•ˆ</li></ul></li></ul></blockquote><p><strong>QueryæŸ¥è¯¢æ¥å£ç±»å‹Hook ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ <code>{ data: posts, isLoading, isSuccess, isError, error }</code></strong> ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ TypeScriptï¼Œä½ å¯èƒ½éœ€è¦ä¿æŒåŸå§‹å¯¹è±¡ä¸å˜ï¼Œå¹¶åœ¨æ¡ä»¶æ£€æŸ¥ä¸­å°†æ ‡å¿—å¼•ç”¨ä¸º result.isSuccessï¼Œä»¥ä¾¿ TS å¯ä»¥æ­£ç¡®æ¨æ–­ data æ˜¯æœ‰æ•ˆçš„ã€‚</p><ul><li>data:æ¥è‡ªæœåŠ¡å™¨çš„å®é™…å“åº”å†…å®¹ã€‚ åœ¨æ”¶åˆ°å“åº”ä¹‹å‰ï¼Œè¯¥å­—æ®µå°†æ˜¯ â€œundefinedâ€ã€‚</li><li>isLoading: ä¸€ä¸ª booleanï¼ŒæŒ‡ç¤ºæ­¤ hooks å½“å‰æ˜¯å¦æ­£åœ¨å‘æœåŠ¡å™¨å‘å‡º ç¬¬ä¸€æ¬¡ è¯·æ±‚ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œå¦‚æœå‚æ•°æ›´æ”¹ä»¥è¯·æ±‚ä¸åŒçš„æ•°æ®ï¼Œ- isLoading å°†ä¿æŒä¸º falseã€‚ï¼‰</li><li>isFetching: ä¸€ä¸ª booleanï¼ŒæŒ‡ç¤º hooks å½“å‰æ˜¯å¦æ­£åœ¨å‘æœåŠ¡å™¨å‘å‡º any è¯·æ±‚</li><li>isSuccess: ä¸€ä¸ª booleanï¼ŒæŒ‡ç¤º hooks æ˜¯å¦å·²æˆåŠŸè¯·æ±‚å¹¶æœ‰å¯ç”¨çš„ç¼“å­˜æ•°æ®ï¼ˆå³ï¼Œç°åœ¨åº”è¯¥å®šä¹‰ dataï¼‰</li><li>isError: ä¸€ä¸ª booleanï¼ŒæŒ‡ç¤ºæœ€åä¸€ä¸ªè¯·æ±‚æ˜¯å¦æœ‰é”™è¯¯</li><li>error: ä¸€ä¸ª serialized é”™è¯¯å¯¹è±¡</li></ul><p><strong>å®šä¹‰Query hooks</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducerPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseQuery: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchBaseQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPosts: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/posts&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetPostsQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetPostQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>æŸ¥è¯¢æ‰€æœ‰å¹¶æ’åº</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// omit setup</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PostsList</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">posts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useGetPostsQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sortedPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMemo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sortedPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Sort posts in descending chronological order</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sortedPosts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localeCompare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.date))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sortedPosts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [posts])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoading) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Spinner</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Loading...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isSuccess) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sortedPosts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PostExcerpt</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post.id} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post} /&gt;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isError) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{error.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;posts-list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Posts&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {content}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>æŸ¥è¯¢å•ä¸ª</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// omit setup</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  RTK Query ä¸ºæ¯ä¸ªå”¯ä¸€çš„è¯·æ±‚æ¥å£ + å‚æ•°ç»„åˆåˆ›å»ºä¸€ä¸ª â€œcache keyâ€ï¼Œå¹¶åˆ†åˆ«å­˜å‚¨æ¯ä¸ª cache key çš„ç»“æœã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ª Query hooks ï¼Œä¼ é€’ä¸åŒçš„æŸ¥è¯¢å‚æ•°ï¼Œæ¯ä¸ªç»“æœå°†å•ç‹¬ç¼“å­˜åœ¨ Redux å­˜å‚¨ä¸­ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  è¿˜éœ€è¦æ³¨æ„çš„æ˜¯æŸ¥è¯¢å‚æ•°å¿…é¡»æ˜¯ å•ä¸€ å€¼ï¼å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œåˆ™å¿…é¡»ä¼ é€’ä¸€ä¸ªåŒ…å«å¤šä¸ªå­—æ®µçš„å¯¹è±¡ï¼ˆä¸createAsyncThunkå®Œå…¨ç›¸åŒï¼‰ã€‚ RTK Query å°†å¯¹å­—æ®µè¿›è¡Œæµ…ç¨³å®šæ¯”è¾ƒï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªå‘ç”Ÿæ›´æ”¹ï¼Œåˆ™é‡æ–°è·å–æ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SinglePostPage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">postId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> match.params</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isFetching</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useGetPostQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(postId)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isFetching) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Spinner</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Loading...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isSuccess) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">article</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;post&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{post.title}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PostAuthor</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post.user} /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TimeAgo</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> timestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post.date} /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;post-content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{post.content}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ReactionButtons</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post} /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Link</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`/editPost/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">post</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;button&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          Edit Post</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">article</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{content}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_8-3-mutation-hooks" tabindex="-1">8.3 Mutation hooks <a class="header-anchor" href="#_8-3-mutation-hooks" aria-label="Permalink to &quot;8.3 Mutation hooks&quot;">â€‹</a></h3><blockquote><ul><li>Mutation è¯·æ±‚æ¥å£å…è®¸<strong>æ›´æ–°</strong>æœåŠ¡å™¨ä¸Šçš„æ•°æ® <ul><li>Mutation hooks è¿”å›ä¸€ä¸ªå‘é€æ›´æ–°è¯·æ±‚çš„â€œè§¦å‘â€å‡½æ•°ï¼Œä»¥åŠåŠ è½½çŠ¶æ€</li><li>è§¦å‘å‡½æ•°è¿”å›ä¸€ä¸ªå¯ä»¥è§£åŒ…å¹¶ç­‰å¾…çš„ Promise</li></ul></li></ul></blockquote><p><strong>Mutation hooks è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼š</strong></p><ul><li>ç¬¬ä¸€ä¸ªå€¼æ˜¯thunkå‡½æ•°ã€‚</li><li>ç¬¬äºŒä¸ªå€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ <code>{ data: posts, isLoading, isSuccess, isError, error, fulfilled }</code>,å…¶ä¸­fulfilledè¡¨ç¤ºå¼‚æ­¥æ“ä½œæˆåŠŸåè¦æ‰§è¡Œçš„å›è°ƒã€‚ã€‚</li></ul><p>mutation å‹çš„ Hook ç›¸è¾ƒäº query å‹çš„ Hookï¼Œå¤šäº†ä¸€ä¸ª fulfilled å±æ€§ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œæˆåŠŸåå°†è¦è¢«æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼ˆfulfilled å›è°ƒï¼‰ã€‚æ¯ä¸ªæˆåŠŸå®Œæˆçš„ mutation éƒ½ä¼šè°ƒç”¨è¯¥å›è°ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨ extraReducers é€‰é¡¹ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ª reducer å‡½æ•°é“¾æ¥åˆ° mutation revertï¼ˆæ’¤æ¶ˆï¼‰å®Œæˆåå°†è¦è¢«æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼ˆrevert å›è°ƒï¼‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œfulfilled å›è°ƒå¯ä»¥é€šè¿‡ payload å‚æ•°è®¿é—®å¼‚æ­¥æ“ä½œå®Œæˆåçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è°ƒç”¨ createUserMutation.mutate({ username: &quot;user1&quot;, password: &quot;passwd&quot; }) å¹¶ä¸”æ“ä½œæˆåŠŸï¼Œæ­¤æ—¶ createUserMutation.fulfilled å›è°ƒçš„å‚æ•° payload å°±æ˜¯ createUserMutation.dataï¼Œè¡¨ç¤º mutation å®Œæˆåçš„æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ fulfilled å›è°ƒæ‰§è¡Œä»»ä½•åç»­æ“ä½œï¼Œä¾‹å¦‚ dispatch ä¸€ä¸ª actionã€æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ç­‰ã€‚</p><p><strong>æäº¤æ•°æ®</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  è¿™é‡Œæˆ‘ä»¬çš„ query é€‰é¡¹è¿”å›ä¸€ä¸ªåŒ…å« {url, method, body} çš„å¯¹è±¡ã€‚ </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ç”±äºæˆ‘ä»¬ä½¿ç”¨ fetchBaseQuery æ¥å‘å‡ºè¯·æ±‚ï¼Œbody å­—æ®µå°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬è¿›è¡Œ JSON åºåˆ—åŒ–ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducerPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseQuery: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchBaseQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPosts: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/posts&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    addNewPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialPost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Include the entire post object as the body of the request</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: initialPost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  useGetPostsQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  useGetPostQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  useAddNewPostMutation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>æäº¤æ•°æ®</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// omit setup</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AddPostForm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setTitle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">addNewPost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useAddNewPostMutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selectAllUsers)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onTitleChanged</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setTitle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.target.value)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onContentChanged</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.target.value)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onAuthorChanged</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.target.value)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canSave</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [title, content, userId].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">every</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Boolean) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isLoading</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onSavePostClicked</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (canSave) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addNewPost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ title, content, user: userId }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setTitle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Failed to save the post: &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // omit rendering logic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>æäº¤åæ‰‹åŠ¨åˆ·æ–°æ•°æ®ï¼ˆé€šå¸¸ä¸ä¼šè¿™ä¹ˆåšï¼‰</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React, { useMemo } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Link } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react-router-dom&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> classnames </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;classnames&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// omit other imports and PostExcerpt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PostsList</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Query hooks ç»“æœå¯¹è±¡åŒ…å«ä¸€ä¸ª â€œrefetchâ€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®ƒæ¥å¼ºåˆ¶é‡æ–°è·å–ã€‚ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">posts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isFetching</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    isError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    refetch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useGetPostsQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sortedPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMemo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sortedPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sortedPosts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localeCompare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.date))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sortedPosts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [posts])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Query hooks æœ‰ä¸€ä¸ª isLoading æ ‡å¿—ï¼Œå¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®è¯·æ±‚ï¼Œåˆ™ä¸º true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoading) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Spinner</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Loading...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isSuccess) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> renderedPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sortedPosts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PostExcerpt</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post.id} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{post} /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä»¥åŠä¸€ä¸ª isFetching æ ‡å¿—ï¼Œå½“ä»»æ„æ•°æ®è¯·æ±‚æ­£åœ¨è¿›è¡Œæ—¶ä¸ºtrue</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ isFetching æ ‡å¿—ï¼Œå¹¶åœ¨é‡æ–°è·å–è¿‡ç¨‹ä¸­å†æ¬¡ç”¨åŠ è½½å¾®è°ƒå™¨æ›¿æ¢æ•´ä¸ªå¸–å­åˆ—è¡¨ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> containerClassname</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> classnames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;posts-container&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      disabled: isFetching</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{containerClassname}&gt;{renderedPosts}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isError) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{error.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;posts-list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Posts&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      // æ‰‹åŠ¨åˆ·æ–°æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{refetch}&gt;Refetch Posts&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {content}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p><strong>é€šè¿‡æ ‡ç­¾ï¼Œå®ç°ç¼“å­˜å¤±æ•ˆè‡ªåŠ¨åˆ·æ–°</strong> RTK Query è®©æˆ‘ä»¬å®šä¹‰æŸ¥è¯¢å’Œ mutations ä¹‹é—´çš„å…³ç³»ï¼Œä»¥å¯ç”¨è‡ªåŠ¨æ•°æ®é‡æ–°è·å–ï¼Œä½¿ç”¨æ ‡ç­¾ã€‚ æ ‡ç­¾æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å°å¯¹è±¡ï¼Œå¯è®©ä½ å‘½åæŸäº›ç±»å‹çš„æ•°æ®å’Œç¼“å­˜çš„ æ— æ•ˆ éƒ¨åˆ†ã€‚ å½“ç¼“å­˜æ ‡ç­¾å¤±æ•ˆæ—¶ï¼ŒRTK Query å°†è‡ªåŠ¨é‡æ–°è·å–æ ‡è®°æœ‰è¯¥æ ‡ç­¾çš„è¯·æ±‚æ¥å£ã€‚</p><ul><li>API slice å¯¹è±¡ä¸­çš„æ ¹å­—æ®µ <code>tagTypes</code> ï¼Œå£°æ˜ä¸€ç»„å­—ç¬¦ä¸²æ ‡ç­¾æ•°ç»„ï¼Œä¾‹å¦‚ &#39;Post&#39;</li><li>Query æŸ¥è¯¢è¯·æ±‚æ¥å£ä¸­çš„ <code>providesTags</code> æ•°ç»„ï¼Œåˆ—å‡ºäº†ä¸€ç»„æè¿°è¯¥æŸ¥è¯¢ä¸­æ•°æ®çš„æ ‡ç­¾</li><li>Mutation è¯·æ±‚æ¥å£ä¸­çš„ <code>invalidatesTags</code> æ•°ç»„ï¼Œåˆ—å‡ºäº†æ¯æ¬¡ Mutation å°†ä¸€ç»„æ ‡ç­¾queryæŸ¥è¯¢è¯·æ±‚è¿‡æœŸï¼Œè§¦å‘é‡æ–°è·å–æ•°æ®(åˆ·æ–°ç¼“å­˜)</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducerPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseQuery: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchBaseQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å®šä¹‰æ ‡ç­¾ï¼Œè¿™å°†å¸®åŠ©è¯†åˆ«å’Œå¤„ç†ä¸æ•°æ®ç›¸å…³è”çš„æ‰€æœ‰æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tagTypes: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPosts: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä½¿ç”¨ providesTagsï¼ŒAPI slice å°†èƒ½å¤Ÿè·Ÿè¸ªä¸æŸ¥è¯¢å…³è”çš„æ ‡ç­¾ï¼ˆç¼“å­˜èµ·æ¥ï¼‰ï¼Œå¹¶å¯ä»¥åœ¨éœ€è¦æ—¶å¯¹å…¶è¿›è¡Œå¿«é€Ÿè®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // èƒ½å¤Ÿå°†æŸ¥è¯¢ç»“æœç¼“å­˜ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„æ ‡ç­¾è¿›è¡Œæ ‡è®°ï¼Œä½¿è¯¥æŸ¥è¯¢ç»“æœèƒ½å¤Ÿä¸å…¶ä»–ä½¿ç”¨ç›¸åŒæ ‡ç­¾çš„æŸ¥è¯¢ç»“æœè¿›è¡Œå…³è”ï¼Œä»¥å®ç°æ›´å¿«é€Ÿçš„é‡ç”¨å’Œæ›´å¿«é€Ÿçš„æŸ¥è¯¢ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      providesTags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    addNewPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialPost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: initialPost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å½“ mutation è§¦å‘æ—¶ï¼ŒAPI slice ä¼šæ ¹æ® invalidatesTags ä¸­åˆ—å‡ºçš„æ ‡ç­¾å¼ºåˆ¶åˆ·æ–°ç¼“å­˜ä¸­ç›¸å…³æ ‡ç­¾çš„æŸ¥è¯¢æ¥å£ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å®ƒä¼šè°ƒç”¨ä¸è¯¥æ ‡ç­¾ç›¸å…³è”çš„æ‰€æœ‰queryæŸ¥è¯¢ï¼Œå¹¶å¼ºåˆ¶å®ƒä»¬é‡æ–°è·å–æœ€æ–°æ•°æ®ï¼Œä»¥ä¾¿æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æœ€æ–°çš„æ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      invalidatesTags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_8-4-rtk-query-é«˜çº§æŸ¥è¯¢æ¨¡å¼" tabindex="-1">8.4 RTK Query é«˜çº§æŸ¥è¯¢æ¨¡å¼ <a class="header-anchor" href="#_8-4-rtk-query-é«˜çº§æŸ¥è¯¢æ¨¡å¼" aria-label="Permalink to &quot;8.4 RTK Query é«˜çº§æŸ¥è¯¢æ¨¡å¼&quot;">â€‹</a></h3><ul><li>å¦‚ä½•ä½¿ç”¨å¸¦æœ‰ ID çš„æ ‡ç­¾æ¥ç®¡ç†ç¼“å­˜å¤±æ•ˆå’Œé‡æ–°è·å–</li><li>å¦‚ä½•åœ¨ React ä¹‹å¤–ä½¿ç”¨ RTK æŸ¥è¯¢ç¼“å­˜</li><li>å¤„ç†å“åº”æ•°æ®çš„æŠ€æœ¯</li><li>Implementing optimistic updates and streaming updates</li></ul><h4 id="_8-4-1-ç¼“å­˜æ•°æ®è®¢é˜…ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">8.4.1 ç¼“å­˜æ•°æ®è®¢é˜…ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#_8-4-1-ç¼“å­˜æ•°æ®è®¢é˜…ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;8.4.1 ç¼“å­˜æ•°æ®è®¢é˜…ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h4><p><strong>RTK Query å…è®¸å¤šä¸ªç»„ä»¶è®¢é˜…ç›¸åŒçš„æ•°æ®ï¼Œå¹¶ä¸”å°†ç¡®ä¿æ¯ä¸ªå”¯ä¸€çš„æ•°æ®é›†åªè·å–ä¸€æ¬¡ã€‚</strong> åœ¨å†…éƒ¨ï¼ŒRTK Query ä¸ºæ¯ä¸ªè¯·æ±‚æ¥å£ + ç¼“å­˜é”®ç»„åˆä¿ç•™ä¸€ä¸ª action è®¢é˜…çš„å¼•ç”¨è®¡æ•°å™¨ã€‚ä¸åŒç»„ä»¶é‡Œä½¿ç”¨ç›¸åŒå‚æ•°è°ƒç”¨å°†è¿”å›å®Œå…¨ç›¸åŒçš„ç»“æœï¼ŒåŒ…æ‹¬è·å–çš„ â€œdataâ€ å’ŒåŠ è½½çŠ¶æ€æ ‡å¿—ã€‚</p><p>RTK Query ä¼šå¯åŠ¨ä¸€ä¸ªå†…éƒ¨è®¡æ—¶å™¨ã€‚ <strong>å¦‚æœåœ¨æ·»åŠ ä»»ä½•æ–°çš„æ•°æ®è®¢é˜…ä¹‹å‰è®¡æ—¶å™¨åˆ°æœŸï¼ŒRTK Query å°†è‡ªåŠ¨ä»ç¼“å­˜ä¸­åˆ é™¤è¯¥æ•°æ®</strong>ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä¸å†éœ€è¦è¯¥æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨è®¡æ—¶å™¨åˆ°æœŸä¹‹å‰æ·»åŠ äº†æ–°è®¢é˜…ï¼Œåˆ™å–æ¶ˆè®¡æ—¶å™¨ï¼Œå¹¶ä½¿ç”¨å·²ç¼“å­˜çš„æ•°æ®è€Œæ— éœ€é‡æ–°è·å–å®ƒã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>æœªä½¿ç”¨çš„æ•°æ®ä¼šåœ¨ 60 ç§’åä»ç¼“å­˜ä¸­åˆ é™¤</strong>ï¼Œæ ¹ API Slice å®šä¹‰ä¸­è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>keepUnusedDataFor</code> æ ‡å¿—åœ¨å„ä¸ªè¯·æ±‚æ¥å£å®šä¹‰ä¸­è¦†ç›–ï¼Œè¯¥æ ‡å¿—æŒ‡å®šç¼“å­˜ç”Ÿå­˜æœŸ ç§’ã€‚</p><p>ä¸¾ä¾‹ï¼Œå½“æˆ‘ä»¬åœ¨Aé¡µé¢è¯·æ±‚æ•°æ®ï¼Œå½“æˆ‘ä»¬åˆ‡æ¢åˆ°Bé¡µé¢ï¼Œæ­¤æ—¶Aé¡µé¢å¸è½½äº†ï¼Œæ´»åŠ¨è®¢é˜…åˆ é™¤ï¼ŒRTK Query ç«‹å³å¯åŠ¨ â€œremove this post dataâ€ è®¡æ—¶å™¨ã€‚ä½†æ˜¯Bé¡µé¢ç«‹å³æŒ‚è½½å¹¶å¹¶ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é”®è®¢é˜…ç›¸åŒçš„ Post æ•°æ®ï¼ˆé»˜è®¤60ç§’å†…ï¼‰ã€‚å› æ­¤ï¼ŒRTK Query å–æ¶ˆäº†è®¡æ—¶å™¨å¹¶ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜æ•°æ®ï¼Œè€Œä¸æ˜¯ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚</p><h4 id="_8-4-2-ç‰¹å®šçš„ç¼“å­˜æ ‡ç­¾å¯ç”¨äºæ›´ç»†ç²’åº¦çš„ç¼“å­˜å¤±æ•ˆ-é€‰æ‹©æ€§æ›´æ–°" tabindex="-1">8.4.2 ç‰¹å®šçš„ç¼“å­˜æ ‡ç­¾å¯ç”¨äºæ›´ç»†ç²’åº¦çš„ç¼“å­˜å¤±æ•ˆï¼ˆé€‰æ‹©æ€§æ›´æ–°ï¼‰ <a class="header-anchor" href="#_8-4-2-ç‰¹å®šçš„ç¼“å­˜æ ‡ç­¾å¯ç”¨äºæ›´ç»†ç²’åº¦çš„ç¼“å­˜å¤±æ•ˆ-é€‰æ‹©æ€§æ›´æ–°" aria-label="Permalink to &quot;8.4.2 ç‰¹å®šçš„ç¼“å­˜æ ‡ç­¾å¯ç”¨äºæ›´ç»†ç²’åº¦çš„ç¼“å­˜å¤±æ•ˆï¼ˆé€‰æ‹©æ€§æ›´æ–°ï¼‰&quot;">â€‹</a></h4><ul><li>ç¼“å­˜æ ‡ç­¾å¯ä»¥æ˜¯ <code>&#39;Post&#39;</code> æˆ– <code>{type: &#39;Post&#39;, id}</code></li><li>è¯·æ±‚æ¥å£å¯ä»¥æ ¹æ®ç»“æœå’Œ arg ç¼“å­˜é”®æä¾›æˆ–ä½¿ç¼“å­˜æ ‡è®°æ— æ•ˆ</li></ul><p>ä¹‹å‰åœ¨8.3 ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•è§£å†³,mutationå®Œè‡ªåŠ¨åˆ·æ–°queryè¿™ä¸ªé—®é¢˜çš„ã€‚æˆ‘ä»¬åœ¨queryä¸­ <code>providesTags</code> ä¸€ä¸ªæ ‡ç­¾ï¼Œåœ¨mutationä¸­ <code>invalidatesTags</code> ä¸€ä¸ªæ ‡ç­¾ã€‚è¿™å…¶ä¸­ä¼šä½¿ç”¨æ•´ä¸ªqueryç¼“å­˜å¤±æ•ˆå¼ºåˆ¶åˆ·æ–°æ•´ä¸ªåˆ—è¡¨ï¼Œä½†å…¶å®æˆ‘ä»¬ä¸€æ¬¡åªæ˜¯æ›´æ–°åˆ—è¡¨ä¸­çš„ä¸€é¡¹ã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œèƒ½é€‰æ‹©æ€§æ›´æ–°ï¼Œ<strong>RTK Query è®©æˆ‘ä»¬å¯ä»¥å®šä¹‰ç‰¹å®šçš„æ ‡ç­¾ï¼Œè¿™è®©æˆ‘ä»¬åœ¨æ— æ•ˆç¼“å­˜æ–¹é¢ï¼ˆå¼ºåˆ¶æ›´æ–°ï¼‰æ›´æœ‰é€‰æ‹©æ€§</strong>ã€‚</p><p>ä¹‹å‰åœ¨Query Hook ä¸­å®šä¹‰äº†ä¸€ä¸ª providesTags å­—æ®µï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚providesTagsä¹Ÿå¯ä»¥å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæœ‰3ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¿™å…è®¸æˆ‘ä»¬æ ¹æ®æ­£åœ¨è·å–çš„æ•°æ®çš„ ID åˆ›å»ºæ ‡ç­¾æ¡ç›®ã€‚åŒæ ·ï¼ŒinvalidatesTags ä¹Ÿå¯ä»¥æ˜¯å›è°ƒã€‚</p><ul><li>resultï¼šæ¥å£è¿”å›çš„ç»“æœ</li><li>errorï¼šé”™è¯¯</li><li>argï¼šæŸ¥è¯¢å‚æ•°</li></ul><p><strong>å…³äºé€‰æ‹©æ€§æ›´æ–°ï¼Œå¿…é¡»è¦çŸ¥é“çš„å‰ç½®çŸ¥è¯†æ˜¯å…³äºqueryå’Œmutationæ ‡ç­¾çš„åŒ¹é…è§„åˆ™ã€‚</strong> å¯¹äº createApi çš„ endpoints ä¸­çš„ builder.query å’Œ builder.mutation æ–¹æ³•ï¼Œä¸¤ä¸ªæ–¹æ³•ä¸­çš„æ ‡ç­¾æœºåˆ¶æ˜¯ä¸åŒçš„ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚å…·ä½“æ¥è¯´ï¼Œbuilder.query æ–¹æ³•ä¸­çš„æ ‡ç­¾ä¼šä¸ builder.mutation æ–¹æ³•ä¸­çš„æ ‡ç­¾åˆ†åˆ«ç¼“å­˜ï¼Œå¹¶ä¸”ä¸¤ç§æ–¹æ³•çš„æ ‡ç­¾æ˜¯ä¸ç›¸äº¤çš„ã€‚</p><ul><li>builder.queryï¼Œå¦‚æœæŒ‡å®šäº†å­—ç¬¦ä¸²æ ‡ç­¾ï¼Œåˆ™åªæœ‰å’Œæ­¤å­—ç¬¦ä¸²æ ‡ç­¾åç§°ç›¸åŒçš„ç¼“å­˜æ•°æ®ä¼šè¢«æ— æ•ˆï¼Œå’Œå¯¹è±¡å½¢å¼æ ‡ç­¾æ²¡æœ‰å…³ç³»ã€‚</li><li>builder.mutationï¼Œæ ‡ç­¾éœ€è¦ä½¿ç”¨åŒé‡åŒ¹é…æ–¹å¼ï¼Œä½¿ç”¨å¸¦æœ‰ç±»å‹å’Œ ID å±æ€§çš„å¯¹è±¡æ ‡ç­¾ã€‚å¯¹è±¡å½¢å¼æ ‡ç­¾çš„å€¼å¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œå®ƒä»¬åªéœ€è¦å…·æœ‰ç›¸åŒçš„ç±»å‹å’Œ ID å±æ€§æ‰å¯èƒ½åŒ¹é…ç¼“å­˜ä¸­çš„æ•°æ®ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨ builder.mutation æ–¹æ³•ä¸­ï¼Œä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²æ ‡ç­¾ï¼Œå› ä¸ºè¿™æ ·å°†ä¸ä¼šå’Œç¼“å­˜ä¸­çš„æ•°æ®ç²¾ç¡®åŒ¹é…ï¼Œä»è€Œæ— æ³•ä¿è¯ç¼“å­˜çš„æ­£ç¡®æ€§ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯·çœ‹ä¸‹é¢ç¤ºä¾‹å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨æ ‡ç­¾è¾¾åˆ°é€‰æ‹©æ€§æ›´æ–°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// RTK Query çŸ¥é“å½“æˆ‘ä»¬è¿›è¡Œç¼–è¾‘å¹¶ä¸”å…·æœ‰è¯¥ ID çš„ç‰¹å®šæ ‡ç­¾ç¼“å­˜æ— æ•ˆæ—¶ï¼Œå®ƒéœ€è¦é‡æ–°è·å–å•ä¸ªå¸–å­å’Œå¸–å­åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducerPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseQuery: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchBaseQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å®šä¹‰Postæ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tagTypes: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPosts: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      providesTags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨é»˜è®¤çš„å‚æ•°-ç©ºæ•°ç»„ï¼Œå®‰å…¨å¤„ç†è¿”å›å€¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // â‘ æˆ‘ä»¬é€šå¸¸ä¸è¿™ä¹ˆåšï¼Œä»…ä¸ºæ•´ä¸ªåˆ—è¡¨æä¾›ä¸€ä¸ªé€šç”¨çš„ &#39;Post&#39; æ ‡ç­¾ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // &#39;Post&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // â‘¡æ¨èè¿™ä¹ˆåšï¼Œä¸ºæ•´ä¸ªåˆ—è¡¨æä¾›é€šç”¨ &#39;Post&#39; æ ‡ç­¾å¹¶ä½¿å…¶å…·æœ‰ä»»æ„ ID çš„é™„åŠ æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LIST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä»¥åŠä¸ºæ¯ä¸ªæ¥æ”¶åˆ°çš„å¸–å­å¯¹è±¡æä¾›ä¸€ä¸ªç‰¹å®šçš„ {type: &#39;Post&#39;, id} æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id }))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä¸ºå•ä¸ª post å¯¹è±¡æä¾›ç‰¹å®šçš„ {type: &#39;Post&#39;, id} æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      providesTags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id: arg }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    addNewPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialPost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: initialPost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // â‘ æˆ‘ä»¬é€šå¸¸ä¸è¿™ä¹ˆåšï¼Œä½¿ä¸€èˆ¬çš„&#39;Post&#39;æ ‡ç­¾ç¼“å­˜æ— æ•ˆï¼Œé‡æ–°è·å–æ•´ä¸ªåˆ—è¡¨ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // invalidatesTags: [&#39;Post&#39;]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // â‘¡ä½¿å…·æœ‰ä»»æ„ ID çš„é™„åŠ æ ‡ç­¾æ— æ•ˆï¼Œå¼ºåˆ¶é‡æ–°è·å– getPosts è¯·æ±‚æ¥å£çš„å¸–å­åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      invalidatesTags: [{type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    editPost: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">post</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PATCH&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: post</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä½¿ç‰¹å®šçš„ {type: &#39;Post&#39;, id} æ ‡ç­¾ç¼“å­˜æ— æ•ˆï¼Œå¼ºåˆ¶æ›´æ–°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // è¿™å°†å¼ºåˆ¶é‡æ–°è·å– â€œgetPostâ€ queryæ¥å£ä¸­çš„å•ä¸ªå¸–å­</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä»¥åŠ â€œgetPostsâ€ queryæ¥å£ä¸­çš„æ•´ä¸ªå¸–å­åˆ—è¡¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½æä¾›äº†ä¸ â€œ{type, id}â€ å€¼åŒ¹é…çš„æ ‡ç­¾ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      invalidatesTags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id: arg.id }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h4 id="_8-4-3-rtk-query-çš„-api-ä¸-ui-æ— å…³-å¯ä»¥åœ¨-react-ä¹‹å¤–ä½¿ç”¨-endpoint-initiate" tabindex="-1">8.4.3 RTK Query çš„ API ä¸ UI æ— å…³ï¼Œå¯ä»¥åœ¨ React ä¹‹å¤–ä½¿ç”¨ï¼ˆ<code>endpoint.initiate()</code>ï¼‰ <a class="header-anchor" href="#_8-4-3-rtk-query-çš„-api-ä¸-ui-æ— å…³-å¯ä»¥åœ¨-react-ä¹‹å¤–ä½¿ç”¨-endpoint-initiate" aria-label="Permalink to &quot;8.4.3 RTK Query çš„ API ä¸ UI æ— å…³ï¼Œå¯ä»¥åœ¨ React ä¹‹å¤–ä½¿ç”¨ï¼ˆ\`endpoint.initiate()\`ï¼‰&quot;">â€‹</a></h4><ul><li>è¯·æ±‚æ¥å£å¯¹è±¡åŒ…æ‹¬ç”¨äºå‘èµ·è¯·æ±‚ã€ç”Ÿæˆç»“æœ selectors å’ŒåŒ¹é…è¯·æ±‚ action å¯¹è±¡çš„å‡½æ•°</li></ul><ol><li>API slice å¯¹è±¡çš„ç»“æ„</li></ol><ol><li>endpoints å­—æ®µé‡Œå®šä¹‰çš„æ¥å£éƒ½æœ‰ä¸€ä¸ªè¯·æ±‚æ¥å£å¯¹è±¡ï¼Œæ¯ä¸ªè¯·æ±‚æ¥å£å¯¹è±¡åŒ…å«</li></ol><ul><li>æˆ‘ä»¬ä»æ ¹ API slice å¯¹è±¡å¯¼å‡ºçš„ç›¸åŒä¸» query/mutation hooksï¼Œä½†å‘½åä¸º useQuery æˆ– useMutation</li><li>å¯¹äºæŸ¥è¯¢è¯·æ±‚æ¥å£ï¼Œä¸€ç»„é¢å¤–çš„ query hook ç”¨äºæƒ°æ€§æŸ¥è¯¢æˆ–éƒ¨åˆ†è®¢é˜…ç­‰åœºæ™¯</li><li>ä¸€ç»„ &quot;matcher&quot; å®ç”¨ç¨‹åº ç”¨äºæ£€æŸ¥ç”±å¯¹è¯¥è¯·æ±‚æ¥å£çš„è¯·æ±‚ dispatch çš„ pending/fulfilled/rejected action</li><li>è§¦å‘å¯¹æ­¤è¯·æ±‚æ¥å£çš„è¯·æ±‚çš„ initiate thunk</li><li>ä¸€ä¸ª select å‡½æ•°ï¼Œåˆ›å»º memoized selectorsï¼Œå¯ä»¥æ£€ç´¢ç¼“å­˜çš„ç»“æœæ•°æ® + æ­¤è¯·æ±‚æ¥å£çš„çŠ¶æ€æ¡ç›®</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¿½ç•¥éƒ¨åˆ†ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { apiSlice } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./features/api/apiSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¯åŠ¨ mock API server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ onUnhandledRequest: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bypass&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(apiSlice.endpoints.getUsers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initiate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ReactDOM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">React.StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Provider</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{store}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">React.StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_8-4-4-rtk-query-ä½¿ç”¨è®°å¿†åŒ–ã€æŒä¹…åŒ–select-endpoint-select" tabindex="-1">8.4.4 RTK query ä½¿ç”¨è®°å¿†åŒ–ã€æŒä¹…åŒ–selectï¼ˆ<code>endpoint.select()</code>ï¼‰ ï¼Œ <a class="header-anchor" href="#_8-4-4-rtk-query-ä½¿ç”¨è®°å¿†åŒ–ã€æŒä¹…åŒ–select-endpoint-select" aria-label="Permalink to &quot;8.4.4 RTK query ä½¿ç”¨è®°å¿†åŒ–ã€æŒä¹…åŒ–selectï¼ˆ\`endpoint.select()\`ï¼‰ ï¼Œ&quot;">â€‹</a></h3><p>createEntityAdapter åˆ›å»ºçš„selectorï¼Œåˆ·æ–°åå°†ä¼šä¸¢å¤±å› ä¸ºå¯¹åº”state æ²¡æœ‰æ•°æ®äº†ã€‚ç°åœ¨æˆ‘ä»¬æ­£åœ¨ä¸º RTK Query çš„ç¼“å­˜è·å–æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥å°†è¿™äº› selector æ›¿æ¢ä¸ºä»ç¼“å­˜ä¸­è¯»å–çš„ç­‰ä»·ç‰©ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createSlice, createEntityAdapter,createSelector} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { apiSlice } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../api/apiSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* æš‚æ—¶å¿½ç•¥é€‚é…å™¨ - æˆ‘ä»¬å¾ˆå¿«ä¼šå†æ¬¡ä½¿ç”¨å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">const usersAdapter = createEntityAdapter()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">const initialState = usersAdapter.getInitialState()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// API slice è¯·æ±‚æ¥å£ä¸­çš„ endpoint.select() å‡½æ•°å°†åœ¨æˆ‘ä»¬æ¯æ¬¡è°ƒç”¨å®ƒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„ memoized selector å‡½æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// select() å°†å‚æ•°ä½œä¸ºç¼“å­˜é”®ï¼Œå¹¶ä¸”è¿™å¿…é¡»ä¸ä½ ä½œä¸ºå‚æ•°ä¼ é€’ç»™ query hook æˆ– initiate() thunk çš„ç¼“å­˜é”®ç›¸åŒã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç”Ÿæˆçš„ selector ä½¿ç”¨è¯¥ç¼“å­˜é”®æ¥å‡†ç¡®çŸ¥é“å®ƒåº”è¯¥ä»å­˜å‚¨ä¸­çš„ç¼“å­˜çŠ¶æ€è¿”å›å“ªä¸ªç¼“å­˜ç»“æœã€‚å¦‚æœä¸ä¼ å‚æ•°ï¼Œç¼“å­˜é”®å˜æˆundefiendã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectUsersResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice.endpoints.getUsers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> emptyUsers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectAllUsers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  selectUsersResult,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  usersResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> usersResult?.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> emptyUsers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectUserById</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  selectAllUsers,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// input selector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸ºäº†ç»™output selector ä¼ é€’userIdå‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// output selector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* æš‚æ—¶å¿½ç•¥ selectorâ€”â€”æˆ‘ä»¬ç¨åå†è®¨è®º</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">export const {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  selectAll: selectAllUsers,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  selectById: selectUserById,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">} = usersAdapter.getSelectors((state) =&gt; state.users)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_8-4-5-å®ç°è¯·æ±‚æ¥å£åˆ†åŒ…æŒ‰éœ€åŠ è½½-injectendpoints" tabindex="-1">8.4.5 å®ç°è¯·æ±‚æ¥å£åˆ†åŒ…æŒ‰éœ€åŠ è½½ï¼ˆ<code>injectEndpoints()</code>ï¼‰ <a class="header-anchor" href="#_8-4-5-å®ç°è¯·æ±‚æ¥å£åˆ†åŒ…æŒ‰éœ€åŠ è½½-injectendpoints" aria-label="Permalink to &quot;8.4.5 å®ç°è¯·æ±‚æ¥å£åˆ†åŒ…æŒ‰éœ€åŠ è½½ï¼ˆ\`injectEndpoints()\`ï¼‰&quot;">â€‹</a></h3><p><strong>RTK Query æ”¯æŒä½¿ç”¨ apiSlice.injectEndpoints() æ‹†åˆ†è¯·æ±‚æ¥å£å®šä¹‰ã€‚</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { apiSlice } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../api/apiSlice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// injectEndpoints() æ”¹å˜åŸå§‹ API slice å¯¹è±¡ä»¥æ·»åŠ é¢å¤–çš„è¯·æ±‚æ¥å£å®šä¹‰ï¼Œç„¶åè¿”å›å®ƒã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extendedApiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">injectEndpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getUsers: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/users&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetUsersQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> extendedApiSlice;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectUsersResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> extendedApiSlice.endpoints.getUsers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æ­¤æ—¶ï¼ŒapiSlice å’Œ extendedApiSlice æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä½†åœ¨è¿™é‡Œå‚è€ƒ extendedApiSlice å¯¹è±¡è€Œä¸æ˜¯ apiSlice ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œæé†’è‡ªå·±ã€‚ï¼ˆå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ TypeScriptï¼Œè¿™ä¸€ç‚¹æ›´ä¸ºé‡è¦ï¼Œå› ä¸ºåªæœ‰ extendedApiSlice å€¼å…·æœ‰ä¸ºæ–°è¯·æ±‚æ¥å£æ·»åŠ çš„ç±»å‹ã€‚ï¼‰</p><h3 id="_8-4-6-å“åº”å¯ä»¥æ ¹æ®éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œè½¬æ¢" tabindex="-1">8.4.6 å“åº”å¯ä»¥æ ¹æ®éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œè½¬æ¢ <a class="header-anchor" href="#_8-4-6-å“åº”å¯ä»¥æ ¹æ®éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œè½¬æ¢" aria-label="Permalink to &quot;8.4.6 å“åº”å¯ä»¥æ ¹æ®éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œè½¬æ¢&quot;">â€‹</a></h3><ul><li>è¯·æ±‚æ¥å£å¯ä»¥å®šä¹‰ä¸€ä¸ª transformResponse å›è°ƒæ¥åœ¨ç¼“å­˜ä¹‹å‰ä¿®æ”¹æ•°æ®</li><li>å¯ä»¥ç»™ Hooks ä¸€ä¸ª selectFromResult é€‰é¡¹æ¥æå–/è½¬æ¢æ•°æ®</li><li>ç»„ä»¶å¯ä»¥è¯»å–æ•´ä¸ªå€¼å¹¶ä½¿ç”¨ useMemo è¿›è¡Œè½¬æ¢</li></ul><ol><li>transformResponse</li></ol><p>è¯·æ±‚æ¥å£å¯ä»¥å®šä¹‰ä¸€ä¸ª transformResponse å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºå¯ä»¥åœ¨ç¼“å­˜ä¹‹å‰æå–æˆ–ä¿®æ”¹ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p><p>æ€§èƒ½å’Œè§„èŒƒåŒ– ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å°†æ•°æ®å­˜å‚¨åœ¨å½’ä¸€åŒ–ç»“æ„ä¸­æœ‰ç”¨çš„åŸå› ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥æ ¹æ® ID æŸ¥æ‰¾å’Œæ›´æ–°é¡¹ç›®ï¼Œè€Œä¸å¿…éå†æ•°ç»„æ¥æŸ¥æ‰¾æ­£ç¡®çš„é¡¹ç›®ã€‚</p><p>æˆ‘ä»¬çš„ selectUserById selector å½“å‰å¿…é¡»éå†ç¼“å­˜çš„ç”¨æˆ·æ•°ç»„æ‰èƒ½æ‰¾åˆ°æ­£ç¡®çš„ User å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨å½’ä¸€åŒ–æ–¹æ³•è½¬æ¢è¦å­˜å‚¨çš„å“åº”æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç®€åŒ–ä¸ºç›´æ¥é€šè¿‡ ID æŸ¥æ‰¾ç”¨æˆ·ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰åœ¨ usersSlice ä¸­ä½¿ç”¨ createEntityAdapter æ¥ç®¡ç†å½’ä¸€åŒ–ç”¨æˆ·æ•°æ®ã€‚ç°åœ¨å¯ä»¥å°† createEntityAdapter é›†æˆåˆ°æˆ‘ä»¬çš„ extendedApiSlice ä¸­ï¼Œå¹¶å®é™…ä½¿ç”¨ createEntityAdapter åœ¨æ•°æ®ç¼“å­˜ä¹‹å‰å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚å¹¶ä¸”å°†å–æ¶ˆæ³¨é‡Šæˆ‘ä»¬æœ€åˆæ‹¥æœ‰çš„ usersAdapter è¡Œï¼Œå¹¶å†æ¬¡ä½¿ç”¨å®ƒçš„æ›´æ–°å‡½æ•°å’Œ selectorã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { apiSlice } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../api/apiSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> usersAdapter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createEntityAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> initialState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> usersAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInitialState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extendedApiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiSlice.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">injectEndpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æˆ‘ä»¬åœ¨ getUsers è¯·æ±‚æ¥å£æ·»åŠ äº†ä¸€ä¸ª transformResponse é€‰é¡¹ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å®ƒæ¥æ”¶æ•´ä¸ªå“åº”æ•°æ®ä½“ä½œä¸ºå…¶å‚æ•°ï¼Œå¹¶åº”è¿”å›è¦ç¼“å­˜çš„å®é™…æ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getUsers: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      transformResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">responseData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // é€šè¿‡è°ƒç”¨usersAdapter.setAll(initialState, responseData)ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å®ƒå°†è¿”å›æ ‡å‡†çš„ {ids: [],entities: {}} å½’ä¸€åŒ–æ•°æ®ç»“æ„ï¼ŒåŒ…å«æ‰€æœ‰æ¥æ”¶åˆ°çš„é¡¹ç›®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> usersAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(initialState, responseData)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">useGetUsersQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> extendedApiSlice</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// API slice è¯·æ±‚æ¥å£ä¸­çš„ endpoint.select() å‡½æ•°å°†åœ¨æˆ‘ä»¬æ¯æ¬¡è°ƒç”¨å®ƒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„ memoized selector å‡½æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// select() å°†å‚æ•°ä½œä¸ºç¼“å­˜é”®ï¼Œå¹¶ä¸”è¿™å¿…é¡»ä¸ä½ ä½œä¸ºå‚æ•°ä¼ é€’ç»™ query hook æˆ– initiate() thunk çš„ç¼“å­˜é”®ç›¸åŒã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç”Ÿæˆçš„ selector ä½¿ç”¨è¯¥ç¼“å­˜é”®æ¥å‡†ç¡®çŸ¥é“å®ƒåº”è¯¥ä»å­˜å‚¨ä¸­çš„ç¼“å­˜çŠ¶æ€è¿”å›å“ªä¸ªç¼“å­˜ç»“æœã€‚å¦‚æœä¸ä¼ å‚æ•°ï¼Œç¼“å­˜é”®å˜æˆundefiendã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectUsersResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> extendedApiSlice.endpoints.getUsers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectUsersData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  selectUsersResult,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  usersResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> usersResult.data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// adapter.getSelectors() å‡½æ•°éœ€è¦ç»™å®šä¸€ä¸ªè¾“å…¥ selectorï¼Œä»¥ä¾¿å®ƒçŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°å½’ä¸€åŒ–æ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®åµŒå¥—åœ¨ RTK Query cache reducer ä¸­ï¼Œå› æ­¤æˆ‘ä»¬ä»ç¼“å­˜çŠ¶æ€ä¸­é€‰æ‹©æ­£ç¡®çš„å­—æ®µã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">selectAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">selectAllUsers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">selectById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">selectUserById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  usersAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSelectors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectUsersData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initialState)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><ol start="2"><li>selectFromResult</li></ol><p>ä»æ—§çš„ postsSlice è¯»å–çš„æœ€åä¸€ä¸ªç»„ä»¶æ˜¯ <code>&lt;UserPage&gt;</code>ï¼Œå®ƒæ ¹æ®å½“å‰ç”¨æˆ·è¿‡æ»¤å¸–å­åˆ—è¡¨ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨ useGetPostsQuery() è·å–æ•´ä¸ªå¸–å­åˆ—è¡¨ï¼Œç„¶ååœ¨ç»„ä»¶ä¸­å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œä¾‹å¦‚åœ¨ useMemo ä¸­è¿›è¡Œæ’åºã€‚query hooks è¿˜ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æä¾› selectFromResult é€‰é¡¹æ¥é€‰æ‹©ç¼“å­˜çŠ¶æ€çš„ç‰‡æ®µï¼Œå¹¶ä¸”ä»…åœ¨æ‰€é€‰ç‰‡æ®µæ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ selectFromResult è®© <code>&lt;UserPage&gt;</code> ä»ç¼“å­˜ä¸­è¯»å–è¿‡æ»¤åçš„å¸–å­åˆ—è¡¨ã€‚ç„¶è€Œï¼Œä¸ºäº†è®© selectFromResult é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬æå–çš„ä»»ä½•æ•°æ®éƒ½è¢«æ­£ç¡®è®°å¿†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„ selector å®ä¾‹ï¼Œ<code>&lt;UsersPage&gt;</code> ç»„ä»¶å¯ä»¥åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶é‡ç”¨å®ƒï¼Œä»¥ä¾¿ selector æ ¹æ®å…¶è¾“å…¥æ¥è®°å¿†ç»“æœã€‚</p><p>æˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºçš„ memoized selector å‡½æ•°æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«ã€‚é€šå¸¸ï¼Œselector æœŸæœ›æ•´ä¸ª Redux state ä½œä¸ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä» state ä¸­æå–æˆ–æ´¾ç”Ÿä¸€ä¸ªå€¼ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¤„ç†ä¿å­˜åœ¨ç¼“å­˜ä¸­çš„ â€œresultâ€ å€¼ã€‚result å¯¹è±¡å†…éƒ¨æœ‰ä¸€ä¸ª â€œdataâ€ å­—æ®µï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬éœ€è¦çš„å®é™…å€¼ï¼Œä»¥åŠä¸€äº›è¯·æ±‚å…ƒæ•°æ®å­—æ®µã€‚</p><p>ç”±äº result ä¿å­˜åœ¨ Redux å­˜å‚¨ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½æ”¹å˜å®ƒ - æˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ã€‚query hooks å°†å¯¹è¿”å›çš„å¯¹è±¡è¿›è¡Œæµ…å±‚æ¯”è¾ƒï¼Œå¹¶ä¸”ä»…åœ¨å…¶ä¸­ä¸€ä¸ªå­—æ®µå‘ç”Ÿæ›´æ”¹æ—¶æ‰é‡æ–°æ¸²æŸ“ç»„ä»¶ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…è¿”å›æ­¤ç»„ä»¶æ‰€éœ€çš„ç‰¹å®šå­—æ®µæ¥ä¼˜åŒ–é‡æ–°æ¸²æŸ“ - å¦‚æœæˆ‘ä»¬ä¸éœ€è¦å…¶ä½™çš„å…ƒæ•°æ®æ ‡å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨çœç•¥å®ƒä»¬ã€‚å¦‚æœä½ ç¡®å®éœ€è¦å®ƒä»¬ï¼Œä½ å¯ä»¥ä¼ æ’­åŸå§‹çš„ result å€¼ä»¥å°†å®ƒä»¬åŒ…å«åœ¨è¾“å‡ºä¸­ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createSelector } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectUserById } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../users/usersSlice&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useGetPostsQuery } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../api/apiSlice&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserPage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> match.params</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectUserById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state, userId))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é€šè¿‡æ¯æ¬¡è°ƒç”¨ selectPostsForUser(result, userId)ï¼Œå®ƒä¼šè®°ä½è¿‡æ»¤åçš„æ•°ç»„ï¼Œåªæœ‰åœ¨è·å–çš„æ•°æ®æˆ–ç”¨æˆ·IDå‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectPostsForUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMemo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> emptyArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿”å›æ­¤é¡µé¢çš„å”¯ä¸€ selector å®ä¾‹ï¼Œä»¥ä¾¿</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // è¿‡æ»¤åçš„ç»“æœè¢«æ­£ç¡®è®°å¿†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.data,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> post.user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> emptyArray</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½¿ç”¨ç›¸åŒçš„å¸–å­æŸ¥è¯¢ï¼Œä½†ä»…æå–å…¶éƒ¨åˆ†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†è°ƒç”¨å­—æ®µ â€œpostsForUserâ€ï¼Œæˆ‘ä»¬å¯ä»¥ä» hook ç»“æœä¸­è§£æ„è¿™ä¸ªæ–°å­—æ®µã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">postsForUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useGetPostsQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // selectFromResult å›è°ƒä»æœåŠ¡å™¨æ¥æ”¶åŒ…å«åŸå§‹è¯·æ±‚å…ƒæ•°æ®å’Œ data çš„ result å¯¹è±¡ï¼Œå¹¶ä¸”åº”è¯¥è¿”å›ä¸€äº›æå–æˆ–æ´¾ç”Ÿçš„å€¼ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å› ä¸º query hooks ä¸ºè¿™é‡Œè¿”å›çš„ä»»ä½•å†…å®¹æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„ refetch æ–¹æ³•ï¼Œæ‰€ä»¥æœ€å¥½å§‹ç»ˆä» selectFromResult è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä½ éœ€è¦çš„å­—æ®µã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    selectFromResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // æˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨æ­¤å¤„åŒ…å«ç»“æœä¸­çš„å…¶ä»–å…ƒæ•°æ®å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // åœ¨ hook ç»“æœå¯¹è±¡ä¸­åŒ…å«ä¸€ä¸ªåä¸º â€œpostsForUserâ€ çš„å­—æ®µï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // è¿™å°†æ˜¯ä¸€ä¸ªè¿‡æ»¤çš„å¸–å­åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      postsForUser: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectPostsForUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result, userId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // omit rendering logic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="_8-4-7-optimistic-updatesâ€‹-ä¹è§‚æ›´æ–°" tabindex="-1">8.4.7 Optimistic Updatesâ€‹ ä¹è§‚æ›´æ–° <a class="header-anchor" href="#_8-4-7-optimistic-updatesâ€‹-ä¹è§‚æ›´æ–°" aria-label="Permalink to &quot;8.4.7 Optimistic Updatesâ€‹ ä¹è§‚æ›´æ–°&quot;">â€‹</a></h3><p>RTK Query å…è®¸ä½ é€šè¿‡åŸºäºè¯·æ±‚ç”Ÿå‘½å‘¨æœŸå¤„ç†ç¨‹åºä¿®æ”¹å®¢æˆ·ç«¯ç¼“å­˜æ¥å®ç° Optimistic Updatesã€‚è¯·æ±‚æ¥å£å¯ä»¥å®šä¹‰ä¸€ä¸ª onQueryStarted å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨è¯·æ±‚å¼€å§‹æ—¶è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥å¤„ç†ç¨‹åºä¸­è¿è¡Œå…¶ä»–é€»è¾‘ã€‚</p><p>onQueryStarted å¤„ç†ç¨‹åºæ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯è¯·æ±‚å¼€å§‹æ—¶ä¼ é€’çš„ç¼“å­˜é”® argã€‚ ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€äº›ä¸ createAsyncThunk ä¸­çš„ thunkApi ç›¸åŒçš„å­—æ®µï¼ˆ{dispatch, getState, extra, requestId}ï¼‰ï¼Œä½†ä¹ŸåŒ…å«ä¸€ä¸ªåä¸º queryFulfilled çš„ Promiseã€‚è¿™ä¸ª Promise å°†åœ¨è¯·æ±‚è¿”å›æ—¶è§£æï¼Œå¹¶æ ¹æ®è¯·æ±‚æ‰§è¡Œæˆ–æ‹’ç»ã€‚</p><p>API slice å¯¹è±¡åŒ…å«ä¸€ä¸ª updateQueryData å®ç”¨å‡½æ•°ï¼Œå¯è®©æˆ‘ä»¬æ›´æ–°ç¼“å­˜å€¼ã€‚å®ƒéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼šè¦æ›´æ–°çš„è¯·æ±‚æ¥å£çš„åç§°ã€ç”¨äºæ ‡è¯†ç‰¹å®šç¼“å­˜æ•°æ®çš„ç›¸åŒç¼“å­˜é”®å€¼ä»¥åŠæ›´æ–°ç¼“å­˜æ•°æ®çš„å›è°ƒã€‚ updateQueryData ä½¿ç”¨ Immerï¼Œå› æ­¤ä½ å¯ä»¥åƒåœ¨ createSlice ä¸­ä¸€æ ·â€œæ”¹å˜â€èµ·è‰çš„ç¼“å­˜æ•°æ®ã€‚</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiSlice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reducerPath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseQuery: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchBaseQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/fakeApi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tagTypes: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¿½ç•¥éƒ¨åˆ†ä¾èµ–</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    addReaction: builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`posts/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/reactions\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åœ¨ä¸€ä¸ªçœŸå®çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä»¥æŸç§æ–¹å¼åŸºäºç”¨æˆ· ID</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è¿™æ ·ç”¨æˆ·å°±ä¸èƒ½å¤šæ¬¡åšå‡ºç›¸åŒçš„ååº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: { reaction }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onQueryStarted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">postId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">queryFulfilled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // \`updateQueryData\` éœ€è¦è¯·æ±‚æ¥å£åç§°å’Œç¼“å­˜é”®å‚æ•°ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ‰€ä»¥å®ƒçŸ¥é“è¦æ›´æ–°å“ªä¸€å—ç¼“å­˜çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> patchResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          apiSlice.util.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateQueryData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;getPosts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">draft</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // \`draft\` æ˜¯ Immer-wrapped çš„ï¼Œå¯ä»¥åƒ createSlice ä¸­ä¸€æ · â€œmutatedâ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> draft.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> post.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> postId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (post) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              post.reactions[reaction]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœŸæœ›è¯·æ±‚ä¼šæˆåŠŸã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥ await queryFulfilledï¼Œæ•è·å¤±è´¥ï¼Œå¹¶æ’¤æ¶ˆè¡¥ä¸æ›´æ”¹ä»¥æ¢å¤ optimistic updateã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // å½“æˆ‘ä»¬ dispatch è¯¥ action æ—¶ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª patchResult å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryFulfilled</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // è°ƒç”¨ patchResult.undo()ï¼Œå®ƒä¼šè‡ªåŠ¨ dispatch ä¸€ä¸ªæ“ä½œæ¥åè½¬è¡¥ä¸å·®å¼‚æ›´æ”¹ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          patchResult.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">undo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="_8-4-8-rtk-query-å…·æœ‰ç”¨äºæ“ä½œç¼“å­˜æ•°æ®ä»¥è·å¾—æ›´å¥½ç”¨æˆ·ä½“éªŒçš„é«˜çº§é€‰é¡¹" tabindex="-1">8.4.8 RTK Query å…·æœ‰ç”¨äºæ“ä½œç¼“å­˜æ•°æ®ä»¥è·å¾—æ›´å¥½ç”¨æˆ·ä½“éªŒçš„é«˜çº§é€‰é¡¹ <a class="header-anchor" href="#_8-4-8-rtk-query-å…·æœ‰ç”¨äºæ“ä½œç¼“å­˜æ•°æ®ä»¥è·å¾—æ›´å¥½ç”¨æˆ·ä½“éªŒçš„é«˜çº§é€‰é¡¹" aria-label="Permalink to &quot;8.4.8 RTK Query å…·æœ‰ç”¨äºæ“ä½œç¼“å­˜æ•°æ®ä»¥è·å¾—æ›´å¥½ç”¨æˆ·ä½“éªŒçš„é«˜çº§é€‰é¡¹&quot;">â€‹</a></h3><ul><li>onQueryStarted ç”Ÿå‘½å‘¨æœŸå¯ç”¨äºé€šè¿‡åœ¨è¯·æ±‚è¿”å›ä¹‹å‰ç«‹å³æ›´æ–°ç¼“å­˜æ¥è¿›è¡Œ optimistic updates</li><li>onCacheEntryAdded ç”Ÿå‘½å‘¨æœŸå¯ç”¨äºé€šè¿‡åŸºäºæœåŠ¡å™¨æ¨é€è¿æ¥éšæ—¶é—´æ›´æ–°ç¼“å­˜æ¥è¿›è¡Œæµå¼æ›´æ–°</li></ul>`,203)]))}const g=i(p,[["render",e]]);export{c as __pageData,g as default};
